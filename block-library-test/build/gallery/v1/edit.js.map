{"version":3,"names":["_compose","require","_components","_blockEditor","_element","_i18n","_blob","_data","_viewport","_primitives","_coreData","_sharedIcon","_shared","_deprecated","_gallery","_interopRequireDefault","_constants","MAX_COLUMNS","linkOptions","value","LINK_DESTINATION_ATTACHMENT","label","__","LINK_DESTINATION_MEDIA","LINK_DESTINATION_NONE","ALLOWED_MEDIA_TYPES","PLACEHOLDER_TEXT","Platform","select","web","native","MOBILE_CONTROL_PROPS_RANGE_CONTROL","type","GalleryEdit","props","attributes","clientId","isSelected","noticeUI","noticeOperations","onFocus","columns","defaultColumnsNumberV1","imageCrop","images","linkTo","sizeSlug","selectedImage","setSelectedImage","useState","attachmentCaptions","setAttachmentCaptions","__unstableMarkNextChangeAsNotPersistent","useDispatch","blockEditorStore","imageSizes","mediaUpload","getMedia","wasBlockJustInserted","useSelect","settings","getSettings","coreStore","resizedImages","useMemo","_attributes$ids","ids","reduce","currentResizedImages","id","image","sizes","currentSizes","size","defaultUrl","slug","url","mediaDetailsUrl","media_details","source_url","parseInt","onFocusGalleryCaption","setAttributes","newAttrs","Error","map","onSelectImage","index","onDeselectImage","onMove","oldIndex","newIndex","newImages","splice","onMoveForward","length","onMoveBackward","onRemoveImage","filter","img","i","Math","min","selectCaption","newImage","newImageId","toString","currentImage","find","currentImageCaption","caption","attachment","onSelectImages","pickRelevantMediaFiles","onUploadError","message","removeAllNotices","createErrorNotice","setLinkTo","setColumnsNumber","toggleImageCrop","getImageCropHelp","checked","setImageAttributes","newAttributes","slice","getImagesSizeOptions","resizedImageSizes","Object","values","some","name","updateImagesSize","newSizeSlug","updatedImages","useEffect","OS","every","isBlobURL","filesList","getBlobByURL","forEach","revokeBlobURL","onFileChange","allowedTypes","window","wp","media","view","defaultProps","link","hasImages","hasImageIds","mediaPlaceholder","_react","createElement","MediaPlaceholder","addToGallery","isAppender","disableMediaButtons","icon","sharedIcon","labels","title","instructions","onSelect","accept","multiple","onError","notices","undefined","autoOpenMediaUpload","blockProps","useBlockProps","View","imageSizeOptions","shouldShowSizeOptions","Fragment","InspectorControls","PanelBody","RangeControl","__nextHasNoMarginBottom","onChange","max","required","ToggleControl","help","SelectControl","options","hideCancelButton","default","onSetImageAttributes","_default","exports","compose","withNotices","withViewportMatch","isNarrow"],"sources":["@wordpress/block-library/src/gallery/v1/edit.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport {\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n\tRangeControl,\n} from '@wordpress/components';\nimport {\n\tMediaPlaceholder,\n\tInspectorControls,\n\tuseBlockProps,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { Platform, useEffect, useState, useMemo } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { View } from '@wordpress/primitives';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport { sharedIcon } from '../shared-icon';\nimport { pickRelevantMediaFiles } from './shared';\nimport { defaultColumnsNumberV1 } from '../deprecated';\nimport Gallery from './gallery';\nimport {\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tLINK_DESTINATION_NONE,\n} from './constants';\n\nconst MAX_COLUMNS = 8;\nconst linkOptions = [\n\t{ value: LINK_DESTINATION_ATTACHMENT, label: __( 'Attachment Page' ) },\n\t{ value: LINK_DESTINATION_MEDIA, label: __( 'Media File' ) },\n\t{ value: LINK_DESTINATION_NONE, label: __( 'None' ) },\n];\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst PLACEHOLDER_TEXT = Platform.select( {\n\tweb: __(\n\t\t'Drag images, upload new ones or select files from your library.'\n\t),\n\tnative: __( 'ADD MEDIA' ),\n} );\n\nconst MOBILE_CONTROL_PROPS_RANGE_CONTROL = Platform.select( {\n\tweb: {},\n\tnative: { type: 'stepper' },\n} );\n\nfunction GalleryEdit( props ) {\n\tconst {\n\t\tattributes,\n\t\tclientId,\n\t\tisSelected,\n\t\tnoticeUI,\n\t\tnoticeOperations,\n\t\tonFocus,\n\t} = props;\n\tconst {\n\t\tcolumns = defaultColumnsNumberV1( attributes ),\n\t\timageCrop,\n\t\timages,\n\t\tlinkTo,\n\t\tsizeSlug,\n\t} = attributes;\n\tconst [ selectedImage, setSelectedImage ] = useState();\n\tconst [ attachmentCaptions, setAttachmentCaptions ] = useState();\n\tconst { __unstableMarkNextChangeAsNotPersistent } =\n\t\tuseDispatch( blockEditorStore );\n\n\tconst { imageSizes, mediaUpload, getMedia, wasBlockJustInserted } =\n\t\tuseSelect( ( select ) => {\n\t\t\tconst settings = select( blockEditorStore ).getSettings();\n\n\t\t\treturn {\n\t\t\t\timageSizes: settings.imageSizes,\n\t\t\t\tmediaUpload: settings.mediaUpload,\n\t\t\t\tgetMedia: select( coreStore ).getMedia,\n\t\t\t\twasBlockJustInserted: select(\n\t\t\t\t\tblockEditorStore\n\t\t\t\t).wasBlockJustInserted( clientId, 'inserter_menu' ),\n\t\t\t};\n\t\t} );\n\n\tconst resizedImages = useMemo( () => {\n\t\tif ( isSelected ) {\n\t\t\treturn ( attributes.ids ?? [] ).reduce(\n\t\t\t\t( currentResizedImages, id ) => {\n\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\treturn currentResizedImages;\n\t\t\t\t\t}\n\t\t\t\t\tconst image = getMedia( id );\n\t\t\t\t\tconst sizes = imageSizes.reduce( ( currentSizes, size ) => {\n\t\t\t\t\t\tconst defaultUrl = image?.sizes?.[ size.slug ]?.url;\n\t\t\t\t\t\tconst mediaDetailsUrl =\n\t\t\t\t\t\t\timage?.media_details?.sizes?.[ size.slug ]\n\t\t\t\t\t\t\t\t?.source_url;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...currentSizes,\n\t\t\t\t\t\t\t[ size.slug ]: defaultUrl || mediaDetailsUrl,\n\t\t\t\t\t\t};\n\t\t\t\t\t}, {} );\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...currentResizedImages,\n\t\t\t\t\t\t[ parseInt( id, 10 ) ]: sizes,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t{}\n\t\t\t);\n\t\t}\n\t\treturn {};\n\t}, [ isSelected, attributes.ids, imageSizes ] );\n\n\tfunction onFocusGalleryCaption() {\n\t\tsetSelectedImage();\n\t}\n\n\tfunction setAttributes( newAttrs ) {\n\t\tif ( newAttrs.ids ) {\n\t\t\tthrow new Error(\n\t\t\t\t'The \"ids\" attribute should not be changed directly. It is managed automatically when \"images\" attribute changes'\n\t\t\t);\n\t\t}\n\n\t\tif ( newAttrs.images ) {\n\t\t\tnewAttrs = {\n\t\t\t\t...newAttrs,\n\t\t\t\t// Unlike images[ n ].id which is a string, always ensure the\n\t\t\t\t// ids array contains numbers as per its attribute type.\n\t\t\t\tids: newAttrs.images.map( ( { id } ) => parseInt( id, 10 ) ),\n\t\t\t};\n\t\t}\n\n\t\tprops.setAttributes( newAttrs );\n\t}\n\n\tfunction onSelectImage( index ) {\n\t\treturn () => {\n\t\t\tsetSelectedImage( index );\n\t\t};\n\t}\n\n\tfunction onDeselectImage() {\n\t\treturn () => {\n\t\t\tsetSelectedImage();\n\t\t};\n\t}\n\n\tfunction onMove( oldIndex, newIndex ) {\n\t\tconst newImages = [ ...images ];\n\t\tnewImages.splice( newIndex, 1, images[ oldIndex ] );\n\t\tnewImages.splice( oldIndex, 1, images[ newIndex ] );\n\t\tsetSelectedImage( newIndex );\n\t\tsetAttributes( { images: newImages } );\n\t}\n\n\tfunction onMoveForward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === images.length - 1 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex + 1 );\n\t\t};\n\t}\n\n\tfunction onMoveBackward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex - 1 );\n\t\t};\n\t}\n\n\tfunction onRemoveImage( index ) {\n\t\treturn () => {\n\t\t\tconst newImages = images.filter( ( img, i ) => index !== i );\n\t\t\tsetSelectedImage();\n\t\t\tsetAttributes( {\n\t\t\t\timages: newImages,\n\t\t\t\tcolumns: attributes.columns\n\t\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t\t: attributes.columns,\n\t\t\t} );\n\t\t};\n\t}\n\n\tfunction selectCaption( newImage ) {\n\t\t// The image id in both the images and attachmentCaptions arrays is a\n\t\t// string, so ensure comparison works correctly by converting the\n\t\t// newImage.id to a string.\n\t\tconst newImageId = newImage.id.toString();\n\t\tconst currentImage = images.find( ( { id } ) => id === newImageId );\n\t\tconst currentImageCaption = currentImage\n\t\t\t? currentImage.caption\n\t\t\t: newImage.caption;\n\n\t\tif ( ! attachmentCaptions ) {\n\t\t\treturn currentImageCaption;\n\t\t}\n\n\t\tconst attachment = attachmentCaptions.find(\n\t\t\t( { id } ) => id === newImageId\n\t\t);\n\n\t\t// If the attachment caption is updated.\n\t\tif ( attachment && attachment.caption !== newImage.caption ) {\n\t\t\treturn newImage.caption;\n\t\t}\n\n\t\treturn currentImageCaption;\n\t}\n\n\tfunction onSelectImages( newImages ) {\n\t\tsetAttachmentCaptions(\n\t\t\tnewImages.map( ( newImage ) => ( {\n\t\t\t\t// Store the attachmentCaption id as a string for consistency\n\t\t\t\t// with the type of the id in the images attribute.\n\t\t\t\tid: newImage.id.toString(),\n\t\t\t\tcaption: newImage.caption,\n\t\t\t} ) )\n\t\t);\n\t\tsetAttributes( {\n\t\t\timages: newImages.map( ( newImage ) => ( {\n\t\t\t\t...pickRelevantMediaFiles( newImage, sizeSlug ),\n\t\t\t\tcaption: selectCaption( newImage, images, attachmentCaptions ),\n\t\t\t\t// The id value is stored in a data attribute, so when the\n\t\t\t\t// block is parsed it's converted to a string. Converting\n\t\t\t\t// to a string here ensures it's type is consistent.\n\t\t\t\tid: newImage.id.toString(),\n\t\t\t} ) ),\n\t\t\tcolumns: attributes.columns\n\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t: attributes.columns,\n\t\t} );\n\t}\n\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\tfunction setLinkTo( value ) {\n\t\tsetAttributes( { linkTo: value } );\n\t}\n\n\tfunction setColumnsNumber( value ) {\n\t\tsetAttributes( { columns: value } );\n\t}\n\n\tfunction toggleImageCrop() {\n\t\tsetAttributes( { imageCrop: ! imageCrop } );\n\t}\n\n\tfunction getImageCropHelp( checked ) {\n\t\treturn checked\n\t\t\t? __( 'Thumbnails are cropped to align.' )\n\t\t\t: __( 'Thumbnails are not cropped.' );\n\t}\n\n\tfunction setImageAttributes( index, newAttributes ) {\n\t\tif ( ! images[ index ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetAttributes( {\n\t\t\timages: [\n\t\t\t\t...images.slice( 0, index ),\n\t\t\t\t{\n\t\t\t\t\t...images[ index ],\n\t\t\t\t\t...newAttributes,\n\t\t\t\t},\n\t\t\t\t...images.slice( index + 1 ),\n\t\t\t],\n\t\t} );\n\t}\n\n\tfunction getImagesSizeOptions() {\n\t\tconst resizedImageSizes = Object.values( resizedImages );\n\t\treturn imageSizes\n\t\t\t.filter( ( { slug } ) =>\n\t\t\t\tresizedImageSizes.some( ( sizes ) => sizes[ slug ] )\n\t\t\t)\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\t}\n\n\tfunction updateImagesSize( newSizeSlug ) {\n\t\tconst updatedImages = ( images ?? [] ).map( ( image ) => {\n\t\t\tif ( ! image.id ) {\n\t\t\t\treturn image;\n\t\t\t}\n\t\t\tconst url =\n\t\t\t\tresizedImages[ parseInt( image.id, 10 ) ]?.[ newSizeSlug ];\n\t\t\treturn {\n\t\t\t\t...image,\n\t\t\t\t...( url && { url } ),\n\t\t\t};\n\t\t} );\n\n\t\tsetAttributes( { images: updatedImages, sizeSlug: newSizeSlug } );\n\t}\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tPlatform.OS === 'web' &&\n\t\t\timages &&\n\t\t\timages.length > 0 &&\n\t\t\timages.every( ( { url } ) => isBlobURL( url ) )\n\t\t) {\n\t\t\tconst filesList = images.map( ( { url } ) => getBlobByURL( url ) );\n\t\t\timages.forEach( ( { url } ) => revokeBlobURL( url ) );\n\t\t\tmediaUpload( {\n\t\t\t\tfilesList,\n\t\t\t\tonFileChange: onSelectImages,\n\t\t\t\tallowedTypes: [ 'image' ],\n\t\t\t} );\n\t\t}\n\t}, [] );\n\n\tuseEffect( () => {\n\t\t// Deselect images when deselecting the block.\n\t\tif ( ! isSelected ) {\n\t\t\tsetSelectedImage();\n\t\t}\n\t}, [ isSelected ] );\n\n\tuseEffect( () => {\n\t\t// linkTo attribute must be saved so blocks don't break when changing\n\t\t// image_default_link_type in options.php.\n\t\tif ( ! linkTo ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\tlinkTo:\n\t\t\t\t\twindow?.wp?.media?.view?.settings?.defaultProps?.link ||\n\t\t\t\t\tLINK_DESTINATION_NONE,\n\t\t\t} );\n\t\t}\n\t}, [ linkTo ] );\n\n\tconst hasImages = !! images.length;\n\tconst hasImageIds = hasImages && images.some( ( image ) => !! image.id );\n\n\tconst mediaPlaceholder = (\n\t\t<MediaPlaceholder\n\t\t\taddToGallery={ hasImageIds }\n\t\t\tisAppender={ hasImages }\n\t\t\tdisableMediaButtons={ hasImages && ! isSelected }\n\t\t\ticon={ ! hasImages && sharedIcon }\n\t\t\tlabels={ {\n\t\t\t\ttitle: ! hasImages && __( 'Gallery' ),\n\t\t\t\tinstructions: ! hasImages && PLACEHOLDER_TEXT,\n\t\t\t} }\n\t\t\tonSelect={ onSelectImages }\n\t\t\taccept=\"image/*\"\n\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\tmultiple\n\t\t\tvalue={ hasImageIds ? images : {} }\n\t\t\tonError={ onUploadError }\n\t\t\tnotices={ hasImages ? undefined : noticeUI }\n\t\t\tonFocus={ onFocus }\n\t\t\tautoOpenMediaUpload={\n\t\t\t\t! hasImages && isSelected && wasBlockJustInserted\n\t\t\t}\n\t\t/>\n\t);\n\n\tconst blockProps = useBlockProps();\n\n\tif ( ! hasImages ) {\n\t\treturn <View { ...blockProps }>{ mediaPlaceholder }</View>;\n\t}\n\n\tconst imageSizeOptions = getImagesSizeOptions();\n\tconst shouldShowSizeOptions = hasImages && imageSizeOptions.length > 0;\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Settings' ) }>\n\t\t\t\t\t{ images.length > 1 && (\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t\tlabel={ __( 'Columns' ) }\n\t\t\t\t\t\t\tvalue={ columns }\n\t\t\t\t\t\t\tonChange={ setColumnsNumber }\n\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\tmax={ Math.min( MAX_COLUMNS, images.length ) }\n\t\t\t\t\t\t\t{ ...MOBILE_CONTROL_PROPS_RANGE_CONTROL }\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\tlabel={ __( 'Crop images' ) }\n\t\t\t\t\t\tchecked={ !! imageCrop }\n\t\t\t\t\t\tonChange={ toggleImageCrop }\n\t\t\t\t\t\thelp={ getImageCropHelp }\n\t\t\t\t\t/>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\tlabel={ __( 'Link to' ) }\n\t\t\t\t\t\tvalue={ linkTo }\n\t\t\t\t\t\tonChange={ setLinkTo }\n\t\t\t\t\t\toptions={ linkOptions }\n\t\t\t\t\t\thideCancelButton={ true }\n\t\t\t\t\t/>\n\t\t\t\t\t{ shouldShowSizeOptions && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t\tlabel={ __( 'Image size' ) }\n\t\t\t\t\t\t\tvalue={ sizeSlug }\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\n\t\t\t\t\t\t\tonChange={ updateImagesSize }\n\t\t\t\t\t\t\thideCancelButton={ true }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t{ noticeUI }\n\t\t\t<Gallery\n\t\t\t\t{ ...props }\n\t\t\t\tselectedImage={ selectedImage }\n\t\t\t\tmediaPlaceholder={ mediaPlaceholder }\n\t\t\t\tonMoveBackward={ onMoveBackward }\n\t\t\t\tonMoveForward={ onMoveForward }\n\t\t\t\tonRemoveImage={ onRemoveImage }\n\t\t\t\tonSelectImage={ onSelectImage }\n\t\t\t\tonDeselectImage={ onDeselectImage }\n\t\t\t\tonSetImageAttributes={ setImageAttributes }\n\t\t\t\tblockProps={ blockProps }\n\t\t\t\t// This prop is used by gallery.native.js.\n\t\t\t\tonFocusGalleryCaption={ onFocusGalleryCaption }\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nexport default compose( [\n\twithNotices,\n\twithViewportMatch( { isNarrow: '< small' } ),\n] )( GalleryEdit );\n"],"mappings":";;;;;;;;AAGA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AAOA,IAAAE,YAAA,GAAAF,OAAA;AAMA,IAAAG,QAAA,GAAAH,OAAA;AACA,IAAAI,KAAA,GAAAJ,OAAA;AACA,IAAAK,KAAA,GAAAL,OAAA;AACA,IAAAM,KAAA,GAAAN,OAAA;AACA,IAAAO,SAAA,GAAAP,OAAA;AACA,IAAAQ,WAAA,GAAAR,OAAA;AACA,IAAAS,SAAA,GAAAT,OAAA;AAKA,IAAAU,WAAA,GAAAV,OAAA;AACA,IAAAW,OAAA,GAAAX,OAAA;AACA,IAAAY,WAAA,GAAAZ,OAAA;AACA,IAAAa,QAAA,GAAAC,sBAAA,CAAAd,OAAA;AACA,IAAAe,UAAA,GAAAf,OAAA;AAhCA;AACA;AACA;;AAuBA;AACA;AACA;;AAWA,MAAMgB,WAAW,GAAG,CAAC;AACrB,MAAMC,WAAW,GAAG,CACnB;EAAEC,KAAK,EAAEC,sCAA2B;EAAEC,KAAK,EAAE,IAAAC,QAAE,EAAE,iBAAkB;AAAE,CAAC,EACtE;EAAEH,KAAK,EAAEI,iCAAsB;EAAEF,KAAK,EAAE,IAAAC,QAAE,EAAE,YAAa;AAAE,CAAC,EAC5D;EAAEH,KAAK,EAAEK,gCAAqB;EAAEH,KAAK,EAAE,IAAAC,QAAE,EAAE,MAAO;AAAE,CAAC,CACrD;AACD,MAAMG,mBAAmB,GAAG,CAAE,OAAO,CAAE;AAEvC,MAAMC,gBAAgB,GAAGC,iBAAQ,CAACC,MAAM,CAAE;EACzCC,GAAG,EAAE,IAAAP,QAAE,EACN,iEACD,CAAC;EACDQ,MAAM,EAAE,IAAAR,QAAE,EAAE,WAAY;AACzB,CAAE,CAAC;AAEH,MAAMS,kCAAkC,GAAGJ,iBAAQ,CAACC,MAAM,CAAE;EAC3DC,GAAG,EAAE,CAAC,CAAC;EACPC,MAAM,EAAE;IAAEE,IAAI,EAAE;EAAU;AAC3B,CAAE,CAAC;AAEH,SAASC,WAAWA,CAAEC,KAAK,EAAG;EAC7B,MAAM;IACLC,UAAU;IACVC,QAAQ;IACRC,UAAU;IACVC,QAAQ;IACRC,gBAAgB;IAChBC;EACD,CAAC,GAAGN,KAAK;EACT,MAAM;IACLO,OAAO,GAAG,IAAAC,kCAAsB,EAAEP,UAAW,CAAC;IAC9CQ,SAAS;IACTC,MAAM;IACNC,MAAM;IACNC;EACD,CAAC,GAAGX,UAAU;EACd,MAAM,CAAEY,aAAa,EAAEC,gBAAgB,CAAE,GAAG,IAAAC,iBAAQ,EAAC,CAAC;EACtD,MAAM,CAAEC,kBAAkB,EAAEC,qBAAqB,CAAE,GAAG,IAAAF,iBAAQ,EAAC,CAAC;EAChE,MAAM;IAAEG;EAAwC,CAAC,GAChD,IAAAC,iBAAW,EAAEC,kBAAiB,CAAC;EAEhC,MAAM;IAAEC,UAAU;IAAEC,WAAW;IAAEC,QAAQ;IAAEC;EAAqB,CAAC,GAChE,IAAAC,eAAS,EAAI/B,MAAM,IAAM;IACxB,MAAMgC,QAAQ,GAAGhC,MAAM,CAAE0B,kBAAiB,CAAC,CAACO,WAAW,CAAC,CAAC;IAEzD,OAAO;MACNN,UAAU,EAAEK,QAAQ,CAACL,UAAU;MAC/BC,WAAW,EAAEI,QAAQ,CAACJ,WAAW;MACjCC,QAAQ,EAAE7B,MAAM,CAAEkC,eAAU,CAAC,CAACL,QAAQ;MACtCC,oBAAoB,EAAE9B,MAAM,CAC3B0B,kBACD,CAAC,CAACI,oBAAoB,CAAEtB,QAAQ,EAAE,eAAgB;IACnD,CAAC;EACF,CAAE,CAAC;EAEJ,MAAM2B,aAAa,GAAG,IAAAC,gBAAO,EAAE,MAAM;IACpC,IAAK3B,UAAU,EAAG;MAAA,IAAA4B,eAAA;MACjB,OAAO,EAAAA,eAAA,GAAE9B,UAAU,CAAC+B,GAAG,cAAAD,eAAA,cAAAA,eAAA,GAAI,EAAE,EAAGE,MAAM,CACrC,CAAEC,oBAAoB,EAAEC,EAAE,KAAM;QAC/B,IAAK,CAAEA,EAAE,EAAG;UACX,OAAOD,oBAAoB;QAC5B;QACA,MAAME,KAAK,GAAGb,QAAQ,CAAEY,EAAG,CAAC;QAC5B,MAAME,KAAK,GAAGhB,UAAU,CAACY,MAAM,CAAE,CAAEK,YAAY,EAAEC,IAAI,KAAM;UAC1D,MAAMC,UAAU,GAAGJ,KAAK,EAAEC,KAAK,GAAIE,IAAI,CAACE,IAAI,CAAE,EAAEC,GAAG;UACnD,MAAMC,eAAe,GACpBP,KAAK,EAAEQ,aAAa,EAAEP,KAAK,GAAIE,IAAI,CAACE,IAAI,CAAE,EACvCI,UAAU;UACd,OAAO;YACN,GAAGP,YAAY;YACf,CAAEC,IAAI,CAACE,IAAI,GAAID,UAAU,IAAIG;UAC9B,CAAC;QACF,CAAC,EAAE,CAAC,CAAE,CAAC;QACP,OAAO;UACN,GAAGT,oBAAoB;UACvB,CAAEY,QAAQ,CAAEX,EAAE,EAAE,EAAG,CAAC,GAAIE;QACzB,CAAC;MACF,CAAC,EACD,CAAC,CACF,CAAC;IACF;IACA,OAAO,CAAC,CAAC;EACV,CAAC,EAAE,CAAElC,UAAU,EAAEF,UAAU,CAAC+B,GAAG,EAAEX,UAAU,CAAG,CAAC;EAE/C,SAAS0B,qBAAqBA,CAAA,EAAG;IAChCjC,gBAAgB,CAAC,CAAC;EACnB;EAEA,SAASkC,aAAaA,CAAEC,QAAQ,EAAG;IAClC,IAAKA,QAAQ,CAACjB,GAAG,EAAG;MACnB,MAAM,IAAIkB,KAAK,CACd,iHACD,CAAC;IACF;IAEA,IAAKD,QAAQ,CAACvC,MAAM,EAAG;MACtBuC,QAAQ,GAAG;QACV,GAAGA,QAAQ;QACX;QACA;QACAjB,GAAG,EAAEiB,QAAQ,CAACvC,MAAM,CAACyC,GAAG,CAAE,CAAE;UAAEhB;QAAG,CAAC,KAAMW,QAAQ,CAAEX,EAAE,EAAE,EAAG,CAAE;MAC5D,CAAC;IACF;IAEAnC,KAAK,CAACgD,aAAa,CAAEC,QAAS,CAAC;EAChC;EAEA,SAASG,aAAaA,CAAEC,KAAK,EAAG;IAC/B,OAAO,MAAM;MACZvC,gBAAgB,CAAEuC,KAAM,CAAC;IAC1B,CAAC;EACF;EAEA,SAASC,eAAeA,CAAA,EAAG;IAC1B,OAAO,MAAM;MACZxC,gBAAgB,CAAC,CAAC;IACnB,CAAC;EACF;EAEA,SAASyC,MAAMA,CAAEC,QAAQ,EAAEC,QAAQ,EAAG;IACrC,MAAMC,SAAS,GAAG,CAAE,GAAGhD,MAAM,CAAE;IAC/BgD,SAAS,CAACC,MAAM,CAAEF,QAAQ,EAAE,CAAC,EAAE/C,MAAM,CAAE8C,QAAQ,CAAG,CAAC;IACnDE,SAAS,CAACC,MAAM,CAAEH,QAAQ,EAAE,CAAC,EAAE9C,MAAM,CAAE+C,QAAQ,CAAG,CAAC;IACnD3C,gBAAgB,CAAE2C,QAAS,CAAC;IAC5BT,aAAa,CAAE;MAAEtC,MAAM,EAAEgD;IAAU,CAAE,CAAC;EACvC;EAEA,SAASE,aAAaA,CAAEJ,QAAQ,EAAG;IAClC,OAAO,MAAM;MACZ,IAAKA,QAAQ,KAAK9C,MAAM,CAACmD,MAAM,GAAG,CAAC,EAAG;QACrC;MACD;MACAN,MAAM,CAAEC,QAAQ,EAAEA,QAAQ,GAAG,CAAE,CAAC;IACjC,CAAC;EACF;EAEA,SAASM,cAAcA,CAAEN,QAAQ,EAAG;IACnC,OAAO,MAAM;MACZ,IAAKA,QAAQ,KAAK,CAAC,EAAG;QACrB;MACD;MACAD,MAAM,CAAEC,QAAQ,EAAEA,QAAQ,GAAG,CAAE,CAAC;IACjC,CAAC;EACF;EAEA,SAASO,aAAaA,CAAEV,KAAK,EAAG;IAC/B,OAAO,MAAM;MACZ,MAAMK,SAAS,GAAGhD,MAAM,CAACsD,MAAM,CAAE,CAAEC,GAAG,EAAEC,CAAC,KAAMb,KAAK,KAAKa,CAAE,CAAC;MAC5DpD,gBAAgB,CAAC,CAAC;MAClBkC,aAAa,CAAE;QACdtC,MAAM,EAAEgD,SAAS;QACjBnD,OAAO,EAAEN,UAAU,CAACM,OAAO,GACxB4D,IAAI,CAACC,GAAG,CAAEV,SAAS,CAACG,MAAM,EAAE5D,UAAU,CAACM,OAAQ,CAAC,GAChDN,UAAU,CAACM;MACf,CAAE,CAAC;IACJ,CAAC;EACF;EAEA,SAAS8D,aAAaA,CAAEC,QAAQ,EAAG;IAClC;IACA;IACA;IACA,MAAMC,UAAU,GAAGD,QAAQ,CAACnC,EAAE,CAACqC,QAAQ,CAAC,CAAC;IACzC,MAAMC,YAAY,GAAG/D,MAAM,CAACgE,IAAI,CAAE,CAAE;MAAEvC;IAAG,CAAC,KAAMA,EAAE,KAAKoC,UAAW,CAAC;IACnE,MAAMI,mBAAmB,GAAGF,YAAY,GACrCA,YAAY,CAACG,OAAO,GACpBN,QAAQ,CAACM,OAAO;IAEnB,IAAK,CAAE5D,kBAAkB,EAAG;MAC3B,OAAO2D,mBAAmB;IAC3B;IAEA,MAAME,UAAU,GAAG7D,kBAAkB,CAAC0D,IAAI,CACzC,CAAE;MAAEvC;IAAG,CAAC,KAAMA,EAAE,KAAKoC,UACtB,CAAC;;IAED;IACA,IAAKM,UAAU,IAAIA,UAAU,CAACD,OAAO,KAAKN,QAAQ,CAACM,OAAO,EAAG;MAC5D,OAAON,QAAQ,CAACM,OAAO;IACxB;IAEA,OAAOD,mBAAmB;EAC3B;EAEA,SAASG,cAAcA,CAAEpB,SAAS,EAAG;IACpCzC,qBAAqB,CACpByC,SAAS,CAACP,GAAG,CAAImB,QAAQ,KAAQ;MAChC;MACA;MACAnC,EAAE,EAAEmC,QAAQ,CAACnC,EAAE,CAACqC,QAAQ,CAAC,CAAC;MAC1BI,OAAO,EAAEN,QAAQ,CAACM;IACnB,CAAC,CAAG,CACL,CAAC;IACD5B,aAAa,CAAE;MACdtC,MAAM,EAAEgD,SAAS,CAACP,GAAG,CAAImB,QAAQ,KAAQ;QACxC,GAAG,IAAAS,8BAAsB,EAAET,QAAQ,EAAE1D,QAAS,CAAC;QAC/CgE,OAAO,EAAEP,aAAa,CAAEC,QAAQ,EAAE5D,MAAM,EAAEM,kBAAmB,CAAC;QAC9D;QACA;QACA;QACAmB,EAAE,EAAEmC,QAAQ,CAACnC,EAAE,CAACqC,QAAQ,CAAC;MAC1B,CAAC,CAAG,CAAC;MACLjE,OAAO,EAAEN,UAAU,CAACM,OAAO,GACxB4D,IAAI,CAACC,GAAG,CAAEV,SAAS,CAACG,MAAM,EAAE5D,UAAU,CAACM,OAAQ,CAAC,GAChDN,UAAU,CAACM;IACf,CAAE,CAAC;EACJ;EAEA,SAASyE,aAAaA,CAAEC,OAAO,EAAG;IACjC5E,gBAAgB,CAAC6E,gBAAgB,CAAC,CAAC;IACnC7E,gBAAgB,CAAC8E,iBAAiB,CAAEF,OAAQ,CAAC;EAC9C;EAEA,SAASG,SAASA,CAAEnG,KAAK,EAAG;IAC3B+D,aAAa,CAAE;MAAErC,MAAM,EAAE1B;IAAM,CAAE,CAAC;EACnC;EAEA,SAASoG,gBAAgBA,CAAEpG,KAAK,EAAG;IAClC+D,aAAa,CAAE;MAAEzC,OAAO,EAAEtB;IAAM,CAAE,CAAC;EACpC;EAEA,SAASqG,eAAeA,CAAA,EAAG;IAC1BtC,aAAa,CAAE;MAAEvC,SAAS,EAAE,CAAEA;IAAU,CAAE,CAAC;EAC5C;EAEA,SAAS8E,gBAAgBA,CAAEC,OAAO,EAAG;IACpC,OAAOA,OAAO,GACX,IAAApG,QAAE,EAAE,kCAAmC,CAAC,GACxC,IAAAA,QAAE,EAAE,6BAA8B,CAAC;EACvC;EAEA,SAASqG,kBAAkBA,CAAEpC,KAAK,EAAEqC,aAAa,EAAG;IACnD,IAAK,CAAEhF,MAAM,CAAE2C,KAAK,CAAE,EAAG;MACxB;IACD;IAEAL,aAAa,CAAE;MACdtC,MAAM,EAAE,CACP,GAAGA,MAAM,CAACiF,KAAK,CAAE,CAAC,EAAEtC,KAAM,CAAC,EAC3B;QACC,GAAG3C,MAAM,CAAE2C,KAAK,CAAE;QAClB,GAAGqC;MACJ,CAAC,EACD,GAAGhF,MAAM,CAACiF,KAAK,CAAEtC,KAAK,GAAG,CAAE,CAAC;IAE9B,CAAE,CAAC;EACJ;EAEA,SAASuC,oBAAoBA,CAAA,EAAG;IAC/B,MAAMC,iBAAiB,GAAGC,MAAM,CAACC,MAAM,CAAElE,aAAc,CAAC;IACxD,OAAOR,UAAU,CACf2C,MAAM,CAAE,CAAE;MAAEvB;IAAK,CAAC,KAClBoD,iBAAiB,CAACG,IAAI,CAAI3D,KAAK,IAAMA,KAAK,CAAEI,IAAI,CAAG,CACpD,CAAC,CACAU,GAAG,CAAE,CAAE;MAAE8C,IAAI;MAAExD;IAAK,CAAC,MAAQ;MAAExD,KAAK,EAAEwD,IAAI;MAAEtD,KAAK,EAAE8G;IAAK,CAAC,CAAG,CAAC;EAChE;EAEA,SAASC,gBAAgBA,CAAEC,WAAW,EAAG;IACxC,MAAMC,aAAa,GAAG,CAAE1F,MAAM,aAANA,MAAM,cAANA,MAAM,GAAI,EAAE,EAAGyC,GAAG,CAAIf,KAAK,IAAM;MACxD,IAAK,CAAEA,KAAK,CAACD,EAAE,EAAG;QACjB,OAAOC,KAAK;MACb;MACA,MAAMM,GAAG,GACRb,aAAa,CAAEiB,QAAQ,CAAEV,KAAK,CAACD,EAAE,EAAE,EAAG,CAAC,CAAE,GAAIgE,WAAW,CAAE;MAC3D,OAAO;QACN,GAAG/D,KAAK;QACR,IAAKM,GAAG,IAAI;UAAEA;QAAI,CAAC;MACpB,CAAC;IACF,CAAE,CAAC;IAEHM,aAAa,CAAE;MAAEtC,MAAM,EAAE0F,aAAa;MAAExF,QAAQ,EAAEuF;IAAY,CAAE,CAAC;EAClE;EAEA,IAAAE,kBAAS,EAAE,MAAM;IAChB,IACC5G,iBAAQ,CAAC6G,EAAE,KAAK,KAAK,IACrB5F,MAAM,IACNA,MAAM,CAACmD,MAAM,GAAG,CAAC,IACjBnD,MAAM,CAAC6F,KAAK,CAAE,CAAE;MAAE7D;IAAI,CAAC,KAAM,IAAA8D,eAAS,EAAE9D,GAAI,CAAE,CAAC,EAC9C;MACD,MAAM+D,SAAS,GAAG/F,MAAM,CAACyC,GAAG,CAAE,CAAE;QAAET;MAAI,CAAC,KAAM,IAAAgE,kBAAY,EAAEhE,GAAI,CAAE,CAAC;MAClEhC,MAAM,CAACiG,OAAO,CAAE,CAAE;QAAEjE;MAAI,CAAC,KAAM,IAAAkE,mBAAa,EAAElE,GAAI,CAAE,CAAC;MACrDpB,WAAW,CAAE;QACZmF,SAAS;QACTI,YAAY,EAAE/B,cAAc;QAC5BgC,YAAY,EAAE,CAAE,OAAO;MACxB,CAAE,CAAC;IACJ;EACD,CAAC,EAAE,EAAG,CAAC;EAEP,IAAAT,kBAAS,EAAE,MAAM;IAChB;IACA,IAAK,CAAElG,UAAU,EAAG;MACnBW,gBAAgB,CAAC,CAAC;IACnB;EACD,CAAC,EAAE,CAAEX,UAAU,CAAG,CAAC;EAEnB,IAAAkG,kBAAS,EAAE,MAAM;IAChB;IACA;IACA,IAAK,CAAE1F,MAAM,EAAG;MACfO,uCAAuC,CAAC,CAAC;MACzC8B,aAAa,CAAE;QACdrC,MAAM,EACLoG,MAAM,EAAEC,EAAE,EAAEC,KAAK,EAAEC,IAAI,EAAExF,QAAQ,EAAEyF,YAAY,EAAEC,IAAI,IACrD9H;MACF,CAAE,CAAC;IACJ;EACD,CAAC,EAAE,CAAEqB,MAAM,CAAG,CAAC;EAEf,MAAM0G,SAAS,GAAG,CAAC,CAAE3G,MAAM,CAACmD,MAAM;EAClC,MAAMyD,WAAW,GAAGD,SAAS,IAAI3G,MAAM,CAACsF,IAAI,CAAI5D,KAAK,IAAM,CAAC,CAAEA,KAAK,CAACD,EAAG,CAAC;EAExE,MAAMoF,gBAAgB,GACrB,IAAAC,MAAA,CAAAC,aAAA,EAACxJ,YAAA,CAAAyJ,gBAAgB;IAChBC,YAAY,EAAGL,WAAa;IAC5BM,UAAU,EAAGP,SAAW;IACxBQ,mBAAmB,EAAGR,SAAS,IAAI,CAAElH,UAAY;IACjD2H,IAAI,EAAG,CAAET,SAAS,IAAIU,sBAAY;IAClCC,MAAM,EAAG;MACRC,KAAK,EAAE,CAAEZ,SAAS,IAAI,IAAAjI,QAAE,EAAE,SAAU,CAAC;MACrC8I,YAAY,EAAE,CAAEb,SAAS,IAAI7H;IAC9B,CAAG;IACH2I,QAAQ,EAAGrD,cAAgB;IAC3BsD,MAAM,EAAC,SAAS;IAChBtB,YAAY,EAAGvH,mBAAqB;IACpC8I,QAAQ;IACRpJ,KAAK,EAAGqI,WAAW,GAAG5G,MAAM,GAAG,CAAC,CAAG;IACnC4H,OAAO,EAAGtD,aAAe;IACzBuD,OAAO,EAAGlB,SAAS,GAAGmB,SAAS,GAAGpI,QAAU;IAC5CE,OAAO,EAAGA,OAAS;IACnBmI,mBAAmB,EAClB,CAAEpB,SAAS,IAAIlH,UAAU,IAAIqB;EAC7B,CACD,CACD;EAED,MAAMkH,UAAU,GAAG,IAAAC,0BAAa,EAAC,CAAC;EAElC,IAAK,CAAEtB,SAAS,EAAG;IAClB,OAAO,IAAAG,MAAA,CAAAC,aAAA,EAAClJ,WAAA,CAAAqK,IAAI;MAAA,GAAMF;IAAU,GAAKnB,gBAAwB,CAAC;EAC3D;EAEA,MAAMsB,gBAAgB,GAAGjD,oBAAoB,CAAC,CAAC;EAC/C,MAAMkD,qBAAqB,GAAGzB,SAAS,IAAIwB,gBAAgB,CAAChF,MAAM,GAAG,CAAC;EAEtE,OACC,IAAA2D,MAAA,CAAAC,aAAA,EAAAD,MAAA,CAAAuB,QAAA,QACC,IAAAvB,MAAA,CAAAC,aAAA,EAACxJ,YAAA,CAAA+K,iBAAiB,QACjB,IAAAxB,MAAA,CAAAC,aAAA,EAACzJ,WAAA,CAAAiL,SAAS;IAAChB,KAAK,EAAG,IAAA7I,QAAE,EAAE,UAAW;EAAG,GAClCsB,MAAM,CAACmD,MAAM,GAAG,CAAC,IAClB,IAAA2D,MAAA,CAAAC,aAAA,EAACzJ,WAAA,CAAAkL,YAAY;IACZC,uBAAuB;IACvBhK,KAAK,EAAG,IAAAC,QAAE,EAAE,SAAU,CAAG;IACzBH,KAAK,EAAGsB,OAAS;IACjB6I,QAAQ,EAAG/D,gBAAkB;IAC7BjB,GAAG,EAAG,CAAG;IACTiF,GAAG,EAAGlF,IAAI,CAACC,GAAG,CAAErF,WAAW,EAAE2B,MAAM,CAACmD,MAAO,CAAG;IAAA,GACzChE,kCAAkC;IACvCyJ,QAAQ;EAAA,CACR,CACD,EACD,IAAA9B,MAAA,CAAAC,aAAA,EAACzJ,WAAA,CAAAuL,aAAa;IACbJ,uBAAuB;IACvBhK,KAAK,EAAG,IAAAC,QAAE,EAAE,aAAc,CAAG;IAC7BoG,OAAO,EAAG,CAAC,CAAE/E,SAAW;IACxB2I,QAAQ,EAAG9D,eAAiB;IAC5BkE,IAAI,EAAGjE;EAAkB,CACzB,CAAC,EACF,IAAAiC,MAAA,CAAAC,aAAA,EAACzJ,WAAA,CAAAyL,aAAa;IACbN,uBAAuB;IACvBhK,KAAK,EAAG,IAAAC,QAAE,EAAE,SAAU,CAAG;IACzBH,KAAK,EAAG0B,MAAQ;IAChByI,QAAQ,EAAGhE,SAAW;IACtBsE,OAAO,EAAG1K,WAAa;IACvB2K,gBAAgB,EAAG;EAAM,CACzB,CAAC,EACAb,qBAAqB,IACtB,IAAAtB,MAAA,CAAAC,aAAA,EAACzJ,WAAA,CAAAyL,aAAa;IACbN,uBAAuB;IACvBhK,KAAK,EAAG,IAAAC,QAAE,EAAE,YAAa,CAAG;IAC5BH,KAAK,EAAG2B,QAAU;IAClB8I,OAAO,EAAGb,gBAAkB;IAC5BO,QAAQ,EAAGlD,gBAAkB;IAC7ByD,gBAAgB,EAAG;EAAM,CACzB,CAEQ,CACO,CAAC,EAClBvJ,QAAQ,EACV,IAAAoH,MAAA,CAAAC,aAAA,EAAC7I,QAAA,CAAAgL,OAAO;IAAA,GACF5J,KAAK;IACVa,aAAa,EAAGA,aAAe;IAC/B0G,gBAAgB,EAAGA,gBAAkB;IACrCzD,cAAc,EAAGA,cAAgB;IACjCF,aAAa,EAAGA,aAAe;IAC/BG,aAAa,EAAGA,aAAe;IAC/BX,aAAa,EAAGA,aAAe;IAC/BE,eAAe,EAAGA,eAAiB;IACnCuG,oBAAoB,EAAGpE,kBAAoB;IAC3CiD,UAAU,EAAGA;IACb;IAAA;IACA3F,qBAAqB,EAAGA;EAAuB,CAC/C,CACA,CAAC;AAEL;AAAC,IAAA+G,QAAA,GAAAC,OAAA,CAAAH,OAAA,GAEc,IAAAI,gBAAO,EAAE,CACvBC,uBAAW,EACX,IAAAC,2BAAiB,EAAE;EAAEC,QAAQ,EAAE;AAAU,CAAE,CAAC,CAC3C,CAAC,CAAEpK,WAAY,CAAC"}