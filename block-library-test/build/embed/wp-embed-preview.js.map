{"version":3,"names":["_compose","require","_element","attributeMap","class","frameborder","marginheight","marginwidth","WpEmbedPreview","html","ref","useRef","props","useMemo","doc","window","DOMParser","parseFromString","iframe","querySelector","iframeProps","Array","from","attributes","forEach","name","value","useEffect","ownerDocument","current","defaultView","resizeWPembeds","data","secret","message","height","addEventListener","removeEventListener","_react","createElement","className","useMergeRefs","useFocusableIframe","title"],"sources":["@wordpress/block-library/src/embed/wp-embed-preview.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useMergeRefs, useFocusableIframe } from '@wordpress/compose';\nimport { useRef, useEffect, useMemo } from '@wordpress/element';\n\n/** @typedef {import('react').SyntheticEvent} SyntheticEvent */\n\nconst attributeMap = {\n\tclass: 'className',\n\tframeborder: 'frameBorder',\n\tmarginheight: 'marginHeight',\n\tmarginwidth: 'marginWidth',\n};\n\nexport default function WpEmbedPreview( { html } ) {\n\tconst ref = useRef();\n\tconst props = useMemo( () => {\n\t\tconst doc = new window.DOMParser().parseFromString( html, 'text/html' );\n\t\tconst iframe = doc.querySelector( 'iframe' );\n\t\tconst iframeProps = {};\n\n\t\tif ( ! iframe ) return iframeProps;\n\n\t\tArray.from( iframe.attributes ).forEach( ( { name, value } ) => {\n\t\t\tif ( name === 'style' ) return;\n\t\t\tiframeProps[ attributeMap[ name ] || name ] = value;\n\t\t} );\n\n\t\treturn iframeProps;\n\t}, [ html ] );\n\n\tuseEffect( () => {\n\t\tconst { ownerDocument } = ref.current;\n\t\tconst { defaultView } = ownerDocument;\n\n\t\t/**\n\t\t * Checks for WordPress embed events signaling the height change when\n\t\t * iframe content loads or iframe's window is resized.  The event is\n\t\t * sent from WordPress core via the window.postMessage API.\n\t\t *\n\t\t * References:\n\t\t * window.postMessage:\n\t\t * https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\n\t\t * WordPress core embed-template on load:\n\t\t * https://github.com/WordPress/WordPress/blob/HEAD/wp-includes/js/wp-embed-template.js#L143\n\t\t * WordPress core embed-template on resize:\n\t\t * https://github.com/WordPress/WordPress/blob/HEAD/wp-includes/js/wp-embed-template.js#L187\n\t\t *\n\t\t * @param {MessageEvent} event Message event.\n\t\t */\n\t\tfunction resizeWPembeds( { data: { secret, message, value } = {} } ) {\n\t\t\tif ( message !== 'height' || secret !== props[ 'data-secret' ] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tref.current.height = value;\n\t\t}\n\n\t\tdefaultView.addEventListener( 'message', resizeWPembeds );\n\t\treturn () => {\n\t\t\tdefaultView.removeEventListener( 'message', resizeWPembeds );\n\t\t};\n\t}, [] );\n\n\treturn (\n\t\t<div className=\"wp-block-embed__wrapper\">\n\t\t\t<iframe\n\t\t\t\tref={ useMergeRefs( [ ref, useFocusableIframe() ] ) }\n\t\t\t\ttitle={ props.title }\n\t\t\t\t{ ...props }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n"],"mappings":";;;;;;;AAGA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAJA;AACA;AACA;;AAIA;;AAEA,MAAME,YAAY,GAAG;EACpBC,KAAK,EAAE,WAAW;EAClBC,WAAW,EAAE,aAAa;EAC1BC,YAAY,EAAE,cAAc;EAC5BC,WAAW,EAAE;AACd,CAAC;AAEc,SAASC,cAAcA,CAAE;EAAEC;AAAK,CAAC,EAAG;EAClD,MAAMC,GAAG,GAAG,IAAAC,eAAM,EAAC,CAAC;EACpB,MAAMC,KAAK,GAAG,IAAAC,gBAAO,EAAE,MAAM;IAC5B,MAAMC,GAAG,GAAG,IAAIC,MAAM,CAACC,SAAS,CAAC,CAAC,CAACC,eAAe,CAAER,IAAI,EAAE,WAAY,CAAC;IACvE,MAAMS,MAAM,GAAGJ,GAAG,CAACK,aAAa,CAAE,QAAS,CAAC;IAC5C,MAAMC,WAAW,GAAG,CAAC,CAAC;IAEtB,IAAK,CAAEF,MAAM,EAAG,OAAOE,WAAW;IAElCC,KAAK,CAACC,IAAI,CAAEJ,MAAM,CAACK,UAAW,CAAC,CAACC,OAAO,CAAE,CAAE;MAAEC,IAAI;MAAEC;IAAM,CAAC,KAAM;MAC/D,IAAKD,IAAI,KAAK,OAAO,EAAG;MACxBL,WAAW,CAAEjB,YAAY,CAAEsB,IAAI,CAAE,IAAIA,IAAI,CAAE,GAAGC,KAAK;IACpD,CAAE,CAAC;IAEH,OAAON,WAAW;EACnB,CAAC,EAAE,CAAEX,IAAI,CAAG,CAAC;EAEb,IAAAkB,kBAAS,EAAE,MAAM;IAChB,MAAM;MAAEC;IAAc,CAAC,GAAGlB,GAAG,CAACmB,OAAO;IACrC,MAAM;MAAEC;IAAY,CAAC,GAAGF,aAAa;;IAErC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACE,SAASG,cAAcA,CAAE;MAAEC,IAAI,EAAE;QAAEC,MAAM;QAAEC,OAAO;QAAER;MAAM,CAAC,GAAG,CAAC;IAAE,CAAC,EAAG;MACpE,IAAKQ,OAAO,KAAK,QAAQ,IAAID,MAAM,KAAKrB,KAAK,CAAE,aAAa,CAAE,EAAG;QAChE;MACD;MAEAF,GAAG,CAACmB,OAAO,CAACM,MAAM,GAAGT,KAAK;IAC3B;IAEAI,WAAW,CAACM,gBAAgB,CAAE,SAAS,EAAEL,cAAe,CAAC;IACzD,OAAO,MAAM;MACZD,WAAW,CAACO,mBAAmB,CAAE,SAAS,EAAEN,cAAe,CAAC;IAC7D,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,OACC,IAAAO,MAAA,CAAAC,aAAA;IAAKC,SAAS,EAAC;EAAyB,GACvC,IAAAF,MAAA,CAAAC,aAAA;IACC7B,GAAG,EAAG,IAAA+B,qBAAY,EAAE,CAAE/B,GAAG,EAAE,IAAAgC,2BAAkB,EAAC,CAAC,CAAG,CAAG;IACrDC,KAAK,EAAG/B,KAAK,CAAC+B,KAAO;IAAA,GAChB/B;EAAK,CACV,CACG,CAAC;AAER"}