{"version":3,"names":["_reactNative","require","_native","_element","_reactNativeBridge","_components","_blockEditor","_i18n","_url","_hooks","_compose","_data","_icons","_coreData","_notices","_editPost","_styles","_interopRequireDefault","_utils","_constants","getUrlForSlug","image","sizeSlug","undefined","media_details","sizes","source_url","LinkSettings","attributes","isLinkSheetVisible","setMappedAttributes","route","useRoute","href","url","label","linkDestination","linkTarget","rel","useEffect","inputValue","newUrl","params","newLinkDestination","LINK_DESTINATION_MEDIA","link","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_NONE","LINK_DESTINATION_CUSTOM","valueMask","__","linkSettingsOptions","autoFocus","autoFill","openInNewTab","linkRel","placeholder","_x","_react","createElement","PanelBody","title","LinkSettingsNavigation","isVisible","setAttributes","withBottomSheet","hasPicker","options","showIcon","onLinkCellPressed","navigation","navigate","blockSettingsScreens","imageLinkDestinations","imageUrl","attachmentPageUrl","UPLOAD_STATE_IDLE","UPLOAD_STATE_UPLOADING","UPLOAD_STATE_SUCCEEDED","UPLOAD_STATE_FAILED","ImageEdit","Component","constructor","props","state","isCaptionSelected","uploadStatus","replacedFeaturedImage","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateImageURL","onSetNewTab","onSetSizeSlug","onImagePressed","onSetFeatured","onFocusCaption","onSelectURL","accessibilityLabelCreator","onSizeChangeValue","componentDidMount","id","console","warn","getProtocol","requestMediaImport","mediaUploadSync","componentWillUnmount","hasAction","doAction","componentDidUpdate","previousProps","featuredImageId","hasQueryArg","updatedUrl","previousId","canImageBeFeatured","setFeaturedImage","align","__unstableMarkNextChangeAsNotPersistent","includes","width","height","aspectRatio","scale","getDerivedStateFromProps","isSelected","caption","RichText","isEmpty","sprintf","requestImageUploadCancelDialog","requestImageFailedRetryDialog","requestImageFullscreenPreview","setState","payload","mediaUrl","mediaServerId","mediaId","value","updatedLinkTarget","getUpdatedLinkTargetSettings","media","imageDefaultSize","destination","mediaAttributes","alt","additionalAttributes","newURL","createErrorNotice","isURL","isFetchingImage","RNImage","getSize","onFocus","getPlaceholderIcon","Icon","icon","placeholderIcon","getStylesFromColorScheme","styles","iconPlaceholder","iconPlaceholderDark","showLoadingIndicator","View","style","image__loading","ActivityIndicator","animating","getWidth","Object","values","WIDE_ALIGNMENTS","alignments","restAttributes","getAltTextSettings","updateAlt","newAlt","BottomSheetTextControl","initialValue","onChange","textColor","footerNote","Fragment","FooterMessageLink","newValue","closeSettingsBottomSheet","getFeaturedButtonPanel","isFeaturedImage","setFeaturedButtonStyle","setFeaturedButton","setFeaturedButtonDark","removeFeaturedButton","BottomSheet","Cell","labelStyle","cellContainerStyle","setFeaturedButtonCellContainer","separatorType","onPress","MEDIA_ID_NO_FEATURED_IMAGE_SET","isGif","toLowerCase","render","clientId","context","wasBlockJustInserted","shouldUseFastImage","className","hasImageContext","keys","length","imageSizes","Array","isArray","sizeOptions","filter","slug","map","name","selectedSizeOption","sizeOptionsValid","find","option","getToolbarEditButton","open","BlockControls","ToolbarGroup","ToolbarButton","replace","onClick","getInspectorControls","InspectorControls","panelBody","BlockStyles","BottomSheetSelectControl","fullscreen","titleStyle","featuredImagePanelTitle","FooterMessageControl","content","MediaPlaceholder","allowedTypes","MEDIA_TYPE_IMAGE","onSelect","autoOpenMediaUpload","alignToFlex","left","center","right","full","wide","additionalImageProps","resizeMode","imageCrop","imageContainerStyles","fixedHeight","badgeLabelShown","badgeLabelText","getImageComponent","openMediaOptions","getMediaOptions","Badge","show","TouchableWithoutFeedback","accessible","disabled","MediaUploadProgress","enablePausedUploads","coverUrl","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","onFinishMediaUploadWithFailure","onMediaUploadStateReset","renderContent","isUploadPaused","isUploadInProgress","isUploadFailed","retryMessage","Image","shapeStyle","BlockCaption","onBlur","insertBlocksAfter","MediaUpload","isReplacingMedia","exports","_default","default","compose","withSelect","select","getMedia","coreStore","getSettings","blockEditorStore","getEditedPostAttribute","capabilities","isNotFileUrl","shouldGetMedia","withDispatch","dispatch","noticesStore","editPostStore","closeGeneralSidebar","withPreferredColorScheme"],"sources":["@wordpress/block-library/src/image/edit.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tActivityIndicator,\n\tImage as RNImage,\n\tTouchableWithoutFeedback,\n\tView,\n} from 'react-native';\nimport { useRoute } from '@react-navigation/native';\n\n/**\n * WordPress dependencies\n */\nimport { Component, useEffect } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n\tsetFeaturedImage,\n} from '@wordpress/react-native-bridge';\nimport {\n\tIcon,\n\tPanelBody,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n\tBottomSheet,\n\tBottomSheetTextControl,\n\tBottomSheetSelectControl,\n\tFooterMessageControl,\n\tFooterMessageLink,\n\tBadge,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockStyles,\n\tstore as blockEditorStore,\n\tblockSettingsScreens,\n\tRichText,\n} from '@wordpress/block-editor';\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg, isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\treplace,\n\tfullscreen,\n\ttextColor,\n} from '@wordpress/icons';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as noticesStore } from '@wordpress/notices';\n// eslint-disable-next-line no-restricted-imports\nimport { store as editPostStore } from '@wordpress/edit-post';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport {\n\tLINK_DESTINATION_NONE,\n\tLINK_DESTINATION_CUSTOM,\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tMEDIA_ID_NO_FEATURED_IMAGE_SET,\n} from './constants';\n\nconst getUrlForSlug = ( image, sizeSlug ) => {\n\tif ( ! sizeSlug ) {\n\t\treturn undefined;\n\t}\n\treturn image?.media_details?.sizes?.[ sizeSlug ]?.source_url;\n};\n\nfunction LinkSettings( {\n\tattributes,\n\timage,\n\tisLinkSheetVisible,\n\tsetMappedAttributes,\n} ) {\n\tconst route = useRoute();\n\tconst { href: url, label, linkDestination, linkTarget, rel } = attributes;\n\n\t// Persist attributes passed from child screen.\n\tuseEffect( () => {\n\t\tconst { inputValue: newUrl } = route.params || {};\n\n\t\tlet newLinkDestination;\n\t\tswitch ( newUrl ) {\n\t\t\tcase attributes.url:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_MEDIA;\n\t\t\t\tbreak;\n\t\t\tcase image?.link:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_ATTACHMENT;\n\t\t\t\tbreak;\n\t\t\tcase '':\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_NONE;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tsetMappedAttributes( {\n\t\t\turl: newUrl,\n\t\t\tlinkDestination: newLinkDestination,\n\t\t} );\n\t}, [ route.params?.inputValue ] );\n\n\tlet valueMask;\n\tswitch ( linkDestination ) {\n\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\tvalueMask = __( 'Media File' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\tvalueMask = __( 'Attachment Page' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_CUSTOM:\n\t\t\tvalueMask = __( 'Custom URL' );\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tvalueMask = __( 'None' );\n\t\t\tbreak;\n\t}\n\n\tconst linkSettingsOptions = {\n\t\turl: {\n\t\t\tvalueMask,\n\t\t\tautoFocus: false,\n\t\t\tautoFill: false,\n\t\t},\n\t\topenInNewTab: {\n\t\t\tlabel: __( 'Open in new tab' ),\n\t\t},\n\t\tlinkRel: {\n\t\t\tlabel: __( 'Link Rel' ),\n\t\t\tplaceholder: _x( 'None', 'Link rel attribute value placeholder' ),\n\t\t},\n\t};\n\n\treturn (\n\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\turl={ url }\n\t\t\t\trel={ rel }\n\t\t\t\tlabel={ label }\n\t\t\t\tlinkTarget={ linkTarget }\n\t\t\t\tsetAttributes={ setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ linkSettingsOptions }\n\t\t\t\tshowIcon={ false }\n\t\t\t\tonLinkCellPressed={ ( { navigation } ) => {\n\t\t\t\t\tnavigation.navigate(\n\t\t\t\t\t\tblockSettingsScreens.imageLinkDestinations,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinputValue: attributes.href,\n\t\t\t\t\t\t\tlinkDestination: attributes.linkDestination,\n\t\t\t\t\t\t\timageUrl: attributes.url,\n\t\t\t\t\t\t\tattachmentPageUrl: image?.link,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t</PanelBody>\n\t);\n}\n\nconst UPLOAD_STATE_IDLE = 0;\nconst UPLOAD_STATE_UPLOADING = 1;\nconst UPLOAD_STATE_SUCCEEDED = 2;\nconst UPLOAD_STATE_FAILED = 3;\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t\tuploadStatus: UPLOAD_STATE_IDLE,\n\t\t};\n\n\t\tthis.replacedFeaturedImage = false;\n\n\t\tthis.finishMediaUploadWithSuccess =\n\t\t\tthis.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure =\n\t\t\tthis.finishMediaUploadWithFailure.bind( this );\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption =\n\t\t\tthis.onSelectMediaUploadOption.bind( this );\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onSetFeatured = this.onSetFeatured.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.accessibilityLabelCreator =\n\t\t\tthis.accessibilityLabelCreator.bind( this );\n\t\tthis.setMappedAttributes = this.setMappedAttributes.bind( this );\n\t\tthis.onSizeChangeValue = this.onSizeChangeValue.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload.\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open.\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// This action will only exist if the user pressed the trash button on the block holder.\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.uploadStatus === UPLOAD_STATE_UPLOADING\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tconst { image, attributes, setAttributes, featuredImageId } =\n\t\t\tthis.props;\n\t\tconst { url } = attributes;\n\t\tif ( ! previousProps.image && image ) {\n\t\t\tif ( ! hasQueryArg( url, 'w' ) && attributes?.sizeSlug ) {\n\t\t\t\tconst updatedUrl =\n\t\t\t\t\tgetUrlForSlug( image, attributes.sizeSlug ) ||\n\t\t\t\t\timage.source_url;\n\n\t\t\t\tsetAttributes( { url: updatedUrl } );\n\t\t\t}\n\t\t}\n\n\t\tconst { id } = attributes;\n\t\tconst { id: previousId } = previousProps.attributes;\n\n\t\t// The media changed and the previous media was set as the Featured Image,\n\t\t// we must keep track of the previous media's featured status to act on it\n\t\t// once the new media has a finalized ID.\n\t\tif (\n\t\t\t!! id &&\n\t\t\tid !== previousId &&\n\t\t\t!! featuredImageId &&\n\t\t\tfeaturedImageId === previousId\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = true;\n\t\t}\n\n\t\t// The media changed and now has a finalized ID (e.g. upload completed), we\n\t\t// should attempt to replace the featured image if applicable.\n\t\tif (\n\t\t\tthis.replacedFeaturedImage &&\n\t\t\t!! image &&\n\t\t\tthis.canImageBeFeatured()\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = false;\n\t\t\tsetFeaturedImage( id );\n\t\t}\n\n\t\tconst { align } = attributes;\n\t\tconst { __unstableMarkNextChangeAsNotPersistent } = this.props;\n\n\t\t// Update the attributes if the align is wide or full\n\t\tif ( [ 'wide', 'full' ].includes( align ) ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\taspectRatio: undefined,\n\t\t\t\tscale: undefined,\n\t\t\t} );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false.\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\t// Checks if caption is empty.\n\t\treturn RichText.isEmpty( caption )\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.uploadStatus === UPLOAD_STATE_UPLOADING ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( this.state.uploadStatus !== UPLOAD_STATE_UPLOADING ) {\n\t\t\tthis.setState( { uploadStatus: UPLOAD_STATE_UPLOADING } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_SUCCEEDED } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_FAILED } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_IDLE } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image, setAttributes } = this.props;\n\n\t\tconst url = getUrlForSlug( image, sizeSlug );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\t\tsetAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { imageDefaultSize } = this.props;\n\t\tconst { id, url, destination } = this.props.attributes;\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t\talt: media.alt,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tlet href;\n\t\tswitch ( destination ) {\n\t\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\t\thref = media.url;\n\t\t\t\tbreak;\n\t\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\t\thref = media.link;\n\t\t\t\tbreak;\n\t\t}\n\t\tmediaAttributes.href = href;\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonSelectURL( newURL ) {\n\t\tconst { createErrorNotice, imageDefaultSize, setAttributes } =\n\t\t\tthis.props;\n\n\t\tif ( isURL( newURL ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tisFetchingImage: true,\n\t\t\t} );\n\n\t\t\t// Use RN's Image.getSize to determine if URL is a valid image\n\t\t\tRNImage.getSize(\n\t\t\t\tnewURL,\n\t\t\t\t() => {\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\turl: newURL,\n\t\t\t\t\t\tid: undefined,\n\t\t\t\t\t\twidth: undefined,\n\t\t\t\t\t\theight: undefined,\n\t\t\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tcreateErrorNotice( __( 'Image file not found.' ) );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tcreateErrorNotice( __( 'Invalid URL.' ) );\n\t\t}\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tshowLoadingIndicator() {\n\t\treturn (\n\t\t\t<View style={ styles.image__loading }>\n\t\t\t\t<ActivityIndicator animating />\n\t\t\t</View>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tsetMappedAttributes( { url: href, linkDestination, ...restAttributes } ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( ! href && ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_NONE;\n\t\t} else if ( ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t}\n\n\t\treturn href === undefined || href === this.props.attributes.href\n\t\t\t? setAttributes( restAttributes )\n\t\t\t: setAttributes( {\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\tlinkDestination,\n\t\t\t\t\thref,\n\t\t\t  } );\n\t}\n\n\tgetAltTextSettings() {\n\t\tconst {\n\t\t\tattributes: { alt },\n\t\t} = this.props;\n\n\t\tconst updateAlt = ( newAlt ) => {\n\t\t\tthis.props.setAttributes( { alt: newAlt } );\n\t\t};\n\n\t\treturn (\n\t\t\t<BottomSheetTextControl\n\t\t\t\tinitialValue={ alt }\n\t\t\t\tonChange={ updateAlt }\n\t\t\t\tplaceholder={ __( 'Add alt text' ) }\n\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\ticon={ textColor }\n\t\t\t\tfooterNote={\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Describe the purpose of the image. Leave empty if decorative.'\n\t\t\t\t\t\t) }{ ' ' }\n\t\t\t\t\t\t<FooterMessageLink\n\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue={ __( 'What is alt text?' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonSizeChangeValue( newValue ) {\n\t\tthis.onSetSizeSlug( newValue );\n\t}\n\n\tonSetFeatured( mediaId ) {\n\t\tconst { closeSettingsBottomSheet } = this.props;\n\t\tsetFeaturedImage( mediaId );\n\t\tcloseSettingsBottomSheet();\n\t}\n\n\tgetFeaturedButtonPanel( isFeaturedImage ) {\n\t\tconst { attributes, getStylesFromColorScheme } = this.props;\n\n\t\tconst setFeaturedButtonStyle = getStylesFromColorScheme(\n\t\t\tstyles.setFeaturedButton,\n\t\t\tstyles.setFeaturedButtonDark\n\t\t);\n\n\t\tconst removeFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Remove as Featured Image' ) }\n\t\t\t\tlabelStyle={ [\n\t\t\t\t\tsetFeaturedButtonStyle,\n\t\t\t\t\tstyles.removeFeaturedButton,\n\t\t\t\t] }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () =>\n\t\t\t\t\tthis.onSetFeatured( MEDIA_ID_NO_FEATURED_IMAGE_SET )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\n\t\tconst setFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Set as Featured Image' ) }\n\t\t\t\tlabelStyle={ setFeaturedButtonStyle }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () => this.onSetFeatured( attributes.id ) }\n\t\t\t/>\n\t\t);\n\n\t\treturn isFeaturedImage ? removeFeaturedButton() : setFeaturedButton();\n\t}\n\n\t/**\n\t * Featured images must be set to a successfully uploaded self-hosted image,\n\t * which has an ID.\n\t *\n\t * @return {boolean} Boolean indicating whether or not the current may be set as featured.\n\t */\n\tcanImageBeFeatured() {\n\t\tconst {\n\t\t\tattributes: { id },\n\t\t} = this.props;\n\t\treturn (\n\t\t\ttypeof id !== 'undefined' &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_UPLOADING &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_FAILED\n\t\t);\n\t}\n\n\tisGif( url ) {\n\t\treturn url.toLowerCase().includes( '.gif' );\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected, isFetchingImage } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\tclientId,\n\t\t\timageDefaultSize,\n\t\t\tcontext,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted,\n\t\t\tshouldUseFastImage,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\t\tconst hasImageContext = context\n\t\t\t? Object.keys( context ).length > 0\n\t\t\t: false;\n\n\t\tconst imageSizes = Array.isArray( this.props.imageSizes )\n\t\t\t? this.props.imageSizes\n\t\t\t: [];\n\t\t// Only map available image sizes for the user to choose.\n\t\tconst sizeOptions = imageSizes\n\t\t\t.filter( ( { slug } ) => getUrlForSlug( image, slug ) )\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\n\t\tlet selectedSizeOption = sizeSlug || imageDefaultSize;\n\t\tlet sizeOptionsValid = sizeOptions.find(\n\t\t\t( option ) => option.value === selectedSizeOption\n\t\t);\n\n\t\tif ( ! sizeOptionsValid ) {\n\t\t\t// Default to 'full' size if the default large size is not available.\n\t\t\tsizeOptionsValid = sizeOptions.find(\n\t\t\t\t( option ) => option.value === 'full'\n\t\t\t);\n\t\t\tselectedSizeOption = 'full';\n\t\t}\n\n\t\tconst canImageBeFeatured = this.canImageBeFeatured();\n\t\tconst isFeaturedImage =\n\t\t\tcanImageBeFeatured && featuredImageId === attributes.id;\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<BottomSheetSelectControl\n\t\t\t\t\t\t\ticon={ fullscreen }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t\tonChange={ this.onSizeChangeValue }\n\t\t\t\t\t\t\tvalue={ selectedSizeOption }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ this.getAltTextSettings() }\n\t\t\t\t</PanelBody>\n\t\t\t\t<LinkSettings\n\t\t\t\t\tattributes={ this.props.attributes }\n\t\t\t\t\timage={ this.props.image }\n\t\t\t\t\tisLinkSheetVisible={ this.state.isLinkSheetVisible }\n\t\t\t\t\tsetMappedAttributes={ this.setMappedAttributes }\n\t\t\t\t/>\n\t\t\t\t<PanelBody\n\t\t\t\t\ttitle={ __( 'Featured Image' ) }\n\t\t\t\t\ttitleStyle={ styles.featuredImagePanelTitle }\n\t\t\t\t>\n\t\t\t\t\t{ canImageBeFeatured &&\n\t\t\t\t\t\tthis.getFeaturedButtonPanel( isFeaturedImage ) }\n\t\t\t\t\t<FooterMessageControl\n\t\t\t\t\t\tlabel={ __(\n\t\t\t\t\t\t\t'Changes to featured image will not be affected by the undo/redo buttons.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tcellContainerStyle={\n\t\t\t\t\t\t\tstyles.setFeaturedButtonCellContainer\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t{ isFetchingImage && this.showLoadingIndicator() }\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t\tautoOpenMediaUpload={\n\t\t\t\t\t\t\tisSelected && wasBlockJustInserted\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst additionalImageProps = {\n\t\t\theight: '100%',\n\t\t\tresizeMode: context?.imageCrop ? 'cover' : 'contain',\n\t\t};\n\n\t\tconst imageContainerStyles = [\n\t\t\tcontext?.fixedHeight && styles.fixedHeight,\n\t\t];\n\n\t\tconst isGif = this.isGif( url );\n\t\tconst badgeLabelShown = isFeaturedImage || isGif;\n\t\tlet badgeLabelText = '';\n\t\tif ( isFeaturedImage ) {\n\t\t\tbadgeLabelText = __( 'Featured' );\n\t\t} else if ( isGif ) {\n\t\t\tbadgeLabelText = __( 'GIF' );\n\t\t}\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<Badge label={ badgeLabelText } show={ badgeLabelShown }>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ isSelected && getInspectorControls() }\n\t\t\t\t\t\t{ isSelected && getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tenablePausedUploads\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadPaused,\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<View style={ imageContainerStyles }>\n\t\t\t\t\t\t\t\t\t\t{ isFetchingImage &&\n\t\t\t\t\t\t\t\t\t\t\tthis.showLoadingIndicator() }\n\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\talign={\n\t\t\t\t\t\t\t\t\t\t\t\talign && alignToFlex[ align ]\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected &&\n\t\t\t\t\t\t\t\t\t\t\t\t! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\t\tisUploadPaused={ isUploadPaused }\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage={\n\t\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topenMediaOptions={\n\t\t\t\t\t\t\t\t\t\t\t\topenMediaOptions\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\t\tshapeStyle={\n\t\t\t\t\t\t\t\t\t\t\t\tstyles[ className ] || className\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t\t\t{ ...( hasImageContext\n\t\t\t\t\t\t\t\t\t\t\t\t? additionalImageProps\n\t\t\t\t\t\t\t\t\t\t\t\t: {} ) }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible={ ! this.state.isCaptionSelected }\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // Always assign onBlur as props.\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</Badge>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia={ true }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( coreStore );\n\t\tconst { getSettings, wasBlockJustInserted } =\n\t\t\tselect( blockEditorStore );\n\t\tconst { getEditedPostAttribute } = select( 'core/editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t\tclientId,\n\t\t} = props;\n\t\tconst { imageSizes, imageDefaultSize, capabilities } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\t\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams.\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\t\tconst image = shouldGetMedia ? getMedia( id ) : null;\n\n\t\treturn {\n\t\t\timage,\n\t\t\timageSizes,\n\t\t\timageDefaultSize,\n\t\t\tshouldUseFastImage: capabilities?.shouldUseFastImage === true,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted: wasBlockJustInserted(\n\t\t\t\tclientId,\n\t\t\t\t'inserter_menu'\n\t\t\t),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createErrorNotice } = dispatch( noticesStore );\n\t\tconst { __unstableMarkNextChangeAsNotPersistent } =\n\t\t\tdispatch( blockEditorStore );\n\n\t\treturn {\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tcreateErrorNotice,\n\t\t\tcloseSettingsBottomSheet() {\n\t\t\t\tdispatch( editPostStore ).closeGeneralSidebar();\n\t\t\t},\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"],"mappings":";;;;;;;;AAGA,IAAAA,YAAA,GAAAC,OAAA;AAMA,IAAAC,OAAA,GAAAD,OAAA;AAKA,IAAAE,QAAA,GAAAF,OAAA;AACA,IAAAG,kBAAA,GAAAH,OAAA;AAQA,IAAAI,WAAA,GAAAJ,OAAA;AAeA,IAAAK,YAAA,GAAAL,OAAA;AAaA,IAAAM,KAAA,GAAAN,OAAA;AACA,IAAAO,IAAA,GAAAP,OAAA;AACA,IAAAQ,MAAA,GAAAR,OAAA;AACA,IAAAS,QAAA,GAAAT,OAAA;AACA,IAAAU,KAAA,GAAAV,OAAA;AACA,IAAAW,MAAA,GAAAX,OAAA;AAMA,IAAAY,SAAA,GAAAZ,OAAA;AACA,IAAAa,QAAA,GAAAb,OAAA;AAEA,IAAAc,SAAA,GAAAd,OAAA;AAKA,IAAAe,OAAA,GAAAC,sBAAA,CAAAhB,OAAA;AACA,IAAAiB,MAAA,GAAAjB,OAAA;AAEA,IAAAkB,UAAA,GAAAlB,OAAA;AAzEA;AACA;AACA;;AASA;AACA;AACA;;AAmDA;;AAGA;AACA;AACA;;AAYA,MAAMmB,aAAa,GAAGA,CAAEC,KAAK,EAAEC,QAAQ,KAAM;EAC5C,IAAK,CAAEA,QAAQ,EAAG;IACjB,OAAOC,SAAS;EACjB;EACA,OAAOF,KAAK,EAAEG,aAAa,EAAEC,KAAK,GAAIH,QAAQ,CAAE,EAAEI,UAAU;AAC7D,CAAC;AAED,SAASC,YAAYA,CAAE;EACtBC,UAAU;EACVP,KAAK;EACLQ,kBAAkB;EAClBC;AACD,CAAC,EAAG;EACH,MAAMC,KAAK,GAAG,IAAAC,gBAAQ,EAAC,CAAC;EACxB,MAAM;IAAEC,IAAI,EAAEC,GAAG;IAAEC,KAAK;IAAEC,eAAe;IAAEC,UAAU;IAAEC;EAAI,CAAC,GAAGV,UAAU;;EAEzE;EACA,IAAAW,kBAAS,EAAE,MAAM;IAChB,MAAM;MAAEC,UAAU,EAAEC;IAAO,CAAC,GAAGV,KAAK,CAACW,MAAM,IAAI,CAAC,CAAC;IAEjD,IAAIC,kBAAkB;IACtB,QAASF,MAAM;MACd,KAAKb,UAAU,CAACM,GAAG;QAClBS,kBAAkB,GAAGC,iCAAsB;QAC3C;MACD,KAAKvB,KAAK,EAAEwB,IAAI;QACfF,kBAAkB,GAAGG,sCAA2B;QAChD;MACD,KAAK,EAAE;QACNH,kBAAkB,GAAGI,gCAAqB;QAC1C;MACD;QACCJ,kBAAkB,GAAGK,kCAAuB;QAC5C;IACF;IAEAlB,mBAAmB,CAAE;MACpBI,GAAG,EAAEO,MAAM;MACXL,eAAe,EAAEO;IAClB,CAAE,CAAC;EACJ,CAAC,EAAE,CAAEZ,KAAK,CAACW,MAAM,EAAEF,UAAU,CAAG,CAAC;EAEjC,IAAIS,SAAS;EACb,QAASb,eAAe;IACvB,KAAKQ,iCAAsB;MAC1BK,SAAS,GAAG,IAAAC,QAAE,EAAE,YAAa,CAAC;MAC9B;IACD,KAAKJ,sCAA2B;MAC/BG,SAAS,GAAG,IAAAC,QAAE,EAAE,iBAAkB,CAAC;MACnC;IACD,KAAKF,kCAAuB;MAC3BC,SAAS,GAAG,IAAAC,QAAE,EAAE,YAAa,CAAC;MAC9B;IACD;MACCD,SAAS,GAAG,IAAAC,QAAE,EAAE,MAAO,CAAC;MACxB;EACF;EAEA,MAAMC,mBAAmB,GAAG;IAC3BjB,GAAG,EAAE;MACJe,SAAS;MACTG,SAAS,EAAE,KAAK;MAChBC,QAAQ,EAAE;IACX,CAAC;IACDC,YAAY,EAAE;MACbnB,KAAK,EAAE,IAAAe,QAAE,EAAE,iBAAkB;IAC9B,CAAC;IACDK,OAAO,EAAE;MACRpB,KAAK,EAAE,IAAAe,QAAE,EAAE,UAAW,CAAC;MACvBM,WAAW,EAAE,IAAAC,QAAE,EAAE,MAAM,EAAE,sCAAuC;IACjE;EACD,CAAC;EAED,OACC,IAAAC,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAuD,SAAS;IAACC,KAAK,EAAG,IAAAX,QAAE,EAAE,eAAgB;EAAG,GACzC,IAAAQ,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAyD,sBAAsB;IACtBC,SAAS,EAAGlC,kBAAoB;IAChCK,GAAG,EAAGA,GAAK;IACXI,GAAG,EAAGA,GAAK;IACXH,KAAK,EAAGA,KAAO;IACfE,UAAU,EAAGA,UAAY;IACzB2B,aAAa,EAAGlC,mBAAqB;IACrCmC,eAAe,EAAG,KAAO;IACzBC,SAAS;IACTC,OAAO,EAAGhB,mBAAqB;IAC/BiB,QAAQ,EAAG,KAAO;IAClBC,iBAAiB,EAAGA,CAAE;MAAEC;IAAW,CAAC,KAAM;MACzCA,UAAU,CAACC,QAAQ,CAClBC,iCAAoB,CAACC,qBAAqB,EAC1C;QACCjC,UAAU,EAAEZ,UAAU,CAACK,IAAI;QAC3BG,eAAe,EAAER,UAAU,CAACQ,eAAe;QAC3CsC,QAAQ,EAAE9C,UAAU,CAACM,GAAG;QACxByC,iBAAiB,EAAEtD,KAAK,EAAEwB;MAC3B,CACD,CAAC;IACF;EAAG,CACH,CACS,CAAC;AAEd;AAEA,MAAM+B,iBAAiB,GAAG,CAAC;AAC3B,MAAMC,sBAAsB,GAAG,CAAC;AAChC,MAAMC,sBAAsB,GAAG,CAAC;AAChC,MAAMC,mBAAmB,GAAG,CAAC;AAEtB,MAAMC,SAAS,SAASC,kBAAS,CAAC;EACxCC,WAAWA,CAAEC,KAAK,EAAG;IACpB,KAAK,CAAEA,KAAM,CAAC;IAEd,IAAI,CAACC,KAAK,GAAG;MACZC,iBAAiB,EAAE,KAAK;MACxBC,YAAY,EAAEV;IACf,CAAC;IAED,IAAI,CAACW,qBAAqB,GAAG,KAAK;IAElC,IAAI,CAACC,4BAA4B,GAChC,IAAI,CAACA,4BAA4B,CAACC,IAAI,CAAE,IAAK,CAAC;IAC/C,IAAI,CAACC,4BAA4B,GAChC,IAAI,CAACA,4BAA4B,CAACD,IAAI,CAAE,IAAK,CAAC;IAC/C,IAAI,CAACE,qBAAqB,GAAG,IAAI,CAACA,qBAAqB,CAACF,IAAI,CAAE,IAAK,CAAC;IACpE,IAAI,CAACG,yBAAyB,GAC7B,IAAI,CAACA,yBAAyB,CAACH,IAAI,CAAE,IAAK,CAAC;IAC5C,IAAI,CAACI,mBAAmB,GAAG,IAAI,CAACA,mBAAmB,CAACJ,IAAI,CAAE,IAAK,CAAC;IAChE,IAAI,CAACK,cAAc,GAAG,IAAI,CAACA,cAAc,CAACL,IAAI,CAAE,IAAK,CAAC;IACtD,IAAI,CAACM,WAAW,GAAG,IAAI,CAACA,WAAW,CAACN,IAAI,CAAE,IAAK,CAAC;IAChD,IAAI,CAACO,aAAa,GAAG,IAAI,CAACA,aAAa,CAACP,IAAI,CAAE,IAAK,CAAC;IACpD,IAAI,CAACQ,cAAc,GAAG,IAAI,CAACA,cAAc,CAACR,IAAI,CAAE,IAAK,CAAC;IACtD,IAAI,CAACS,aAAa,GAAG,IAAI,CAACA,aAAa,CAACT,IAAI,CAAE,IAAK,CAAC;IACpD,IAAI,CAACU,cAAc,GAAG,IAAI,CAACA,cAAc,CAACV,IAAI,CAAE,IAAK,CAAC;IACtD,IAAI,CAACW,WAAW,GAAG,IAAI,CAACA,WAAW,CAACX,IAAI,CAAE,IAAK,CAAC;IAChD,IAAI,CAACY,yBAAyB,GAC7B,IAAI,CAACA,yBAAyB,CAACZ,IAAI,CAAE,IAAK,CAAC;IAC5C,IAAI,CAAC3D,mBAAmB,GAAG,IAAI,CAACA,mBAAmB,CAAC2D,IAAI,CAAE,IAAK,CAAC;IAChE,IAAI,CAACa,iBAAiB,GAAG,IAAI,CAACA,iBAAiB,CAACb,IAAI,CAAE,IAAK,CAAC;EAC7D;EAEAc,iBAAiBA,CAAA,EAAG;IACnB,MAAM;MAAE3E,UAAU;MAAEoC;IAAc,CAAC,GAAG,IAAI,CAACmB,KAAK;IAChD;IACA;IACA;IACA,IAAKvD,UAAU,CAAC4E,EAAE,IAAI,CAAE5E,UAAU,CAACM,GAAG,EAAG;MACxC;MACAuE,OAAO,CAACC,IAAI,CAAE,gCAAiC,CAAC;IACjD;;IAEA;IACA,IACC,CAAE9E,UAAU,CAAC4E,EAAE,IACf5E,UAAU,CAACM,GAAG,IACd,IAAAyE,gBAAW,EAAE/E,UAAU,CAACM,GAAI,CAAC,KAAK,OAAO,EACxC;MACD,IAAA0E,qCAAkB,EAAEhF,UAAU,CAACM,GAAG,EAAE,CAAEsE,EAAE,EAAEtE,GAAG,KAAM;QAClD,IAAKA,GAAG,EAAG;UACV8B,aAAa,CAAE;YAAEwC,EAAE;YAAEtE;UAAI,CAAE,CAAC;QAC7B;MACD,CAAE,CAAC;IACJ;;IAEA;IACA;IACA,IACCN,UAAU,CAAC4E,EAAE,IACb5E,UAAU,CAACM,GAAG,IACd,IAAAyE,gBAAW,EAAE/E,UAAU,CAACM,GAAI,CAAC,KAAK,OAAO,EACxC;MACD,IAAA2E,kCAAe,EAAC,CAAC;IAClB;EACD;EAEAC,oBAAoBA,CAAA,EAAG;IACtB;IACA,IACC,IAAAC,gBAAS,EAAE,iCAAkC,CAAC,IAC9C,IAAI,CAAC3B,KAAK,CAACE,YAAY,KAAKT,sBAAsB,EACjD;MACD,IAAAmC,eAAQ,EACP,iCAAiC,EACjC,IAAI,CAAC7B,KAAK,CAACvD,UAAU,CAAC4E,EACvB,CAAC;IACF;EACD;EAEAS,kBAAkBA,CAAEC,aAAa,EAAG;IACnC,MAAM;MAAE7F,KAAK;MAAEO,UAAU;MAAEoC,aAAa;MAAEmD;IAAgB,CAAC,GAC1D,IAAI,CAAChC,KAAK;IACX,MAAM;MAAEjD;IAAI,CAAC,GAAGN,UAAU;IAC1B,IAAK,CAAEsF,aAAa,CAAC7F,KAAK,IAAIA,KAAK,EAAG;MACrC,IAAK,CAAE,IAAA+F,gBAAW,EAAElF,GAAG,EAAE,GAAI,CAAC,IAAIN,UAAU,EAAEN,QAAQ,EAAG;QACxD,MAAM+F,UAAU,GACfjG,aAAa,CAAEC,KAAK,EAAEO,UAAU,CAACN,QAAS,CAAC,IAC3CD,KAAK,CAACK,UAAU;QAEjBsC,aAAa,CAAE;UAAE9B,GAAG,EAAEmF;QAAW,CAAE,CAAC;MACrC;IACD;IAEA,MAAM;MAAEb;IAAG,CAAC,GAAG5E,UAAU;IACzB,MAAM;MAAE4E,EAAE,EAAEc;IAAW,CAAC,GAAGJ,aAAa,CAACtF,UAAU;;IAEnD;IACA;IACA;IACA,IACC,CAAC,CAAE4E,EAAE,IACLA,EAAE,KAAKc,UAAU,IACjB,CAAC,CAAEH,eAAe,IAClBA,eAAe,KAAKG,UAAU,EAC7B;MACD,IAAI,CAAC/B,qBAAqB,GAAG,IAAI;IAClC;;IAEA;IACA;IACA,IACC,IAAI,CAACA,qBAAqB,IAC1B,CAAC,CAAElE,KAAK,IACR,IAAI,CAACkG,kBAAkB,CAAC,CAAC,EACxB;MACD,IAAI,CAAChC,qBAAqB,GAAG,KAAK;MAClC,IAAAiC,mCAAgB,EAAEhB,EAAG,CAAC;IACvB;IAEA,MAAM;MAAEiB;IAAM,CAAC,GAAG7F,UAAU;IAC5B,MAAM;MAAE8F;IAAwC,CAAC,GAAG,IAAI,CAACvC,KAAK;;IAE9D;IACA,IAAK,CAAE,MAAM,EAAE,MAAM,CAAE,CAACwC,QAAQ,CAAEF,KAAM,CAAC,EAAG;MAC3CC,uCAAuC,CAAC,CAAC;MACzC1D,aAAa,CAAE;QACd4D,KAAK,EAAErG,SAAS;QAChBsG,MAAM,EAAEtG,SAAS;QACjBuG,WAAW,EAAEvG,SAAS;QACtBwG,KAAK,EAAExG;MACR,CAAE,CAAC;IACJ;EACD;EAEA,OAAOyG,wBAAwBA,CAAE7C,KAAK,EAAEC,KAAK,EAAG;IAC/C;IACA;IACA,OAAO;MACNC,iBAAiB,EAAEF,KAAK,CAAC8C,UAAU,IAAI7C,KAAK,CAACC;IAC9C,CAAC;EACF;EAEAgB,yBAAyBA,CAAE6B,OAAO,EAAG;IACpC;IACA,OAAOC,qBAAQ,CAACC,OAAO,CAAEF,OAAQ,CAAC,GAC/B;IACA,sBAAsB,GACtB,IAAAG,aAAO,GACP;IACA,IAAAnF,QAAE,EAAE,mBAAoB,CAAC,EACzBgF,OACA,CAAC;EACL;EAEAjC,cAAcA,CAAA,EAAG;IAChB,MAAM;MAAErE,UAAU;MAAEP;IAAM,CAAC,GAAG,IAAI,CAAC8D,KAAK;IAExC,IAAK,IAAI,CAACC,KAAK,CAACE,YAAY,KAAKT,sBAAsB,EAAG;MACzD,IAAAyD,iDAA8B,EAAE1G,UAAU,CAAC4E,EAAG,CAAC;IAChD,CAAC,MAAM,IACN5E,UAAU,CAAC4E,EAAE,IACb,IAAAG,gBAAW,EAAE/E,UAAU,CAACM,GAAI,CAAC,KAAK,OAAO,EACxC;MACD,IAAAqG,gDAA6B,EAAE3G,UAAU,CAAC4E,EAAG,CAAC;IAC/C,CAAC,MAAM,IAAK,CAAE,IAAI,CAACpB,KAAK,CAACC,iBAAiB,EAAG;MAC5C,IAAAmD,gDAA6B,EAC5B5G,UAAU,CAACM,GAAG,EACdb,KAAK,IAAIA,KAAK,CAACK,UAChB,CAAC;IACF;IAEA,IAAI,CAAC+G,QAAQ,CAAE;MACdpD,iBAAiB,EAAE;IACpB,CAAE,CAAC;EACJ;EAEAQ,mBAAmBA,CAAE6C,OAAO,EAAG;IAC9B,MAAM;MAAE1E;IAAc,CAAC,GAAG,IAAI,CAACmB,KAAK;IACpC,IAAKuD,OAAO,CAACC,QAAQ,EAAG;MACvB3E,aAAa,CAAE;QAAE9B,GAAG,EAAEwG,OAAO,CAACC;MAAS,CAAE,CAAC;IAC3C;IAEA,IAAK,IAAI,CAACvD,KAAK,CAACE,YAAY,KAAKT,sBAAsB,EAAG;MACzD,IAAI,CAAC4D,QAAQ,CAAE;QAAEnD,YAAY,EAAET;MAAuB,CAAE,CAAC;IAC1D;EACD;EAEAW,4BAA4BA,CAAEkD,OAAO,EAAG;IACvC,MAAM;MAAE1E;IAAc,CAAC,GAAG,IAAI,CAACmB,KAAK;IAEpCnB,aAAa,CAAE;MAAE9B,GAAG,EAAEwG,OAAO,CAACC,QAAQ;MAAEnC,EAAE,EAAEkC,OAAO,CAACE;IAAc,CAAE,CAAC;IACrE,IAAI,CAACH,QAAQ,CAAE;MAAEnD,YAAY,EAAER;IAAuB,CAAE,CAAC;EAC1D;EAEAY,4BAA4BA,CAAEgD,OAAO,EAAG;IACvC,MAAM;MAAE1E;IAAc,CAAC,GAAG,IAAI,CAACmB,KAAK;IAEpCnB,aAAa,CAAE;MAAEwC,EAAE,EAAEkC,OAAO,CAACG;IAAQ,CAAE,CAAC;IACxC,IAAI,CAACJ,QAAQ,CAAE;MAAEnD,YAAY,EAAEP;IAAoB,CAAE,CAAC;EACvD;EAEAY,qBAAqBA,CAAA,EAAG;IACvB,MAAM;MAAE3B;IAAc,CAAC,GAAG,IAAI,CAACmB,KAAK;IAEpCnB,aAAa,CAAE;MAAEwC,EAAE,EAAE,IAAI;MAAEtE,GAAG,EAAE;IAAK,CAAE,CAAC;IACxC,IAAI,CAACuG,QAAQ,CAAE;MAAEnD,YAAY,EAAEV;IAAkB,CAAE,CAAC;EACrD;EAEAkB,cAAcA,CAAE5D,GAAG,EAAG;IACrB,IAAI,CAACiD,KAAK,CAACnB,aAAa,CAAE;MACzB9B,GAAG;MACH0F,KAAK,EAAErG,SAAS;MAChBsG,MAAM,EAAEtG;IACT,CAAE,CAAC;EACJ;EAEAwE,WAAWA,CAAE+C,KAAK,EAAG;IACpB,MAAMC,iBAAiB,GAAG,IAAAC,mCAA4B,EACrDF,KAAK,EACL,IAAI,CAAC3D,KAAK,CAACvD,UACZ,CAAC;IACD,IAAI,CAACuD,KAAK,CAACnB,aAAa,CAAE+E,iBAAkB,CAAC;EAC9C;EAEA/C,aAAaA,CAAE1E,QAAQ,EAAG;IACzB,MAAM;MAAED,KAAK;MAAE2C;IAAc,CAAC,GAAG,IAAI,CAACmB,KAAK;IAE3C,MAAMjD,GAAG,GAAGd,aAAa,CAAEC,KAAK,EAAEC,QAAS,CAAC;IAC5C,IAAK,CAAEY,GAAG,EAAG;MACZ,OAAO,IAAI;IACZ;IACA8B,aAAa,CAAE;MACd9B,GAAG;MACH0F,KAAK,EAAErG,SAAS;MAChBsG,MAAM,EAAEtG,SAAS;MACjBD;IACD,CAAE,CAAC;EACJ;EAEAsE,yBAAyBA,CAAEqD,KAAK,EAAG;IAClC,MAAM;MAAEC;IAAiB,CAAC,GAAG,IAAI,CAAC/D,KAAK;IACvC,MAAM;MAAEqB,EAAE;MAAEtE,GAAG;MAAEiH;IAAY,CAAC,GAAG,IAAI,CAAChE,KAAK,CAACvD,UAAU;IACtD,MAAMwH,eAAe,GAAG;MACvB5C,EAAE,EAAEyC,KAAK,CAACzC,EAAE;MACZtE,GAAG,EAAE+G,KAAK,CAAC/G,GAAG;MACdgG,OAAO,EAAEe,KAAK,CAACf,OAAO;MACtBmB,GAAG,EAAEJ,KAAK,CAACI;IACZ,CAAC;IAED,IAAIC,oBAAoB;IACxB;IACA,IAAK,CAAEL,KAAK,CAACzC,EAAE,IAAIyC,KAAK,CAACzC,EAAE,KAAKA,EAAE,EAAG;MACpC8C,oBAAoB,GAAG;QACtB1B,KAAK,EAAErG,SAAS;QAChBsG,MAAM,EAAEtG,SAAS;QACjBD,QAAQ,EAAE4H;MACX,CAAC;IACF,CAAC,MAAM;MACN;MACAI,oBAAoB,GAAG;QAAEpH;MAAI,CAAC;IAC/B;IAEA,IAAID,IAAI;IACR,QAASkH,WAAW;MACnB,KAAKvG,iCAAsB;QAC1BX,IAAI,GAAGgH,KAAK,CAAC/G,GAAG;QAChB;MACD,KAAKY,sCAA2B;QAC/Bb,IAAI,GAAGgH,KAAK,CAACpG,IAAI;QACjB;IACF;IACAuG,eAAe,CAACnH,IAAI,GAAGA,IAAI;IAE3B,IAAI,CAACkD,KAAK,CAACnB,aAAa,CAAE;MACzB,GAAGoF,eAAe;MAClB,GAAGE;IACJ,CAAE,CAAC;EACJ;EAEAlD,WAAWA,CAAEmD,MAAM,EAAG;IACrB,MAAM;MAAEC,iBAAiB;MAAEN,gBAAgB;MAAElF;IAAc,CAAC,GAC3D,IAAI,CAACmB,KAAK;IAEX,IAAK,IAAAsE,UAAK,EAAEF,MAAO,CAAC,EAAG;MACtB,IAAI,CAACd,QAAQ,CAAE;QACdiB,eAAe,EAAE;MAClB,CAAE,CAAC;;MAEH;MACAC,kBAAO,CAACC,OAAO,CACdL,MAAM,EACN,MAAM;QACLvF,aAAa,CAAE;UACd9B,GAAG,EAAEqH,MAAM;UACX/C,EAAE,EAAEjF,SAAS;UACbqG,KAAK,EAAErG,SAAS;UAChBsG,MAAM,EAAEtG,SAAS;UACjBD,QAAQ,EAAE4H;QACX,CAAE,CAAC;QACH,IAAI,CAACT,QAAQ,CAAE;UACdiB,eAAe,EAAE;QAClB,CAAE,CAAC;MACJ,CAAC,EACD,MAAM;QACLF,iBAAiB,CAAE,IAAAtG,QAAE,EAAE,uBAAwB,CAAE,CAAC;QAClD,IAAI,CAACuF,QAAQ,CAAE;UACdiB,eAAe,EAAE;QAClB,CAAE,CAAC;MACJ,CACD,CAAC;IACF,CAAC,MAAM;MACNF,iBAAiB,CAAE,IAAAtG,QAAE,EAAE,cAAe,CAAE,CAAC;IAC1C;EACD;EAEAiD,cAAcA,CAAA,EAAG;IAChB,IAAK,IAAI,CAAChB,KAAK,CAAC0E,OAAO,EAAG;MACzB,IAAI,CAAC1E,KAAK,CAAC0E,OAAO,CAAC,CAAC;IACrB;IACA,IAAK,CAAE,IAAI,CAACzE,KAAK,CAACC,iBAAiB,EAAG;MACrC,IAAI,CAACoD,QAAQ,CAAE;QACdpD,iBAAiB,EAAE;MACpB,CAAE,CAAC;IACJ;EACD;EAEAyE,kBAAkBA,CAAA,EAAG;IACpB,OACC,IAAApG,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAA0J,IAAI;MACJC,IAAI,EAAGC,YAAiB;MAAA,GACnB,IAAI,CAAC9E,KAAK,CAAC+E,wBAAwB,CACvCC,eAAM,CAACC,eAAe,EACtBD,eAAM,CAACE,mBACR;IAAC,CACD,CAAC;EAEJ;EAEAC,oBAAoBA,CAAA,EAAG;IACtB,OACC,IAAA5G,MAAA,CAAAC,aAAA,EAAC3D,YAAA,CAAAuK,IAAI;MAACC,KAAK,EAAGL,eAAM,CAACM;IAAgB,GACpC,IAAA/G,MAAA,CAAAC,aAAA,EAAC3D,YAAA,CAAA0K,iBAAiB;MAACC,SAAS;IAAA,CAAE,CACzB,CAAC;EAET;EAEAC,QAAQA,CAAA,EAAG;IACV,MAAM;MAAEhJ;IAAW,CAAC,GAAG,IAAI,CAACuD,KAAK;IACjC,MAAM;MAAEsC,KAAK;MAAEG;IAAM,CAAC,GAAGhG,UAAU;IAEnC,OAAOiJ,MAAM,CAACC,MAAM,CAAEC,2BAAe,CAACC,UAAW,CAAC,CAACrD,QAAQ,CAAEF,KAAM,CAAC,GACjE,MAAM,GACNG,KAAK;EACT;EAEA9F,mBAAmBA,CAAE;IAAEI,GAAG,EAAED,IAAI;IAAEG,eAAe;IAAE,GAAG6I;EAAe,CAAC,EAAG;IACxE,MAAM;MAAEjH;IAAc,CAAC,GAAG,IAAI,CAACmB,KAAK;IACpC,IAAK,CAAElD,IAAI,IAAI,CAAEG,eAAe,EAAG;MAClCA,eAAe,GAAGW,gCAAqB;IACxC,CAAC,MAAM,IAAK,CAAEX,eAAe,EAAG;MAC/BA,eAAe,GAAGY,kCAAuB;IAC1C;IAEA,OAAOf,IAAI,KAAKV,SAAS,IAAIU,IAAI,KAAK,IAAI,CAACkD,KAAK,CAACvD,UAAU,CAACK,IAAI,GAC7D+B,aAAa,CAAEiH,cAAe,CAAC,GAC/BjH,aAAa,CAAE;MACf,GAAGiH,cAAc;MACjB7I,eAAe;MACfH;IACA,CAAE,CAAC;EACP;EAEAiJ,kBAAkBA,CAAA,EAAG;IACpB,MAAM;MACLtJ,UAAU,EAAE;QAAEyH;MAAI;IACnB,CAAC,GAAG,IAAI,CAAClE,KAAK;IAEd,MAAMgG,SAAS,GAAKC,MAAM,IAAM;MAC/B,IAAI,CAACjG,KAAK,CAACnB,aAAa,CAAE;QAAEqF,GAAG,EAAE+B;MAAO,CAAE,CAAC;IAC5C,CAAC;IAED,OACC,IAAA1H,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAgL,sBAAsB;MACtBC,YAAY,EAAGjC,GAAK;MACpBkC,QAAQ,EAAGJ,SAAW;MACtB3H,WAAW,EAAG,IAAAN,QAAE,EAAE,cAAe,CAAG;MACpCf,KAAK,EAAG,IAAAe,QAAE,EAAE,UAAW,CAAG;MAC1B8G,IAAI,EAAGwB,gBAAW;MAClBC,UAAU,EACT,IAAA/H,MAAA,CAAAC,aAAA,EAAAD,MAAA,CAAAgI,QAAA,QACG,IAAAxI,QAAE,EACH,+DACD,CAAC,EAAI,GAAG,EACR,IAAAQ,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAsL,iBAAiB;QACjB1J,IAAI,EACH,wDACA;QACD6G,KAAK,EAAG,IAAA5F,QAAE,EAAE,mBAAoB;MAAG,CACnC,CACA;IACF,CACD,CAAC;EAEJ;EAEAoD,iBAAiBA,CAAEsF,QAAQ,EAAG;IAC7B,IAAI,CAAC5F,aAAa,CAAE4F,QAAS,CAAC;EAC/B;EAEA1F,aAAaA,CAAE2C,OAAO,EAAG;IACxB,MAAM;MAAEgD;IAAyB,CAAC,GAAG,IAAI,CAAC1G,KAAK;IAC/C,IAAAqC,mCAAgB,EAAEqB,OAAQ,CAAC;IAC3BgD,wBAAwB,CAAC,CAAC;EAC3B;EAEAC,sBAAsBA,CAAEC,eAAe,EAAG;IACzC,MAAM;MAAEnK,UAAU;MAAEsI;IAAyB,CAAC,GAAG,IAAI,CAAC/E,KAAK;IAE3D,MAAM6G,sBAAsB,GAAG9B,wBAAwB,CACtDC,eAAM,CAAC8B,iBAAiB,EACxB9B,eAAM,CAAC+B,qBACR,CAAC;IAED,MAAMC,oBAAoB,GAAGA,CAAA,KAC5B,IAAAzI,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAA+L,WAAW,CAACC,IAAI;MAChBlK,KAAK,EAAG,IAAAe,QAAE,EAAE,0BAA2B,CAAG;MAC1CoJ,UAAU,EAAG,CACZN,sBAAsB,EACtB7B,eAAM,CAACgC,oBAAoB,CACzB;MACHI,kBAAkB,EAAGpC,eAAM,CAACqC,8BAAgC;MAC5DC,aAAa,EAAG,MAAQ;MACxBC,OAAO,EAAGA,CAAA,KACT,IAAI,CAACxG,aAAa,CAAEyG,yCAA+B;IACnD,CACD,CACD;IAED,MAAMV,iBAAiB,GAAGA,CAAA,KACzB,IAAAvI,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAA+L,WAAW,CAACC,IAAI;MAChBlK,KAAK,EAAG,IAAAe,QAAE,EAAE,uBAAwB,CAAG;MACvCoJ,UAAU,EAAGN,sBAAwB;MACrCO,kBAAkB,EAAGpC,eAAM,CAACqC,8BAAgC;MAC5DC,aAAa,EAAG,MAAQ;MACxBC,OAAO,EAAGA,CAAA,KAAM,IAAI,CAACxG,aAAa,CAAEtE,UAAU,CAAC4E,EAAG;IAAG,CACrD,CACD;IAED,OAAOuF,eAAe,GAAGI,oBAAoB,CAAC,CAAC,GAAGF,iBAAiB,CAAC,CAAC;EACtE;;EAEA;AACD;AACA;AACA;AACA;AACA;EACC1E,kBAAkBA,CAAA,EAAG;IACpB,MAAM;MACL3F,UAAU,EAAE;QAAE4E;MAAG;IAClB,CAAC,GAAG,IAAI,CAACrB,KAAK;IACd,OACC,OAAOqB,EAAE,KAAK,WAAW,IACzB,IAAI,CAACpB,KAAK,CAACE,YAAY,KAAKT,sBAAsB,IAClD,IAAI,CAACO,KAAK,CAACE,YAAY,KAAKP,mBAAmB;EAEjD;EAEA6H,KAAKA,CAAE1K,GAAG,EAAG;IACZ,OAAOA,GAAG,CAAC2K,WAAW,CAAC,CAAC,CAAClF,QAAQ,CAAE,MAAO,CAAC;EAC5C;EAEAmF,MAAMA,CAAA,EAAG;IACR,MAAM;MAAEzH,iBAAiB;MAAEqE;IAAgB,CAAC,GAAG,IAAI,CAACtE,KAAK;IACzD,MAAM;MACLxD,UAAU;MACVqG,UAAU;MACV5G,KAAK;MACL0L,QAAQ;MACR7D,gBAAgB;MAChB8D,OAAO;MACP7F,eAAe;MACf8F,oBAAoB;MACpBC;IACD,CAAC,GAAG,IAAI,CAAC/H,KAAK;IACd,MAAM;MAAEsC,KAAK;MAAEvF,GAAG;MAAEmH,GAAG;MAAE7C,EAAE;MAAElF,QAAQ;MAAE6L;IAAU,CAAC,GAAGvL,UAAU;IAC/D,MAAMwL,eAAe,GAAGJ,OAAO,GAC5BnC,MAAM,CAACwC,IAAI,CAAEL,OAAQ,CAAC,CAACM,MAAM,GAAG,CAAC,GACjC,KAAK;IAER,MAAMC,UAAU,GAAGC,KAAK,CAACC,OAAO,CAAE,IAAI,CAACtI,KAAK,CAACoI,UAAW,CAAC,GACtD,IAAI,CAACpI,KAAK,CAACoI,UAAU,GACrB,EAAE;IACL;IACA,MAAMG,WAAW,GAAGH,UAAU,CAC5BI,MAAM,CAAE,CAAE;MAAEC;IAAK,CAAC,KAAMxM,aAAa,CAAEC,KAAK,EAAEuM,IAAK,CAAE,CAAC,CACtDC,GAAG,CAAE,CAAE;MAAEC,IAAI;MAAEF;IAAK,CAAC,MAAQ;MAAE9E,KAAK,EAAE8E,IAAI;MAAEzL,KAAK,EAAE2L;IAAK,CAAC,CAAG,CAAC;IAE/D,IAAIC,kBAAkB,GAAGzM,QAAQ,IAAI4H,gBAAgB;IACrD,IAAI8E,gBAAgB,GAAGN,WAAW,CAACO,IAAI,CACpCC,MAAM,IAAMA,MAAM,CAACpF,KAAK,KAAKiF,kBAChC,CAAC;IAED,IAAK,CAAEC,gBAAgB,EAAG;MACzB;MACAA,gBAAgB,GAAGN,WAAW,CAACO,IAAI,CAChCC,MAAM,IAAMA,MAAM,CAACpF,KAAK,KAAK,MAChC,CAAC;MACDiF,kBAAkB,GAAG,MAAM;IAC5B;IAEA,MAAMxG,kBAAkB,GAAG,IAAI,CAACA,kBAAkB,CAAC,CAAC;IACpD,MAAMwE,eAAe,GACpBxE,kBAAkB,IAAIJ,eAAe,KAAKvF,UAAU,CAAC4E,EAAE;IAExD,MAAM2H,oBAAoB,GAAKC,IAAI,IAClC,IAAA1K,MAAA,CAAAC,aAAA,EAACrD,YAAA,CAAA+N,aAAa,QACb,IAAA3K,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAiO,YAAY,QACZ,IAAA5K,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAkO,aAAa;MACb1K,KAAK,EAAG,IAAAX,QAAE,EAAE,YAAa,CAAG;MAC5B8G,IAAI,EAAGwE,cAAS;MAChBC,OAAO,EAAGL;IAAM,CAChB,CACY,CACA,CACf;IAED,MAAMM,oBAAoB,GAAGA,CAAA,KAC5B,IAAAhL,MAAA,CAAAC,aAAA,EAACrD,YAAA,CAAAqO,iBAAiB,QACjB,IAAAjL,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAuD,SAAS;MAACC,KAAK,EAAG,IAAAX,QAAE,EAAE,UAAW;IAAG,CAAE,CAAC,EACxC,IAAAQ,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAuD,SAAS;MAAC4G,KAAK,EAAGL,eAAM,CAACyE;IAAW,GACpC,IAAAlL,MAAA,CAAAC,aAAA,EAACrD,YAAA,CAAAuO,WAAW;MAAC9B,QAAQ,EAAGA,QAAU;MAAC7K,GAAG,EAAGA;IAAK,CAAE,CACtC,CAAC,EACZ,IAAAwB,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAuD,SAAS,QACPvC,KAAK,IAAI2M,gBAAgB,IAC1B,IAAAtK,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAyO,wBAAwB;MACxB9E,IAAI,EAAG+E,iBAAY;MACnB5M,KAAK,EAAG,IAAAe,QAAE,EAAE,MAAO,CAAG;MACtBiB,OAAO,EAAGuJ,WAAa;MACvBnC,QAAQ,EAAG,IAAI,CAACjF,iBAAmB;MACnCwC,KAAK,EAAGiF;IAAoB,CAC5B,CACD,EACC,IAAI,CAAC7C,kBAAkB,CAAC,CAChB,CAAC,EACZ,IAAAxH,MAAA,CAAAC,aAAA,EAAChC,YAAY;MACZC,UAAU,EAAG,IAAI,CAACuD,KAAK,CAACvD,UAAY;MACpCP,KAAK,EAAG,IAAI,CAAC8D,KAAK,CAAC9D,KAAO;MAC1BQ,kBAAkB,EAAG,IAAI,CAACuD,KAAK,CAACvD,kBAAoB;MACpDC,mBAAmB,EAAG,IAAI,CAACA;IAAqB,CAChD,CAAC,EACF,IAAA4B,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAuD,SAAS;MACTC,KAAK,EAAG,IAAAX,QAAE,EAAE,gBAAiB,CAAG;MAChC8L,UAAU,EAAG7E,eAAM,CAAC8E;IAAyB,GAE3C1H,kBAAkB,IACnB,IAAI,CAACuE,sBAAsB,CAAEC,eAAgB,CAAC,EAC/C,IAAArI,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAA6O,oBAAoB;MACpB/M,KAAK,EAAG,IAAAe,QAAE,EACT,0EACD,CAAG;MACHqJ,kBAAkB,EACjBpC,eAAM,CAACqC;IACP,CACD,CACS,CACO,CACnB;IAED,IAAK,CAAEtK,GAAG,EAAG;MACZ,OACC,IAAAwB,MAAA,CAAAC,aAAA,EAAC3D,YAAA,CAAAuK,IAAI;QAACC,KAAK,EAAGL,eAAM,CAACgF;MAAS,GAC3BzF,eAAe,IAAI,IAAI,CAACY,oBAAoB,CAAC,CAAC,EAChD,IAAA5G,MAAA,CAAAC,aAAA,EAACrD,YAAA,CAAA8O,gBAAgB;QAChBC,YAAY,EAAG,CAAEC,6BAAgB,CAAI;QACrCC,QAAQ,EAAG,IAAI,CAAC3J,yBAA2B;QAC3CQ,WAAW,EAAG,IAAI,CAACA,WAAa;QAChC4D,IAAI,EAAG,IAAI,CAACF,kBAAkB,CAAC,CAAG;QAClCD,OAAO,EAAG,IAAI,CAAC1E,KAAK,CAAC0E,OAAS;QAC9B2F,mBAAmB,EAClBvH,UAAU,IAAIgF;MACd,CACD,CACI,CAAC;IAET;IAEA,MAAMwC,WAAW,GAAG;MACnBC,IAAI,EAAE,YAAY;MAClBC,MAAM,EAAE,QAAQ;MAChBC,KAAK,EAAE,UAAU;MACjBC,IAAI,EAAE,QAAQ;MACdC,IAAI,EAAE;IACP,CAAC;IAED,MAAMC,oBAAoB,GAAG;MAC5BlI,MAAM,EAAE,MAAM;MACdmI,UAAU,EAAEhD,OAAO,EAAEiD,SAAS,GAAG,OAAO,GAAG;IAC5C,CAAC;IAED,MAAMC,oBAAoB,GAAG,CAC5BlD,OAAO,EAAEmD,WAAW,IAAIhG,eAAM,CAACgG,WAAW,CAC1C;IAED,MAAMvD,KAAK,GAAG,IAAI,CAACA,KAAK,CAAE1K,GAAI,CAAC;IAC/B,MAAMkO,eAAe,GAAGrE,eAAe,IAAIa,KAAK;IAChD,IAAIyD,cAAc,GAAG,EAAE;IACvB,IAAKtE,eAAe,EAAG;MACtBsE,cAAc,GAAG,IAAAnN,QAAE,EAAE,UAAW,CAAC;IAClC,CAAC,MAAM,IAAK0J,KAAK,EAAG;MACnByD,cAAc,GAAG,IAAAnN,QAAE,EAAE,KAAM,CAAC;IAC7B;IAEA,MAAMoN,iBAAiB,GAAGA,CAAEC,gBAAgB,EAAEC,eAAe,KAC5D,IAAA9M,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAoQ,KAAK;MAACtO,KAAK,EAAGkO,cAAgB;MAACK,IAAI,EAAGN;IAAiB,GACvD,IAAA1M,MAAA,CAAAC,aAAA,EAAC3D,YAAA,CAAA2Q,wBAAwB;MACxBC,UAAU,EAAG,CAAE3I,UAAY;MAC3ByE,OAAO,EAAG,IAAI,CAACzG,cAAgB;MAC/B4K,QAAQ,EAAG,CAAE5I;IAAY,GAEzB,IAAAvE,MAAA,CAAAC,aAAA,EAAC3D,YAAA,CAAAuK,IAAI;MAACC,KAAK,EAAGL,eAAM,CAACgF;IAAS,GAC3BlH,UAAU,IAAIyG,oBAAoB,CAAC,CAAC,EACpCzG,UAAU,IAAIuI,eAAe,CAAC,CAAC,EAC/B,CAAE,IAAI,CAACpL,KAAK,CAACC,iBAAiB,IAC/B8I,oBAAoB,CAAEoC,gBAAiB,CAAC,EACzC,IAAA7M,MAAA,CAAAC,aAAA,EAACrD,YAAA,CAAAwQ,mBAAmB;MACnBC,mBAAmB;MACnBC,QAAQ,EAAG9O,GAAK;MAChB2G,OAAO,EAAGrC,EAAI;MACdyK,qBAAqB,EAAG,IAAI,CAACpL,mBAAqB;MAClDqL,8BAA8B,EAC7B,IAAI,CAAC1L,4BACL;MACD2L,8BAA8B,EAC7B,IAAI,CAACzL,4BACL;MACD0L,uBAAuB,EACtB,IAAI,CAACzL,qBACL;MACD0L,aAAa,EAAGA,CAAE;QACjBC,cAAc;QACdC,kBAAkB;QAClBC,cAAc;QACdC;MACD,CAAC,KAAM;QACN,OACC,IAAA/N,MAAA,CAAAC,aAAA,EAAC3D,YAAA,CAAAuK,IAAI;UAACC,KAAK,EAAG0F;QAAsB,GACjCxG,eAAe,IAChB,IAAI,CAACY,oBAAoB,CAAC,CAAC,EAC5B,IAAA5G,MAAA,CAAAC,aAAA,EAACtD,WAAA,CAAAqR,KAAK;UACLjK,KAAK,EACJA,KAAK,IAAIgI,WAAW,CAAEhI,KAAK,CAC3B;UACD4B,GAAG,EAAGA,GAAK;UACXpB,UAAU,EACTA,UAAU,IACV,CAAE5C,iBACF;UACDmM,cAAc,EAAGA,cAAgB;UACjCF,cAAc,EAAGA,cAAgB;UACjCC,kBAAkB,EACjBA,kBACA;UACDrE,kBAAkB,EACjBA,kBACA;UACDtH,yBAAyB,EACxB,IAAI,CAACA,yBACL;UACD2K,gBAAgB,EACfA,gBACA;UACDkB,YAAY,EAAGA,YAAc;UAC7BvP,GAAG,EAAGA,GAAK;UACXyP,UAAU,EACTxH,eAAM,CAAEgD,SAAS,CAAE,IAAIA,SACvB;UACDvF,KAAK,EAAG,IAAI,CAACgD,QAAQ,CAAC,CAAG;UAAA,IAClBwC,eAAe,GACnB2C,oBAAoB,GACpB,CAAC,CAAC;QAAA,CACL,CACI,CAAC;MAET;IAAG,CACH,CACI,CACmB,CAAC,EAC3B,IAAArM,MAAA,CAAAC,aAAA,EAACrD,YAAA,CAAAsR,YAAY;MACZ7E,QAAQ,EAAG,IAAI,CAAC5H,KAAK,CAAC4H,QAAU;MAChC9E,UAAU,EAAG,IAAI,CAAC7C,KAAK,CAACC,iBAAmB;MAC3CuL,UAAU,EAAG,CAAE,IAAI,CAACxL,KAAK,CAACC,iBAAmB;MAC7CgB,yBAAyB,EAAG,IAAI,CAACA,yBAA2B;MAC5DwD,OAAO,EAAG,IAAI,CAAC1D,cAAgB;MAC/B0L,MAAM,EAAG,IAAI,CAAC1M,KAAK,CAAC0M,MAAQ,CAAC;MAAA;MAC7BC,iBAAiB,EAAG,IAAI,CAAC3M,KAAK,CAAC2M;IAAmB,CAClD,CACK,CACP;IAED,OACC,IAAApO,MAAA,CAAAC,aAAA,EAACrD,YAAA,CAAAyR,WAAW;MACX1C,YAAY,EAAG,CAAEC,6BAAgB,CAAI;MACrC0C,gBAAgB,EAAG,IAAM;MACzBzC,QAAQ,EAAG,IAAI,CAAC3J,yBAA2B;MAC3CQ,WAAW,EAAG,IAAI,CAACA,WAAa;MAChC0G,MAAM,EAAGA,CAAE;QAAEsB,IAAI;QAAEoC;MAAgB,CAAC,KAAM;QACzC,OAAOF,iBAAiB,CAAElC,IAAI,EAAEoC,eAAgB,CAAC;MAClD;IAAG,CACH,CAAC;EAEJ;AACD;AAACyB,OAAA,CAAAjN,SAAA,GAAAA,SAAA;AAAA,IAAAkN,QAAA,GAAAD,OAAA,CAAAE,OAAA,GAEc,IAAAC,gBAAO,EAAE,CACvB,IAAAC,gBAAU,EAAE,CAAEC,MAAM,EAAEnN,KAAK,KAAM;EAChC,MAAM;IAAEoN;EAAS,CAAC,GAAGD,MAAM,CAAEE,eAAU,CAAC;EACxC,MAAM;IAAEC,WAAW;IAAExF;EAAqB,CAAC,GAC1CqF,MAAM,CAAEI,kBAAiB,CAAC;EAC3B,MAAM;IAAEC;EAAuB,CAAC,GAAGL,MAAM,CAAE,aAAc,CAAC;EAC1D,MAAM;IACL1Q,UAAU,EAAE;MAAE4E,EAAE;MAAEtE;IAAI,CAAC;IACvB+F,UAAU;IACV8E;EACD,CAAC,GAAG5H,KAAK;EACT,MAAM;IAAEoI,UAAU;IAAErE,gBAAgB;IAAE0J;EAAa,CAAC,GAAGH,WAAW,CAAC,CAAC;EACpE,MAAMI,YAAY,GAAGrM,EAAE,IAAI,IAAAG,gBAAW,EAAEzE,GAAI,CAAC,KAAK,OAAO;EACzD,MAAMiF,eAAe,GAAGwL,sBAAsB,CAAE,gBAAiB,CAAC;EAElE,MAAMG,cAAc,GACjB7K,UAAU,IAAI4K,YAAY;EAC5B;EACA;EACE,CAAE5K,UAAU,IACb4K,YAAY,IACZ3Q,GAAG,IACH,CAAE,IAAAkF,gBAAW,EAAElF,GAAG,EAAE,GAAI,CAAG;EAC7B,MAAMb,KAAK,GAAGyR,cAAc,GAAGP,QAAQ,CAAE/L,EAAG,CAAC,GAAG,IAAI;EAEpD,OAAO;IACNnF,KAAK;IACLkM,UAAU;IACVrE,gBAAgB;IAChBgE,kBAAkB,EAAE0F,YAAY,EAAE1F,kBAAkB,KAAK,IAAI;IAC7D/F,eAAe;IACf8F,oBAAoB,EAAEA,oBAAoB,CACzCF,QAAQ,EACR,eACD;EACD,CAAC;AACF,CAAE,CAAC,EACH,IAAAgG,kBAAY,EAAIC,QAAQ,IAAM;EAC7B,MAAM;IAAExJ;EAAkB,CAAC,GAAGwJ,QAAQ,CAAEC,cAAa,CAAC;EACtD,MAAM;IAAEvL;EAAwC,CAAC,GAChDsL,QAAQ,CAAEN,kBAAiB,CAAC;EAE7B,OAAO;IACNhL,uCAAuC;IACvC8B,iBAAiB;IACjBqC,wBAAwBA,CAAA,EAAG;MAC1BmH,QAAQ,CAAEE,eAAc,CAAC,CAACC,mBAAmB,CAAC,CAAC;IAChD;EACD,CAAC;AACF,CAAE,CAAC,EACHC,iCAAwB,CACvB,CAAC,CAAEpO,SAAU,CAAC"}