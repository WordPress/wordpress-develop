{"version":3,"names":["_reactNative","require","_element","_coreData","_components","_data","_i18n","_blockEditor","_compose","_icons","_reusableBlocks","_editor","_notices","_editor2","_interopRequireDefault","_editTitle","ReusableBlockEdit","attributes","ref","clientId","isSelected","hasAlreadyRendered","useHasRecursion","showHelp","setShowHelp","useState","infoTextStyle","usePreferredColorSchemeStyle","styles","infoText","infoTextDark","infoTitleStyle","infoTitle","infoTitleDark","infoSheetIconStyle","infoSheetIcon","infoSheetIconDark","infoDescriptionStyle","infoDescription","infoDescriptionDark","actionButtonStyle","actionButton","actionButtonDark","spinnerStyle","spinner","spinnerDark","hasResolved","isEditing","isMissing","useSelect","select","persistedBlock","coreStore","getEntityRecord","hasResolvedBlock","hasFinishedResolution","getBlockCount","blockEditorStore","reusableBlocksStore","__experimentalIsEditingReusableBlock","innerBlockCount","hostAppNamespace","editorStore","getEditorSettings","createSuccessNotice","useDispatch","noticesStore","__experimentalConvertBlockToStatic","convertBlockToStatic","clearSelectedBlock","blocks","onInput","onChange","useEntityBlockEditor","id","title","useEntityProp","openSheet","closeSheet","onConvertToRegularBlocks","useCallback","successNotice","__","sprintf","setImmediate","renderSheet","Platform","OS","_react","createElement","BottomSheet","isVisible","hideHeader","onClose","View","style","infoContainer","Icon","icon","help","color","size","Text","TextControl","label","separatorType","onPress","labelStyle","Warning","message","ActivityIndicator","animating","element","InnerBlocks","value","Disabled","RecursionProvider","uniqueId","TouchableWithoutFeedback","disabled","accessibilityLabel","accessibilityRole","accessibilityHint","default"],"sources":["@wordpress/block-library/src/block/edit.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tActivityIndicator,\n\tPlatform,\n\tText,\n\tTouchableWithoutFeedback,\n\tView,\n} from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { useState, useCallback } from '@wordpress/element';\nimport {\n\tuseEntityBlockEditor,\n\tuseEntityProp,\n\tstore as coreStore,\n} from '@wordpress/core-data';\nimport {\n\tBottomSheet,\n\tIcon,\n\tDisabled,\n\tTextControl,\n} from '@wordpress/components';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { __, sprintf } from '@wordpress/i18n';\nimport {\n\tRecursionProvider,\n\tuseHasRecursion,\n\tInnerBlocks,\n\tWarning,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { usePreferredColorSchemeStyle } from '@wordpress/compose';\nimport { help } from '@wordpress/icons';\nimport { store as reusableBlocksStore } from '@wordpress/reusable-blocks';\nimport { store as editorStore } from '@wordpress/editor';\nimport { store as noticesStore } from '@wordpress/notices';\n\n/**\n * Internal dependencies\n */\nimport styles from './editor.scss';\nimport EditTitle from './edit-title';\n\nexport default function ReusableBlockEdit( {\n\tattributes: { ref },\n\tclientId,\n\tisSelected,\n} ) {\n\tconst hasAlreadyRendered = useHasRecursion( ref );\n\n\tconst [ showHelp, setShowHelp ] = useState( false );\n\tconst infoTextStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoText,\n\t\tstyles.infoTextDark\n\t);\n\tconst infoTitleStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoTitle,\n\t\tstyles.infoTitleDark\n\t);\n\tconst infoSheetIconStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoSheetIcon,\n\t\tstyles.infoSheetIconDark\n\t);\n\tconst infoDescriptionStyle = usePreferredColorSchemeStyle(\n\t\tstyles.infoDescription,\n\t\tstyles.infoDescriptionDark\n\t);\n\tconst actionButtonStyle = usePreferredColorSchemeStyle(\n\t\tstyles.actionButton,\n\t\tstyles.actionButtonDark\n\t);\n\tconst spinnerStyle = usePreferredColorSchemeStyle(\n\t\tstyles.spinner,\n\t\tstyles.spinnerDark\n\t);\n\n\tconst { hasResolved, isEditing, isMissing } = useSelect(\n\t\t( select ) => {\n\t\t\tconst persistedBlock = select( coreStore ).getEntityRecord(\n\t\t\t\t'postType',\n\t\t\t\t'wp_block',\n\t\t\t\tref\n\t\t\t);\n\t\t\tconst hasResolvedBlock = select( coreStore ).hasFinishedResolution(\n\t\t\t\t'getEntityRecord',\n\t\t\t\t[ 'postType', 'wp_block', ref ]\n\t\t\t);\n\n\t\t\tconst { getBlockCount } = select( blockEditorStore );\n\n\t\t\treturn {\n\t\t\t\thasResolved: hasResolvedBlock,\n\t\t\t\tisEditing:\n\t\t\t\t\tselect(\n\t\t\t\t\t\treusableBlocksStore\n\t\t\t\t\t).__experimentalIsEditingReusableBlock( clientId ),\n\t\t\t\tisMissing: hasResolvedBlock && ! persistedBlock,\n\t\t\t\tinnerBlockCount: getBlockCount( clientId ),\n\t\t\t};\n\t\t},\n\t\t[ ref, clientId ]\n\t);\n\tconst hostAppNamespace = useSelect(\n\t\t( select ) =>\n\t\t\tselect( editorStore ).getEditorSettings().hostAppNamespace,\n\t\t[]\n\t);\n\n\tconst { createSuccessNotice } = useDispatch( noticesStore );\n\tconst { __experimentalConvertBlockToStatic: convertBlockToStatic } =\n\t\tuseDispatch( reusableBlocksStore );\n\tconst { clearSelectedBlock } = useDispatch( blockEditorStore );\n\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\n\t\t'postType',\n\t\t'wp_block',\n\t\t{ id: ref }\n\t);\n\n\tconst [ title ] = useEntityProp( 'postType', 'wp_block', 'title', ref );\n\n\tfunction openSheet() {\n\t\tsetShowHelp( true );\n\t}\n\n\tfunction closeSheet() {\n\t\tsetShowHelp( false );\n\t}\n\n\tconst onConvertToRegularBlocks = useCallback( () => {\n\t\t/* translators: %s: name of the synced block */\n\t\tconst successNotice = __( '%s detached' );\n\t\tcreateSuccessNotice( sprintf( successNotice, title ) );\n\n\t\tclearSelectedBlock();\n\t\t// Convert action is executed at the end of the current JavaScript execution block\n\t\t// to prevent issues related to undo/redo actions.\n\t\tsetImmediate( () => convertBlockToStatic( clientId ) );\n\t}, [ title, clientId ] );\n\n\tfunction renderSheet() {\n\t\tconst infoTitle =\n\t\t\tPlatform.OS === 'android'\n\t\t\t\t? sprintf(\n\t\t\t\t\t\t/* translators: %s: name of the host app (e.g. WordPress) */\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Editing synced patterns is not yet supported on %s for Android'\n\t\t\t\t\t\t),\n\t\t\t\t\t\thostAppNamespace\n\t\t\t\t  )\n\t\t\t\t: sprintf(\n\t\t\t\t\t\t/* translators: %s: name of the host app (e.g. WordPress) */\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'Editing synced patterns is not yet supported on %s for iOS'\n\t\t\t\t\t\t),\n\t\t\t\t\t\thostAppNamespace\n\t\t\t\t  );\n\n\t\treturn (\n\t\t\t<BottomSheet\n\t\t\t\tisVisible={ showHelp }\n\t\t\t\thideHeader\n\t\t\t\tonClose={ closeSheet }\n\t\t\t>\n\t\t\t\t<View style={ styles.infoContainer }>\n\t\t\t\t\t<Icon\n\t\t\t\t\t\ticon={ help }\n\t\t\t\t\t\tcolor={ infoSheetIconStyle.color }\n\t\t\t\t\t\tsize={ styles.infoSheetIcon.size }\n\t\t\t\t\t/>\n\t\t\t\t\t<Text style={ [ infoTextStyle, infoTitleStyle ] }>\n\t\t\t\t\t\t{ infoTitle }\n\t\t\t\t\t</Text>\n\t\t\t\t\t<Text style={ [ infoTextStyle, infoDescriptionStyle ] }>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Alternatively, you can detach and edit this block separately by tapping “Detach”.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t</Text>\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\tlabel={ __( 'Detach' ) }\n\t\t\t\t\t\tseparatorType=\"topFullWidth\"\n\t\t\t\t\t\tonPress={ onConvertToRegularBlocks }\n\t\t\t\t\t\tlabelStyle={ actionButtonStyle }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</BottomSheet>\n\t\t);\n\t}\n\n\tif ( hasAlreadyRendered ) {\n\t\treturn (\n\t\t\t<Warning\n\t\t\t\tmessage={ __( 'Block cannot be rendered inside itself.' ) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tif ( isMissing ) {\n\t\treturn (\n\t\t\t<Warning\n\t\t\t\tmessage={ __( 'Block has been deleted or is unavailable.' ) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tif ( ! hasResolved ) {\n\t\treturn (\n\t\t\t<View style={ spinnerStyle }>\n\t\t\t\t<ActivityIndicator animating />\n\t\t\t</View>\n\t\t);\n\t}\n\n\tlet element = (\n\t\t<InnerBlocks\n\t\t\tvalue={ blocks }\n\t\t\tonChange={ onChange }\n\t\t\tonInput={ onInput }\n\t\t/>\n\t);\n\n\tif ( ! isEditing ) {\n\t\telement = <Disabled>{ element }</Disabled>;\n\t}\n\n\treturn (\n\t\t<RecursionProvider uniqueId={ ref }>\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\taccessibilityLabel={ __( 'Help button' ) }\n\t\t\t\taccessibilityRole={ 'button' }\n\t\t\t\taccessibilityHint={ __( 'Tap here to show help' ) }\n\t\t\t\tonPress={ openSheet }\n\t\t\t>\n\t\t\t\t<View>\n\t\t\t\t\t{ isSelected && <EditTitle title={ title } /> }\n\t\t\t\t\t{ element }\n\t\t\t\t\t{ renderSheet() }\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t</RecursionProvider>\n\t);\n}\n"],"mappings":"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"}