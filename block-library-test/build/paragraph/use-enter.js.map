{"version":3,"names":["_element","require","_compose","_keycodes","_data","_blockEditor","_blocks","useOnEnter","props","batch","useRegistry","moveBlocksToPosition","replaceInnerBlocks","duplicateBlocks","insertBlock","useDispatch","blockEditorStore","getBlockRootClientId","getBlockIndex","getBlockOrder","getBlockName","getBlock","getNextBlockClientId","canInsertBlockType","useSelect","propsRef","useRef","current","useRefEffect","element","onKeyDown","event","defaultPrevented","keyCode","ENTER","content","clientId","length","wrapperClientId","hasBlockSupport","order","position","indexOf","newWrapperClientId","preventDefault","defaultBlockName","getDefaultBlockName","wrapperBlock","blockIndex","innerBlocks","slice","createBlock","addEventListener","removeEventListener"],"sources":["@wordpress/block-library/src/paragraph/use-enter.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { ENTER } from '@wordpress/keycodes';\nimport { useSelect, useDispatch, useRegistry } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport {\n\thasBlockSupport,\n\tcreateBlock,\n\tgetDefaultBlockName,\n} from '@wordpress/blocks';\n\nexport function useOnEnter( props ) {\n\tconst { batch } = useRegistry();\n\tconst {\n\t\tmoveBlocksToPosition,\n\t\treplaceInnerBlocks,\n\t\tduplicateBlocks,\n\t\tinsertBlock,\n\t} = useDispatch( blockEditorStore );\n\tconst {\n\t\tgetBlockRootClientId,\n\t\tgetBlockIndex,\n\t\tgetBlockOrder,\n\t\tgetBlockName,\n\t\tgetBlock,\n\t\tgetNextBlockClientId,\n\t\tcanInsertBlockType,\n\t} = useSelect( blockEditorStore );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode !== ENTER ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { content, clientId } = propsRef.current;\n\n\t\t\t// The paragraph should be empty.\n\t\t\tif ( content.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst wrapperClientId = getBlockRootClientId( clientId );\n\n\t\t\tif (\n\t\t\t\t! hasBlockSupport(\n\t\t\t\t\tgetBlockName( wrapperClientId ),\n\t\t\t\t\t'__experimentalOnEnter',\n\t\t\t\t\tfalse\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst order = getBlockOrder( wrapperClientId );\n\t\t\tconst position = order.indexOf( clientId );\n\n\t\t\t// If it is the last block, exit.\n\t\t\tif ( position === order.length - 1 ) {\n\t\t\t\tlet newWrapperClientId = wrapperClientId;\n\n\t\t\t\twhile (\n\t\t\t\t\t! canInsertBlockType(\n\t\t\t\t\t\tgetBlockName( clientId ),\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId )\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tnewWrapperClientId =\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId );\n\t\t\t\t}\n\n\t\t\t\tif ( typeof newWrapperClientId === 'string' ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tmoveBlocksToPosition(\n\t\t\t\t\t\t[ clientId ],\n\t\t\t\t\t\twrapperClientId,\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId ),\n\t\t\t\t\t\tgetBlockIndex( newWrapperClientId ) + 1\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst defaultBlockName = getDefaultBlockName();\n\n\t\t\tif (\n\t\t\t\t! canInsertBlockType(\n\t\t\t\t\tdefaultBlockName,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId )\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\n\t\t\t// If it is in the middle, split the block in two.\n\t\t\tconst wrapperBlock = getBlock( wrapperClientId );\n\t\t\tbatch( () => {\n\t\t\t\tduplicateBlocks( [ wrapperClientId ] );\n\t\t\t\tconst blockIndex = getBlockIndex( wrapperClientId );\n\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\twrapperClientId,\n\t\t\t\t\twrapperBlock.innerBlocks.slice( 0, position )\n\t\t\t\t);\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\tgetNextBlockClientId( wrapperClientId ),\n\t\t\t\t\twrapperBlock.innerBlocks.slice( position + 1 )\n\t\t\t\t);\n\t\t\t\tinsertBlock(\n\t\t\t\t\tcreateBlock( defaultBlockName ),\n\t\t\t\t\tblockIndex + 1,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId ),\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t} );\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"],"mappings":"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"}