{"version":3,"names":["_i18n","require","_element","_data","_components","_coreData","_notices","_hooks","_transformers","SIDEBARS_QUERY","per_page","_fields","TemplatePartImportControls","area","setAttributes","selectedSidebar","setSelectedSidebar","useState","isBusy","setIsBusy","registry","useRegistry","sidebars","hasResolved","useSelect","select","getSidebars","hasFinishedResolution","coreStore","createErrorNotice","useDispatch","noticesStore","createFromBlocks","useCreateTemplatePartFromBlocks","options","useMemo","sidebarOptions","filter","widgetArea","id","widgets","length","map","value","label","name","__","_react","createElement","__experimentalSpacer","marginBottom","createFromWidgets","event","preventDefault","sidebar","find","getWidgets","resolveSelect","_embed","skippedWidgets","Set","blocks","flatMap","widget","block","transformWidgetToBlock","add","id_base","sprintf","size","Array","from","join","type","__experimentalHStack","as","onSubmit","FlexBlock","SelectControl","onChange","disabled","__next40pxDefaultSize","__nextHasNoMarginBottom","FlexItem","style","marginTop","Button","variant","_x"],"sources":["@wordpress/block-library/src/template-part/edit/import-controls.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { useMemo, useState } from '@wordpress/element';\nimport { useDispatch, useSelect, useRegistry } from '@wordpress/data';\nimport {\n\tButton,\n\tFlexBlock,\n\tFlexItem,\n\tSelectControl,\n\t__experimentalHStack as HStack,\n\t__experimentalSpacer as Spacer,\n} from '@wordpress/components';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as noticesStore } from '@wordpress/notices';\n\n/**\n * Internal dependencies\n */\nimport { useCreateTemplatePartFromBlocks } from './utils/hooks';\nimport { transformWidgetToBlock } from './utils/transformers';\n\nconst SIDEBARS_QUERY = {\n\tper_page: -1,\n\t_fields: 'id,name,description,status,widgets',\n};\n\nexport function TemplatePartImportControls( { area, setAttributes } ) {\n\tconst [ selectedSidebar, setSelectedSidebar ] = useState( '' );\n\tconst [ isBusy, setIsBusy ] = useState( false );\n\n\tconst registry = useRegistry();\n\tconst { sidebars, hasResolved } = useSelect( ( select ) => {\n\t\tconst { getSidebars, hasFinishedResolution } = select( coreStore );\n\n\t\treturn {\n\t\t\tsidebars: getSidebars( SIDEBARS_QUERY ),\n\t\t\thasResolved: hasFinishedResolution( 'getSidebars', [\n\t\t\t\tSIDEBARS_QUERY,\n\t\t\t] ),\n\t\t};\n\t}, [] );\n\tconst { createErrorNotice } = useDispatch( noticesStore );\n\n\tconst createFromBlocks = useCreateTemplatePartFromBlocks(\n\t\tarea,\n\t\tsetAttributes\n\t);\n\n\tconst options = useMemo( () => {\n\t\tconst sidebarOptions = ( sidebars ?? [] )\n\t\t\t.filter(\n\t\t\t\t( widgetArea ) =>\n\t\t\t\t\twidgetArea.id !== 'wp_inactive_widgets' &&\n\t\t\t\t\twidgetArea.widgets.length > 0\n\t\t\t)\n\t\t\t.map( ( widgetArea ) => {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: widgetArea.id,\n\t\t\t\t\tlabel: widgetArea.name,\n\t\t\t\t};\n\t\t\t} );\n\n\t\tif ( ! sidebarOptions.length ) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [\n\t\t\t{ value: '', label: __( 'Select widget area' ) },\n\t\t\t...sidebarOptions,\n\t\t];\n\t}, [ sidebars ] );\n\n\t// Render an empty node while data is loading to avoid SlotFill re-positioning bug.\n\t// See: https://github.com/WordPress/gutenberg/issues/15641.\n\tif ( ! hasResolved ) {\n\t\treturn <Spacer marginBottom=\"0\" />;\n\t}\n\n\tif ( hasResolved && ! options.length ) {\n\t\treturn null;\n\t}\n\n\tasync function createFromWidgets( event ) {\n\t\tevent.preventDefault();\n\n\t\tif ( isBusy || ! selectedSidebar ) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsBusy( true );\n\n\t\tconst sidebar = options.find(\n\t\t\t( { value } ) => value === selectedSidebar\n\t\t);\n\t\tconst { getWidgets } = registry.resolveSelect( coreStore );\n\n\t\t// The widgets API always returns a successful response.\n\t\tconst widgets = await getWidgets( {\n\t\t\tsidebar: sidebar.value,\n\t\t\t_embed: 'about',\n\t\t} );\n\n\t\tconst skippedWidgets = new Set();\n\t\tconst blocks = widgets.flatMap( ( widget ) => {\n\t\t\tconst block = transformWidgetToBlock( widget );\n\n\t\t\t// Skip the block if we have no matching transformations.\n\t\t\tif ( ! block ) {\n\t\t\t\tskippedWidgets.add( widget.id_base );\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn block;\n\t\t} );\n\n\t\tawait createFromBlocks(\n\t\t\tblocks,\n\t\t\t/* translators: %s: name of the widget area */\n\t\t\tsprintf( __( 'Widget area: %s' ), sidebar.label )\n\t\t);\n\n\t\tif ( skippedWidgets.size ) {\n\t\t\tcreateErrorNotice(\n\t\t\t\tsprintf(\n\t\t\t\t\t/* translators: %s: the list of widgets */\n\t\t\t\t\t__( 'Unable to import the following widgets: %s.' ),\n\t\t\t\t\tArray.from( skippedWidgets ).join( ', ' )\n\t\t\t\t),\n\t\t\t\t{\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tsetIsBusy( false );\n\t}\n\n\treturn (\n\t\t<Spacer marginBottom=\"4\">\n\t\t\t<HStack as=\"form\" onSubmit={ createFromWidgets }>\n\t\t\t\t<FlexBlock>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Import widget area' ) }\n\t\t\t\t\t\tvalue={ selectedSidebar }\n\t\t\t\t\t\toptions={ options }\n\t\t\t\t\t\tonChange={ ( value ) => setSelectedSidebar( value ) }\n\t\t\t\t\t\tdisabled={ ! options.length }\n\t\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t/>\n\t\t\t\t</FlexBlock>\n\t\t\t\t<FlexItem\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tmarginBottom: '8px',\n\t\t\t\t\t\tmarginTop: 'auto',\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\tisBusy={ isBusy }\n\t\t\t\t\t\taria-disabled={ isBusy || ! selectedSidebar }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ _x( 'Import', 'button label' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t</FlexItem>\n\t\t\t</HStack>\n\t\t</Spacer>\n\t);\n}\n"],"mappings":"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"}