{"version":3,"names":["useMergeRefs","useFocusableIframe","useRef","useEffect","useMemo","attributeMap","class","frameborder","marginheight","marginwidth","WpEmbedPreview","html","ref","props","doc","window","DOMParser","parseFromString","iframe","querySelector","iframeProps","Array","from","attributes","forEach","name","value","ownerDocument","current","defaultView","resizeWPembeds","data","secret","message","height","addEventListener","removeEventListener","createElement","className","title"],"sources":["@wordpress/block-library/src/embed/wp-embed-preview.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useMergeRefs, useFocusableIframe } from '@wordpress/compose';\nimport { useRef, useEffect, useMemo } from '@wordpress/element';\n\n/** @typedef {import('react').SyntheticEvent} SyntheticEvent */\n\nconst attributeMap = {\n\tclass: 'className',\n\tframeborder: 'frameBorder',\n\tmarginheight: 'marginHeight',\n\tmarginwidth: 'marginWidth',\n};\n\nexport default function WpEmbedPreview( { html } ) {\n\tconst ref = useRef();\n\tconst props = useMemo( () => {\n\t\tconst doc = new window.DOMParser().parseFromString( html, 'text/html' );\n\t\tconst iframe = doc.querySelector( 'iframe' );\n\t\tconst iframeProps = {};\n\n\t\tif ( ! iframe ) return iframeProps;\n\n\t\tArray.from( iframe.attributes ).forEach( ( { name, value } ) => {\n\t\t\tif ( name === 'style' ) return;\n\t\t\tiframeProps[ attributeMap[ name ] || name ] = value;\n\t\t} );\n\n\t\treturn iframeProps;\n\t}, [ html ] );\n\n\tuseEffect( () => {\n\t\tconst { ownerDocument } = ref.current;\n\t\tconst { defaultView } = ownerDocument;\n\n\t\t/**\n\t\t * Checks for WordPress embed events signaling the height change when\n\t\t * iframe content loads or iframe's window is resized.  The event is\n\t\t * sent from WordPress core via the window.postMessage API.\n\t\t *\n\t\t * References:\n\t\t * window.postMessage:\n\t\t * https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage\n\t\t * WordPress core embed-template on load:\n\t\t * https://github.com/WordPress/WordPress/blob/HEAD/wp-includes/js/wp-embed-template.js#L143\n\t\t * WordPress core embed-template on resize:\n\t\t * https://github.com/WordPress/WordPress/blob/HEAD/wp-includes/js/wp-embed-template.js#L187\n\t\t *\n\t\t * @param {MessageEvent} event Message event.\n\t\t */\n\t\tfunction resizeWPembeds( { data: { secret, message, value } = {} } ) {\n\t\t\tif ( message !== 'height' || secret !== props[ 'data-secret' ] ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tref.current.height = value;\n\t\t}\n\n\t\tdefaultView.addEventListener( 'message', resizeWPembeds );\n\t\treturn () => {\n\t\t\tdefaultView.removeEventListener( 'message', resizeWPembeds );\n\t\t};\n\t}, [] );\n\n\treturn (\n\t\t<div className=\"wp-block-embed__wrapper\">\n\t\t\t<iframe\n\t\t\t\tref={ useMergeRefs( [ ref, useFocusableIframe() ] ) }\n\t\t\t\ttitle={ props.title }\n\t\t\t\t{ ...props }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,YAAY,EAAEC,kBAAkB,QAAQ,oBAAoB;AACrE,SAASC,MAAM,EAAEC,SAAS,EAAEC,OAAO,QAAQ,oBAAoB;;AAE/D;;AAEA,MAAMC,YAAY,GAAG;EACpBC,KAAK,EAAE,WAAW;EAClBC,WAAW,EAAE,aAAa;EAC1BC,YAAY,EAAE,cAAc;EAC5BC,WAAW,EAAE;AACd,CAAC;AAED,eAAe,SAASC,cAAcA,CAAE;EAAEC;AAAK,CAAC,EAAG;EAClD,MAAMC,GAAG,GAAGV,MAAM,CAAC,CAAC;EACpB,MAAMW,KAAK,GAAGT,OAAO,CAAE,MAAM;IAC5B,MAAMU,GAAG,GAAG,IAAIC,MAAM,CAACC,SAAS,CAAC,CAAC,CAACC,eAAe,CAAEN,IAAI,EAAE,WAAY,CAAC;IACvE,MAAMO,MAAM,GAAGJ,GAAG,CAACK,aAAa,CAAE,QAAS,CAAC;IAC5C,MAAMC,WAAW,GAAG,CAAC,CAAC;IAEtB,IAAK,CAAEF,MAAM,EAAG,OAAOE,WAAW;IAElCC,KAAK,CAACC,IAAI,CAAEJ,MAAM,CAACK,UAAW,CAAC,CAACC,OAAO,CAAE,CAAE;MAAEC,IAAI;MAAEC;IAAM,CAAC,KAAM;MAC/D,IAAKD,IAAI,KAAK,OAAO,EAAG;MACxBL,WAAW,CAAEf,YAAY,CAAEoB,IAAI,CAAE,IAAIA,IAAI,CAAE,GAAGC,KAAK;IACpD,CAAE,CAAC;IAEH,OAAON,WAAW;EACnB,CAAC,EAAE,CAAET,IAAI,CAAG,CAAC;EAEbR,SAAS,CAAE,MAAM;IAChB,MAAM;MAAEwB;IAAc,CAAC,GAAGf,GAAG,CAACgB,OAAO;IACrC,MAAM;MAAEC;IAAY,CAAC,GAAGF,aAAa;;IAErC;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;IACE,SAASG,cAAcA,CAAE;MAAEC,IAAI,EAAE;QAAEC,MAAM;QAAEC,OAAO;QAAEP;MAAM,CAAC,GAAG,CAAC;IAAE,CAAC,EAAG;MACpE,IAAKO,OAAO,KAAK,QAAQ,IAAID,MAAM,KAAKnB,KAAK,CAAE,aAAa,CAAE,EAAG;QAChE;MACD;MAEAD,GAAG,CAACgB,OAAO,CAACM,MAAM,GAAGR,KAAK;IAC3B;IAEAG,WAAW,CAACM,gBAAgB,CAAE,SAAS,EAAEL,cAAe,CAAC;IACzD,OAAO,MAAM;MACZD,WAAW,CAACO,mBAAmB,CAAE,SAAS,EAAEN,cAAe,CAAC;IAC7D,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,OACCO,aAAA;IAAKC,SAAS,EAAC;EAAyB,GACvCD,aAAA;IACCzB,GAAG,EAAGZ,YAAY,CAAE,CAAEY,GAAG,EAAEX,kBAAkB,CAAC,CAAC,CAAG,CAAG;IACrDsC,KAAK,EAAG1B,KAAK,CAAC0B,KAAO;IAAA,GAChB1B;EAAK,CACV,CACG,CAAC;AAER"}