{"version":3,"names":["memoize","calendar","icon","Disabled","Placeholder","Spinner","useSelect","ServerSideRender","useBlockProps","store","coreStore","__","getYearMonth","date","dateObj","Date","year","getFullYear","month","getMonth","CalendarEdit","attributes","blockProps","hasPosts","hasPostsResolved","select","getEntityRecords","hasFinishedResolution","singlePublishedPostQuery","status","per_page","posts","postsResolved","_date","editorSelectors","postType","getEditedPostAttribute","length","createElement","label","block"],"sources":["@wordpress/block-library/src/calendar/edit.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport memoize from 'memize';\n\n/**\n * WordPress dependencies\n */\nimport { calendar as icon } from '@wordpress/icons';\nimport { Disabled, Placeholder, Spinner } from '@wordpress/components';\nimport { useSelect } from '@wordpress/data';\nimport ServerSideRender from '@wordpress/server-side-render';\nimport { useBlockProps } from '@wordpress/block-editor';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Returns the year and month of a specified date.\n *\n * @see `WP_REST_Posts_Controller::prepare_date_response()`.\n *\n * @param {string} date Date in `ISO8601/RFC3339` format.\n * @return {Object} Year and date of the specified date.\n */\nconst getYearMonth = memoize( ( date ) => {\n\tif ( ! date ) {\n\t\treturn {};\n\t}\n\tconst dateObj = new Date( date );\n\treturn {\n\t\tyear: dateObj.getFullYear(),\n\t\tmonth: dateObj.getMonth() + 1,\n\t};\n} );\n\nexport default function CalendarEdit( { attributes } ) {\n\tconst blockProps = useBlockProps();\n\tconst { date, hasPosts, hasPostsResolved } = useSelect( ( select ) => {\n\t\tconst { getEntityRecords, hasFinishedResolution } = select( coreStore );\n\n\t\tconst singlePublishedPostQuery = {\n\t\t\tstatus: 'publish',\n\t\t\tper_page: 1,\n\t\t};\n\t\tconst posts = getEntityRecords(\n\t\t\t'postType',\n\t\t\t'post',\n\t\t\tsinglePublishedPostQuery\n\t\t);\n\t\tconst postsResolved = hasFinishedResolution( 'getEntityRecords', [\n\t\t\t'postType',\n\t\t\t'post',\n\t\t\tsinglePublishedPostQuery,\n\t\t] );\n\n\t\tlet _date;\n\n\t\t// FIXME: @wordpress/block-library should not depend on @wordpress/editor.\n\t\t// Blocks can be loaded into a *non-post* block editor.\n\t\t// eslint-disable-next-line @wordpress/data-no-store-string-literals\n\t\tconst editorSelectors = select( 'core/editor' );\n\t\tif ( editorSelectors ) {\n\t\t\tconst postType = editorSelectors.getEditedPostAttribute( 'type' );\n\t\t\t// Dates are used to overwrite year and month used on the calendar.\n\t\t\t// This overwrite should only happen for 'post' post types.\n\t\t\t// For other post types the calendar always displays the current month.\n\t\t\tif ( postType === 'post' ) {\n\t\t\t\t_date = editorSelectors.getEditedPostAttribute( 'date' );\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tdate: _date,\n\t\t\thasPostsResolved: postsResolved,\n\t\t\thasPosts: postsResolved && posts?.length === 1,\n\t\t};\n\t}, [] );\n\n\tif ( ! hasPosts ) {\n\t\treturn (\n\t\t\t<div { ...blockProps }>\n\t\t\t\t<Placeholder icon={ icon } label={ __( 'Calendar' ) }>\n\t\t\t\t\t{ ! hasPostsResolved ? (\n\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t) : (\n\t\t\t\t\t\t__( 'No published posts found.' )\n\t\t\t\t\t) }\n\t\t\t\t</Placeholder>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div { ...blockProps }>\n\t\t\t<Disabled>\n\t\t\t\t<ServerSideRender\n\t\t\t\t\tblock=\"core/calendar\"\n\t\t\t\t\tattributes={ { ...attributes, ...getYearMonth( date ) } }\n\t\t\t\t/>\n\t\t\t</Disabled>\n\t\t</div>\n\t);\n}\n"],"mappings":";AAAA;AACA;AACA;AACA,OAAOA,OAAO,MAAM,QAAQ;;AAE5B;AACA;AACA;AACA,SAASC,QAAQ,IAAIC,IAAI,QAAQ,kBAAkB;AACnD,SAASC,QAAQ,EAAEC,WAAW,EAAEC,OAAO,QAAQ,uBAAuB;AACtE,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,OAAOC,gBAAgB,MAAM,+BAA+B;AAC5D,SAASC,aAAa,QAAQ,yBAAyB;AACvD,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;AACzD,SAASC,EAAE,QAAQ,iBAAiB;;AAEpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMC,YAAY,GAAGZ,OAAO,CAAIa,IAAI,IAAM;EACzC,IAAK,CAAEA,IAAI,EAAG;IACb,OAAO,CAAC,CAAC;EACV;EACA,MAAMC,OAAO,GAAG,IAAIC,IAAI,CAAEF,IAAK,CAAC;EAChC,OAAO;IACNG,IAAI,EAAEF,OAAO,CAACG,WAAW,CAAC,CAAC;IAC3BC,KAAK,EAAEJ,OAAO,CAACK,QAAQ,CAAC,CAAC,GAAG;EAC7B,CAAC;AACF,CAAE,CAAC;AAEH,eAAe,SAASC,YAAYA,CAAE;EAAEC;AAAW,CAAC,EAAG;EACtD,MAAMC,UAAU,GAAGd,aAAa,CAAC,CAAC;EAClC,MAAM;IAAEK,IAAI;IAAEU,QAAQ;IAAEC;EAAiB,CAAC,GAAGlB,SAAS,CAAImB,MAAM,IAAM;IACrE,MAAM;MAAEC,gBAAgB;MAAEC;IAAsB,CAAC,GAAGF,MAAM,CAAEf,SAAU,CAAC;IAEvE,MAAMkB,wBAAwB,GAAG;MAChCC,MAAM,EAAE,SAAS;MACjBC,QAAQ,EAAE;IACX,CAAC;IACD,MAAMC,KAAK,GAAGL,gBAAgB,CAC7B,UAAU,EACV,MAAM,EACNE,wBACD,CAAC;IACD,MAAMI,aAAa,GAAGL,qBAAqB,CAAE,kBAAkB,EAAE,CAChE,UAAU,EACV,MAAM,EACNC,wBAAwB,CACvB,CAAC;IAEH,IAAIK,KAAK;;IAET;IACA;IACA;IACA,MAAMC,eAAe,GAAGT,MAAM,CAAE,aAAc,CAAC;IAC/C,IAAKS,eAAe,EAAG;MACtB,MAAMC,QAAQ,GAAGD,eAAe,CAACE,sBAAsB,CAAE,MAAO,CAAC;MACjE;MACA;MACA;MACA,IAAKD,QAAQ,KAAK,MAAM,EAAG;QAC1BF,KAAK,GAAGC,eAAe,CAACE,sBAAsB,CAAE,MAAO,CAAC;MACzD;IACD;IAEA,OAAO;MACNvB,IAAI,EAAEoB,KAAK;MACXT,gBAAgB,EAAEQ,aAAa;MAC/BT,QAAQ,EAAES,aAAa,IAAID,KAAK,EAAEM,MAAM,KAAK;IAC9C,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,IAAK,CAAEd,QAAQ,EAAG;IACjB,OACCe,aAAA;MAAA,GAAUhB;IAAU,GACnBgB,aAAA,CAAClC,WAAW;MAACF,IAAI,EAAGA,IAAM;MAACqC,KAAK,EAAG5B,EAAE,CAAE,UAAW;IAAG,GAClD,CAAEa,gBAAgB,GACnBc,aAAA,CAACjC,OAAO,MAAE,CAAC,GAEXM,EAAE,CAAE,2BAA4B,CAErB,CACT,CAAC;EAER;EAEA,OACC2B,aAAA;IAAA,GAAUhB;EAAU,GACnBgB,aAAA,CAACnC,QAAQ,QACRmC,aAAA,CAAC/B,gBAAgB;IAChBiC,KAAK,EAAC,eAAe;IACrBnB,UAAU,EAAG;MAAE,GAAGA,UAAU;MAAE,GAAGT,YAAY,CAAEC,IAAK;IAAE;EAAG,CACzD,CACQ,CACN,CAAC;AAER"}