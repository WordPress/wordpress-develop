{"version":3,"names":["parse","cloneBlock","createBlock","getGroupingBlockName","getPossibleBlockTransformations","switchToBlockType","transformWidgetToBlock","widget","id_base","attributes","_embedded","about","is_multi","idBase","instance","id","switchLegacyWidgetType","parsedBlocks","raw","content","__unstableSkipAutop","length","undefined","block","name","transformInnerBlocks","innerBlocks","transforms","filter","item","hasWildCardFrom","from","find","blocks","includes","hasWildCardTo","to","flatMap"],"sources":["@wordpress/block-library/src/template-part/edit/utils/transformers.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport {\n\tparse,\n\tcloneBlock,\n\tcreateBlock,\n\tgetGroupingBlockName,\n\tgetPossibleBlockTransformations,\n\tswitchToBlockType,\n} from '@wordpress/blocks';\n\n/**\n * Converts a widget entity record into a block.\n *\n * @param {Object} widget The widget entity record.\n * @return {Object} a block (converted from the entity record).\n */\nexport function transformWidgetToBlock( widget ) {\n\tif ( widget.id_base !== 'block' ) {\n\t\tlet attributes;\n\t\tif ( widget._embedded.about[ 0 ].is_multi ) {\n\t\t\tattributes = {\n\t\t\t\tidBase: widget.id_base,\n\t\t\t\tinstance: widget.instance,\n\t\t\t};\n\t\t} else {\n\t\t\tattributes = {\n\t\t\t\tid: widget.id,\n\t\t\t};\n\t\t}\n\n\t\treturn switchLegacyWidgetType(\n\t\t\tcreateBlock( 'core/legacy-widget', attributes )\n\t\t);\n\t}\n\n\tconst parsedBlocks = parse( widget.instance.raw.content, {\n\t\t__unstableSkipAutop: true,\n\t} );\n\n\tif ( ! parsedBlocks.length ) {\n\t\treturn undefined;\n\t}\n\n\tconst block = parsedBlocks[ 0 ];\n\n\tif ( block.name === 'core/widget-group' ) {\n\t\treturn createBlock(\n\t\t\tgetGroupingBlockName(),\n\t\t\tundefined,\n\t\t\ttransformInnerBlocks( block.innerBlocks )\n\t\t);\n\t}\n\n\tif ( block.innerBlocks.length > 0 ) {\n\t\treturn cloneBlock(\n\t\t\tblock,\n\t\t\tundefined,\n\t\t\ttransformInnerBlocks( block.innerBlocks )\n\t\t);\n\t}\n\n\treturn block;\n}\n\n/**\n * Switch Legacy Widget to the first matching transformation block.\n *\n * @param {Object} block Legacy Widget block object\n * @return {Object|undefined} a block\n */\nfunction switchLegacyWidgetType( block ) {\n\tconst transforms = getPossibleBlockTransformations( [ block ] ).filter(\n\t\t( item ) => {\n\t\t\t// The block without any transformations can't be a wildcard.\n\t\t\tif ( ! item.transforms ) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst hasWildCardFrom = item.transforms?.from?.find(\n\t\t\t\t( from ) => from.blocks && from.blocks.includes( '*' )\n\t\t\t);\n\t\t\tconst hasWildCardTo = item.transforms?.to?.find(\n\t\t\t\t( to ) => to.blocks && to.blocks.includes( '*' )\n\t\t\t);\n\n\t\t\t// Skip wildcard transformations.\n\t\t\treturn ! hasWildCardFrom && ! hasWildCardTo;\n\t\t}\n\t);\n\n\tif ( ! transforms.length ) {\n\t\treturn undefined;\n\t}\n\n\treturn switchToBlockType( block, transforms[ 0 ].name );\n}\n\nfunction transformInnerBlocks( innerBlocks = [] ) {\n\treturn innerBlocks\n\t\t.flatMap( ( block ) => {\n\t\t\tif ( block.name === 'core/legacy-widget' ) {\n\t\t\t\treturn switchLegacyWidgetType( block );\n\t\t\t}\n\n\t\t\treturn createBlock(\n\t\t\t\tblock.name,\n\t\t\t\tblock.attributes,\n\t\t\t\ttransformInnerBlocks( block.innerBlocks )\n\t\t\t);\n\t\t} )\n\t\t.filter( ( block ) => !! block );\n}\n"],"mappings":"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"}