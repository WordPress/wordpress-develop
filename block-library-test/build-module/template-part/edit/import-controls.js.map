{"version":3,"names":["__","_x","sprintf","useMemo","useState","useDispatch","useSelect","useRegistry","Button","FlexBlock","FlexItem","SelectControl","__experimentalHStack","HStack","__experimentalSpacer","Spacer","store","coreStore","noticesStore","useCreateTemplatePartFromBlocks","transformWidgetToBlock","SIDEBARS_QUERY","per_page","_fields","TemplatePartImportControls","area","setAttributes","selectedSidebar","setSelectedSidebar","isBusy","setIsBusy","registry","sidebars","hasResolved","select","getSidebars","hasFinishedResolution","createErrorNotice","createFromBlocks","options","sidebarOptions","filter","widgetArea","id","widgets","length","map","value","label","name","createElement","marginBottom","createFromWidgets","event","preventDefault","sidebar","find","getWidgets","resolveSelect","_embed","skippedWidgets","Set","blocks","flatMap","widget","block","add","id_base","size","Array","from","join","type","as","onSubmit","onChange","disabled","__next40pxDefaultSize","__nextHasNoMarginBottom","style","marginTop","variant"],"sources":["@wordpress/block-library/src/template-part/edit/import-controls.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { useMemo, useState } from '@wordpress/element';\nimport { useDispatch, useSelect, useRegistry } from '@wordpress/data';\nimport {\n\tButton,\n\tFlexBlock,\n\tFlexItem,\n\tSelectControl,\n\t__experimentalHStack as HStack,\n\t__experimentalSpacer as Spacer,\n} from '@wordpress/components';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as noticesStore } from '@wordpress/notices';\n\n/**\n * Internal dependencies\n */\nimport { useCreateTemplatePartFromBlocks } from './utils/hooks';\nimport { transformWidgetToBlock } from './utils/transformers';\n\nconst SIDEBARS_QUERY = {\n\tper_page: -1,\n\t_fields: 'id,name,description,status,widgets',\n};\n\nexport function TemplatePartImportControls( { area, setAttributes } ) {\n\tconst [ selectedSidebar, setSelectedSidebar ] = useState( '' );\n\tconst [ isBusy, setIsBusy ] = useState( false );\n\n\tconst registry = useRegistry();\n\tconst { sidebars, hasResolved } = useSelect( ( select ) => {\n\t\tconst { getSidebars, hasFinishedResolution } = select( coreStore );\n\n\t\treturn {\n\t\t\tsidebars: getSidebars( SIDEBARS_QUERY ),\n\t\t\thasResolved: hasFinishedResolution( 'getSidebars', [\n\t\t\t\tSIDEBARS_QUERY,\n\t\t\t] ),\n\t\t};\n\t}, [] );\n\tconst { createErrorNotice } = useDispatch( noticesStore );\n\n\tconst createFromBlocks = useCreateTemplatePartFromBlocks(\n\t\tarea,\n\t\tsetAttributes\n\t);\n\n\tconst options = useMemo( () => {\n\t\tconst sidebarOptions = ( sidebars ?? [] )\n\t\t\t.filter(\n\t\t\t\t( widgetArea ) =>\n\t\t\t\t\twidgetArea.id !== 'wp_inactive_widgets' &&\n\t\t\t\t\twidgetArea.widgets.length > 0\n\t\t\t)\n\t\t\t.map( ( widgetArea ) => {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: widgetArea.id,\n\t\t\t\t\tlabel: widgetArea.name,\n\t\t\t\t};\n\t\t\t} );\n\n\t\tif ( ! sidebarOptions.length ) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [\n\t\t\t{ value: '', label: __( 'Select widget area' ) },\n\t\t\t...sidebarOptions,\n\t\t];\n\t}, [ sidebars ] );\n\n\t// Render an empty node while data is loading to avoid SlotFill re-positioning bug.\n\t// See: https://github.com/WordPress/gutenberg/issues/15641.\n\tif ( ! hasResolved ) {\n\t\treturn <Spacer marginBottom=\"0\" />;\n\t}\n\n\tif ( hasResolved && ! options.length ) {\n\t\treturn null;\n\t}\n\n\tasync function createFromWidgets( event ) {\n\t\tevent.preventDefault();\n\n\t\tif ( isBusy || ! selectedSidebar ) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetIsBusy( true );\n\n\t\tconst sidebar = options.find(\n\t\t\t( { value } ) => value === selectedSidebar\n\t\t);\n\t\tconst { getWidgets } = registry.resolveSelect( coreStore );\n\n\t\t// The widgets API always returns a successful response.\n\t\tconst widgets = await getWidgets( {\n\t\t\tsidebar: sidebar.value,\n\t\t\t_embed: 'about',\n\t\t} );\n\n\t\tconst skippedWidgets = new Set();\n\t\tconst blocks = widgets.flatMap( ( widget ) => {\n\t\t\tconst block = transformWidgetToBlock( widget );\n\n\t\t\t// Skip the block if we have no matching transformations.\n\t\t\tif ( ! block ) {\n\t\t\t\tskippedWidgets.add( widget.id_base );\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn block;\n\t\t} );\n\n\t\tawait createFromBlocks(\n\t\t\tblocks,\n\t\t\t/* translators: %s: name of the widget area */\n\t\t\tsprintf( __( 'Widget area: %s' ), sidebar.label )\n\t\t);\n\n\t\tif ( skippedWidgets.size ) {\n\t\t\tcreateErrorNotice(\n\t\t\t\tsprintf(\n\t\t\t\t\t/* translators: %s: the list of widgets */\n\t\t\t\t\t__( 'Unable to import the following widgets: %s.' ),\n\t\t\t\t\tArray.from( skippedWidgets ).join( ', ' )\n\t\t\t\t),\n\t\t\t\t{\n\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tsetIsBusy( false );\n\t}\n\n\treturn (\n\t\t<Spacer marginBottom=\"4\">\n\t\t\t<HStack as=\"form\" onSubmit={ createFromWidgets }>\n\t\t\t\t<FlexBlock>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Import widget area' ) }\n\t\t\t\t\t\tvalue={ selectedSidebar }\n\t\t\t\t\t\toptions={ options }\n\t\t\t\t\t\tonChange={ ( value ) => setSelectedSidebar( value ) }\n\t\t\t\t\t\tdisabled={ ! options.length }\n\t\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t/>\n\t\t\t\t</FlexBlock>\n\t\t\t\t<FlexItem\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tmarginBottom: '8px',\n\t\t\t\t\t\tmarginTop: 'auto',\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t__next40pxDefaultSize\n\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\tisBusy={ isBusy }\n\t\t\t\t\t\taria-disabled={ isBusy || ! selectedSidebar }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ _x( 'Import', 'button label' ) }\n\t\t\t\t\t</Button>\n\t\t\t\t</FlexItem>\n\t\t\t</HStack>\n\t\t</Spacer>\n\t);\n}\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,EAAE,EAAEC,EAAE,EAAEC,OAAO,QAAQ,iBAAiB;AACjD,SAASC,OAAO,EAAEC,QAAQ,QAAQ,oBAAoB;AACtD,SAASC,WAAW,EAAEC,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACrE,SACCC,MAAM,EACNC,SAAS,EACTC,QAAQ,EACRC,aAAa,EACbC,oBAAoB,IAAIC,MAAM,EAC9BC,oBAAoB,IAAIC,MAAM,QACxB,uBAAuB;AAC9B,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;AACzD,SAASD,KAAK,IAAIE,YAAY,QAAQ,oBAAoB;;AAE1D;AACA;AACA;AACA,SAASC,+BAA+B,QAAQ,eAAe;AAC/D,SAASC,sBAAsB,QAAQ,sBAAsB;AAE7D,MAAMC,cAAc,GAAG;EACtBC,QAAQ,EAAE,CAAC,CAAC;EACZC,OAAO,EAAE;AACV,CAAC;AAED,OAAO,SAASC,0BAA0BA,CAAE;EAAEC,IAAI;EAAEC;AAAc,CAAC,EAAG;EACrE,MAAM,CAAEC,eAAe,EAAEC,kBAAkB,CAAE,GAAGxB,QAAQ,CAAE,EAAG,CAAC;EAC9D,MAAM,CAAEyB,MAAM,EAAEC,SAAS,CAAE,GAAG1B,QAAQ,CAAE,KAAM,CAAC;EAE/C,MAAM2B,QAAQ,GAAGxB,WAAW,CAAC,CAAC;EAC9B,MAAM;IAAEyB,QAAQ;IAAEC;EAAY,CAAC,GAAG3B,SAAS,CAAI4B,MAAM,IAAM;IAC1D,MAAM;MAAEC,WAAW;MAAEC;IAAsB,CAAC,GAAGF,MAAM,CAAEjB,SAAU,CAAC;IAElE,OAAO;MACNe,QAAQ,EAAEG,WAAW,CAAEd,cAAe,CAAC;MACvCY,WAAW,EAAEG,qBAAqB,CAAE,aAAa,EAAE,CAClDf,cAAc,CACb;IACH,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EACP,MAAM;IAAEgB;EAAkB,CAAC,GAAGhC,WAAW,CAAEa,YAAa,CAAC;EAEzD,MAAMoB,gBAAgB,GAAGnB,+BAA+B,CACvDM,IAAI,EACJC,aACD,CAAC;EAED,MAAMa,OAAO,GAAGpC,OAAO,CAAE,MAAM;IAC9B,MAAMqC,cAAc,GAAG,CAAER,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAAI,EAAE,EACrCS,MAAM,CACJC,UAAU,IACXA,UAAU,CAACC,EAAE,KAAK,qBAAqB,IACvCD,UAAU,CAACE,OAAO,CAACC,MAAM,GAAG,CAC9B,CAAC,CACAC,GAAG,CAAIJ,UAAU,IAAM;MACvB,OAAO;QACNK,KAAK,EAAEL,UAAU,CAACC,EAAE;QACpBK,KAAK,EAAEN,UAAU,CAACO;MACnB,CAAC;IACF,CAAE,CAAC;IAEJ,IAAK,CAAET,cAAc,CAACK,MAAM,EAAG;MAC9B,OAAO,EAAE;IACV;IAEA,OAAO,CACN;MAAEE,KAAK,EAAE,EAAE;MAAEC,KAAK,EAAEhD,EAAE,CAAE,oBAAqB;IAAE,CAAC,EAChD,GAAGwC,cAAc,CACjB;EACF,CAAC,EAAE,CAAER,QAAQ,CAAG,CAAC;;EAEjB;EACA;EACA,IAAK,CAAEC,WAAW,EAAG;IACpB,OAAOiB,aAAA,CAACnC,MAAM;MAACoC,YAAY,EAAC;IAAG,CAAE,CAAC;EACnC;EAEA,IAAKlB,WAAW,IAAI,CAAEM,OAAO,CAACM,MAAM,EAAG;IACtC,OAAO,IAAI;EACZ;EAEA,eAAeO,iBAAiBA,CAAEC,KAAK,EAAG;IACzCA,KAAK,CAACC,cAAc,CAAC,CAAC;IAEtB,IAAKzB,MAAM,IAAI,CAAEF,eAAe,EAAG;MAClC;IACD;IAEAG,SAAS,CAAE,IAAK,CAAC;IAEjB,MAAMyB,OAAO,GAAGhB,OAAO,CAACiB,IAAI,CAC3B,CAAE;MAAET;IAAM,CAAC,KAAMA,KAAK,KAAKpB,eAC5B,CAAC;IACD,MAAM;MAAE8B;IAAW,CAAC,GAAG1B,QAAQ,CAAC2B,aAAa,CAAEzC,SAAU,CAAC;;IAE1D;IACA,MAAM2B,OAAO,GAAG,MAAMa,UAAU,CAAE;MACjCF,OAAO,EAAEA,OAAO,CAACR,KAAK;MACtBY,MAAM,EAAE;IACT,CAAE,CAAC;IAEH,MAAMC,cAAc,GAAG,IAAIC,GAAG,CAAC,CAAC;IAChC,MAAMC,MAAM,GAAGlB,OAAO,CAACmB,OAAO,CAAIC,MAAM,IAAM;MAC7C,MAAMC,KAAK,GAAG7C,sBAAsB,CAAE4C,MAAO,CAAC;;MAE9C;MACA,IAAK,CAAEC,KAAK,EAAG;QACdL,cAAc,CAACM,GAAG,CAAEF,MAAM,CAACG,OAAQ,CAAC;QACpC,OAAO,EAAE;MACV;MAEA,OAAOF,KAAK;IACb,CAAE,CAAC;IAEH,MAAM3B,gBAAgB,CACrBwB,MAAM,EACN;IACA5D,OAAO,CAAEF,EAAE,CAAE,iBAAkB,CAAC,EAAEuD,OAAO,CAACP,KAAM,CACjD,CAAC;IAED,IAAKY,cAAc,CAACQ,IAAI,EAAG;MAC1B/B,iBAAiB,CAChBnC,OAAO,EACN;MACAF,EAAE,CAAE,6CAA8C,CAAC,EACnDqE,KAAK,CAACC,IAAI,CAAEV,cAAe,CAAC,CAACW,IAAI,CAAE,IAAK,CACzC,CAAC,EACD;QACCC,IAAI,EAAE;MACP,CACD,CAAC;IACF;IAEA1C,SAAS,CAAE,KAAM,CAAC;EACnB;EAEA,OACCoB,aAAA,CAACnC,MAAM;IAACoC,YAAY,EAAC;EAAG,GACvBD,aAAA,CAACrC,MAAM;IAAC4D,EAAE,EAAC,MAAM;IAACC,QAAQ,EAAGtB;EAAmB,GAC/CF,aAAA,CAACzC,SAAS,QACTyC,aAAA,CAACvC,aAAa;IACbqC,KAAK,EAAGhD,EAAE,CAAE,oBAAqB,CAAG;IACpC+C,KAAK,EAAGpB,eAAiB;IACzBY,OAAO,EAAGA,OAAS;IACnBoC,QAAQ,EAAK5B,KAAK,IAAMnB,kBAAkB,CAAEmB,KAAM,CAAG;IACrD6B,QAAQ,EAAG,CAAErC,OAAO,CAACM,MAAQ;IAC7BgC,qBAAqB;IACrBC,uBAAuB;EAAA,CACvB,CACS,CAAC,EACZ5B,aAAA,CAACxC,QAAQ;IACRqE,KAAK,EAAG;MACP5B,YAAY,EAAE,KAAK;MACnB6B,SAAS,EAAE;IACZ;EAAG,GAEH9B,aAAA,CAAC1C,MAAM;IACNqE,qBAAqB;IACrBI,OAAO,EAAC,SAAS;IACjBT,IAAI,EAAC,QAAQ;IACb3C,MAAM,EAAGA,MAAQ;IACjB,iBAAgBA,MAAM,IAAI,CAAEF;EAAiB,GAE3C1B,EAAE,CAAE,QAAQ,EAAE,cAAe,CACxB,CACC,CACH,CACD,CAAC;AAEX"}