{"version":3,"names":["__","FormTokenField","useSelect","store","coreStore","getEntitiesInfo","AUTHORS_QUERY","who","per_page","_fields","context","AuthorControl","value","onChange","authorsList","select","getUsers","authorsInfo","normalizedValue","toString","split","sanitizedValue","reduce","accumulator","authorId","author","mapById","push","id","name","getIdByValue","entitiesMappedByName","authorValue","onAuthorChange","newValue","ids","Array","from","mapByName","add","Set","join","createElement","label","suggestions","names","__experimentalShowHowTo"],"sources":["@wordpress/block-library/src/query/edit/inspector-controls/author-control.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { FormTokenField } from '@wordpress/components';\nimport { useSelect } from '@wordpress/data';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport { getEntitiesInfo } from '../../utils';\n\nconst AUTHORS_QUERY = {\n\twho: 'authors',\n\tper_page: -1,\n\t_fields: 'id,name',\n\tcontext: 'view',\n};\n\nfunction AuthorControl( { value, onChange } ) {\n\tconst authorsList = useSelect( ( select ) => {\n\t\tconst { getUsers } = select( coreStore );\n\t\treturn getUsers( AUTHORS_QUERY );\n\t}, [] );\n\n\tif ( ! authorsList ) {\n\t\treturn null;\n\t}\n\tconst authorsInfo = getEntitiesInfo( authorsList );\n\t/**\n\t * We need to normalize the value because the block operates on a\n\t * comma(`,`) separated string value and `FormTokenFiels` needs an\n\t * array.\n\t */\n\tconst normalizedValue = ! value ? [] : value.toString().split( ',' );\n\t// Returns only the existing authors ids. This prevents the component\n\t// from crashing in the editor, when non existing ids are provided.\n\tconst sanitizedValue = normalizedValue.reduce(\n\t\t( accumulator, authorId ) => {\n\t\t\tconst author = authorsInfo.mapById[ authorId ];\n\t\t\tif ( author ) {\n\t\t\t\taccumulator.push( {\n\t\t\t\t\tid: authorId,\n\t\t\t\t\tvalue: author.name,\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn accumulator;\n\t\t},\n\t\t[]\n\t);\n\n\tconst getIdByValue = ( entitiesMappedByName, authorValue ) => {\n\t\tconst id = authorValue?.id || entitiesMappedByName[ authorValue ]?.id;\n\t\tif ( id ) return id;\n\t};\n\tconst onAuthorChange = ( newValue ) => {\n\t\tconst ids = Array.from(\n\t\t\tnewValue.reduce( ( accumulator, author ) => {\n\t\t\t\t// Verify that new values point to existing entities.\n\t\t\t\tconst id = getIdByValue( authorsInfo.mapByName, author );\n\t\t\t\tif ( id ) accumulator.add( id );\n\t\t\t\treturn accumulator;\n\t\t\t}, new Set() )\n\t\t);\n\t\tonChange( { author: ids.join( ',' ) } );\n\t};\n\treturn (\n\t\t<FormTokenField\n\t\t\tlabel={ __( 'Authors' ) }\n\t\t\tvalue={ sanitizedValue }\n\t\t\tsuggestions={ authorsInfo.names }\n\t\t\tonChange={ onAuthorChange }\n\t\t\t__experimentalShowHowTo={ false }\n\t\t/>\n\t);\n}\n\nexport default AuthorControl;\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,EAAE,QAAQ,iBAAiB;AACpC,SAASC,cAAc,QAAQ,uBAAuB;AACtD,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,KAAK,IAAIC,SAAS,QAAQ,sBAAsB;;AAEzD;AACA;AACA;AACA,SAASC,eAAe,QAAQ,aAAa;AAE7C,MAAMC,aAAa,GAAG;EACrBC,GAAG,EAAE,SAAS;EACdC,QAAQ,EAAE,CAAC,CAAC;EACZC,OAAO,EAAE,SAAS;EAClBC,OAAO,EAAE;AACV,CAAC;AAED,SAASC,aAAaA,CAAE;EAAEC,KAAK;EAAEC;AAAS,CAAC,EAAG;EAC7C,MAAMC,WAAW,GAAGZ,SAAS,CAAIa,MAAM,IAAM;IAC5C,MAAM;MAAEC;IAAS,CAAC,GAAGD,MAAM,CAAEX,SAAU,CAAC;IACxC,OAAOY,QAAQ,CAAEV,aAAc,CAAC;EACjC,CAAC,EAAE,EAAG,CAAC;EAEP,IAAK,CAAEQ,WAAW,EAAG;IACpB,OAAO,IAAI;EACZ;EACA,MAAMG,WAAW,GAAGZ,eAAe,CAAES,WAAY,CAAC;EAClD;AACD;AACA;AACA;AACA;EACC,MAAMI,eAAe,GAAG,CAAEN,KAAK,GAAG,EAAE,GAAGA,KAAK,CAACO,QAAQ,CAAC,CAAC,CAACC,KAAK,CAAE,GAAI,CAAC;EACpE;EACA;EACA,MAAMC,cAAc,GAAGH,eAAe,CAACI,MAAM,CAC5C,CAAEC,WAAW,EAAEC,QAAQ,KAAM;IAC5B,MAAMC,MAAM,GAAGR,WAAW,CAACS,OAAO,CAAEF,QAAQ,CAAE;IAC9C,IAAKC,MAAM,EAAG;MACbF,WAAW,CAACI,IAAI,CAAE;QACjBC,EAAE,EAAEJ,QAAQ;QACZZ,KAAK,EAAEa,MAAM,CAACI;MACf,CAAE,CAAC;IACJ;IACA,OAAON,WAAW;EACnB,CAAC,EACD,EACD,CAAC;EAED,MAAMO,YAAY,GAAGA,CAAEC,oBAAoB,EAAEC,WAAW,KAAM;IAC7D,MAAMJ,EAAE,GAAGI,WAAW,EAAEJ,EAAE,IAAIG,oBAAoB,CAAEC,WAAW,CAAE,EAAEJ,EAAE;IACrE,IAAKA,EAAE,EAAG,OAAOA,EAAE;EACpB,CAAC;EACD,MAAMK,cAAc,GAAKC,QAAQ,IAAM;IACtC,MAAMC,GAAG,GAAGC,KAAK,CAACC,IAAI,CACrBH,QAAQ,CAACZ,MAAM,CAAE,CAAEC,WAAW,EAAEE,MAAM,KAAM;MAC3C;MACA,MAAMG,EAAE,GAAGE,YAAY,CAAEb,WAAW,CAACqB,SAAS,EAAEb,MAAO,CAAC;MACxD,IAAKG,EAAE,EAAGL,WAAW,CAACgB,GAAG,CAAEX,EAAG,CAAC;MAC/B,OAAOL,WAAW;IACnB,CAAC,EAAE,IAAIiB,GAAG,CAAC,CAAE,CACd,CAAC;IACD3B,QAAQ,CAAE;MAAEY,MAAM,EAAEU,GAAG,CAACM,IAAI,CAAE,GAAI;IAAE,CAAE,CAAC;EACxC,CAAC;EACD,OACCC,aAAA,CAACzC,cAAc;IACd0C,KAAK,EAAG3C,EAAE,CAAE,SAAU,CAAG;IACzBY,KAAK,EAAGS,cAAgB;IACxBuB,WAAW,EAAG3B,WAAW,CAAC4B,KAAO;IACjChC,QAAQ,EAAGoB,cAAgB;IAC3Ba,uBAAuB,EAAG;EAAO,CACjC,CAAC;AAEJ;AAEA,eAAenC,aAAa"}