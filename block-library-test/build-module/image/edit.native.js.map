{"version":3,"names":["ActivityIndicator","Image","RNImage","TouchableWithoutFeedback","View","useRoute","Component","useEffect","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","setFeaturedImage","Icon","PanelBody","ToolbarButton","ToolbarGroup","WIDE_ALIGNMENTS","LinkSettingsNavigation","BottomSheet","BottomSheetTextControl","BottomSheetSelectControl","FooterMessageControl","FooterMessageLink","Badge","BlockCaption","MediaPlaceholder","MediaUpload","MediaUploadProgress","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","BlockStyles","store","blockEditorStore","blockSettingsScreens","RichText","__","_x","sprintf","getProtocol","hasQueryArg","isURL","doAction","hasAction","compose","withPreferredColorScheme","withSelect","withDispatch","image","placeholderIcon","replace","fullscreen","textColor","coreStore","noticesStore","editPostStore","styles","getUpdatedLinkTargetSettings","LINK_DESTINATION_NONE","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","MEDIA_ID_NO_FEATURED_IMAGE_SET","getUrlForSlug","sizeSlug","undefined","media_details","sizes","source_url","LinkSettings","attributes","isLinkSheetVisible","setMappedAttributes","route","href","url","label","linkDestination","linkTarget","rel","inputValue","newUrl","params","newLinkDestination","link","valueMask","linkSettingsOptions","autoFocus","autoFill","openInNewTab","linkRel","placeholder","createElement","title","isVisible","setAttributes","withBottomSheet","hasPicker","options","showIcon","onLinkCellPressed","navigation","navigate","imageLinkDestinations","imageUrl","attachmentPageUrl","UPLOAD_STATE_IDLE","UPLOAD_STATE_UPLOADING","UPLOAD_STATE_SUCCEEDED","UPLOAD_STATE_FAILED","ImageEdit","constructor","props","state","isCaptionSelected","uploadStatus","replacedFeaturedImage","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateImageURL","onSetNewTab","onSetSizeSlug","onImagePressed","onSetFeatured","onFocusCaption","onSelectURL","accessibilityLabelCreator","onSizeChangeValue","componentDidMount","id","console","warn","componentWillUnmount","componentDidUpdate","previousProps","featuredImageId","updatedUrl","previousId","canImageBeFeatured","align","__unstableMarkNextChangeAsNotPersistent","includes","width","height","aspectRatio","scale","getDerivedStateFromProps","isSelected","caption","isEmpty","setState","payload","mediaUrl","mediaServerId","mediaId","value","updatedLinkTarget","media","imageDefaultSize","destination","mediaAttributes","alt","additionalAttributes","newURL","createErrorNotice","isFetchingImage","getSize","onFocus","getPlaceholderIcon","icon","getStylesFromColorScheme","iconPlaceholder","iconPlaceholderDark","showLoadingIndicator","style","image__loading","animating","getWidth","Object","values","alignments","restAttributes","getAltTextSettings","updateAlt","newAlt","initialValue","onChange","footerNote","Fragment","newValue","closeSettingsBottomSheet","getFeaturedButtonPanel","isFeaturedImage","setFeaturedButtonStyle","setFeaturedButton","setFeaturedButtonDark","removeFeaturedButton","Cell","labelStyle","cellContainerStyle","setFeaturedButtonCellContainer","separatorType","onPress","isGif","toLowerCase","render","clientId","context","wasBlockJustInserted","shouldUseFastImage","className","hasImageContext","keys","length","imageSizes","Array","isArray","sizeOptions","filter","slug","map","name","selectedSizeOption","sizeOptionsValid","find","option","getToolbarEditButton","open","onClick","getInspectorControls","panelBody","titleStyle","featuredImagePanelTitle","content","allowedTypes","onSelect","autoOpenMediaUpload","alignToFlex","left","center","right","full","wide","additionalImageProps","resizeMode","imageCrop","imageContainerStyles","fixedHeight","badgeLabelShown","badgeLabelText","getImageComponent","openMediaOptions","getMediaOptions","show","accessible","disabled","enablePausedUploads","coverUrl","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","onFinishMediaUploadWithFailure","onMediaUploadStateReset","renderContent","isUploadPaused","isUploadInProgress","isUploadFailed","retryMessage","shapeStyle","onBlur","insertBlocksAfter","isReplacingMedia","select","getMedia","getSettings","getEditedPostAttribute","capabilities","isNotFileUrl","shouldGetMedia","dispatch","closeGeneralSidebar"],"sources":["@wordpress/block-library/src/image/edit.native.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tActivityIndicator,\n\tImage as RNImage,\n\tTouchableWithoutFeedback,\n\tView,\n} from 'react-native';\nimport { useRoute } from '@react-navigation/native';\n\n/**\n * WordPress dependencies\n */\nimport { Component, useEffect } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n\tsetFeaturedImage,\n} from '@wordpress/react-native-bridge';\nimport {\n\tIcon,\n\tPanelBody,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n\tBottomSheet,\n\tBottomSheetTextControl,\n\tBottomSheetSelectControl,\n\tFooterMessageControl,\n\tFooterMessageLink,\n\tBadge,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockStyles,\n\tstore as blockEditorStore,\n\tblockSettingsScreens,\n\tRichText,\n} from '@wordpress/block-editor';\nimport { __, _x, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg, isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\treplace,\n\tfullscreen,\n\ttextColor,\n} from '@wordpress/icons';\nimport { store as coreStore } from '@wordpress/core-data';\nimport { store as noticesStore } from '@wordpress/notices';\n// eslint-disable-next-line no-restricted-imports\nimport { store as editPostStore } from '@wordpress/edit-post';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport {\n\tLINK_DESTINATION_NONE,\n\tLINK_DESTINATION_CUSTOM,\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tMEDIA_ID_NO_FEATURED_IMAGE_SET,\n} from './constants';\n\nconst getUrlForSlug = ( image, sizeSlug ) => {\n\tif ( ! sizeSlug ) {\n\t\treturn undefined;\n\t}\n\treturn image?.media_details?.sizes?.[ sizeSlug ]?.source_url;\n};\n\nfunction LinkSettings( {\n\tattributes,\n\timage,\n\tisLinkSheetVisible,\n\tsetMappedAttributes,\n} ) {\n\tconst route = useRoute();\n\tconst { href: url, label, linkDestination, linkTarget, rel } = attributes;\n\n\t// Persist attributes passed from child screen.\n\tuseEffect( () => {\n\t\tconst { inputValue: newUrl } = route.params || {};\n\n\t\tlet newLinkDestination;\n\t\tswitch ( newUrl ) {\n\t\t\tcase attributes.url:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_MEDIA;\n\t\t\t\tbreak;\n\t\t\tcase image?.link:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_ATTACHMENT;\n\t\t\t\tbreak;\n\t\t\tcase '':\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_NONE;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tnewLinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tsetMappedAttributes( {\n\t\t\turl: newUrl,\n\t\t\tlinkDestination: newLinkDestination,\n\t\t} );\n\t}, [ route.params?.inputValue ] );\n\n\tlet valueMask;\n\tswitch ( linkDestination ) {\n\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\tvalueMask = __( 'Media File' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\tvalueMask = __( 'Attachment Page' );\n\t\t\tbreak;\n\t\tcase LINK_DESTINATION_CUSTOM:\n\t\t\tvalueMask = __( 'Custom URL' );\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tvalueMask = __( 'None' );\n\t\t\tbreak;\n\t}\n\n\tconst linkSettingsOptions = {\n\t\turl: {\n\t\t\tvalueMask,\n\t\t\tautoFocus: false,\n\t\t\tautoFill: false,\n\t\t},\n\t\topenInNewTab: {\n\t\t\tlabel: __( 'Open in new tab' ),\n\t\t},\n\t\tlinkRel: {\n\t\t\tlabel: __( 'Link Rel' ),\n\t\t\tplaceholder: _x( 'None', 'Link rel attribute value placeholder' ),\n\t\t},\n\t};\n\n\treturn (\n\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\turl={ url }\n\t\t\t\trel={ rel }\n\t\t\t\tlabel={ label }\n\t\t\t\tlinkTarget={ linkTarget }\n\t\t\t\tsetAttributes={ setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ linkSettingsOptions }\n\t\t\t\tshowIcon={ false }\n\t\t\t\tonLinkCellPressed={ ( { navigation } ) => {\n\t\t\t\t\tnavigation.navigate(\n\t\t\t\t\t\tblockSettingsScreens.imageLinkDestinations,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinputValue: attributes.href,\n\t\t\t\t\t\t\tlinkDestination: attributes.linkDestination,\n\t\t\t\t\t\t\timageUrl: attributes.url,\n\t\t\t\t\t\t\tattachmentPageUrl: image?.link,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t</PanelBody>\n\t);\n}\n\nconst UPLOAD_STATE_IDLE = 0;\nconst UPLOAD_STATE_UPLOADING = 1;\nconst UPLOAD_STATE_SUCCEEDED = 2;\nconst UPLOAD_STATE_FAILED = 3;\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t\tuploadStatus: UPLOAD_STATE_IDLE,\n\t\t};\n\n\t\tthis.replacedFeaturedImage = false;\n\n\t\tthis.finishMediaUploadWithSuccess =\n\t\t\tthis.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure =\n\t\t\tthis.finishMediaUploadWithFailure.bind( this );\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption =\n\t\t\tthis.onSelectMediaUploadOption.bind( this );\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onSetFeatured = this.onSetFeatured.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.accessibilityLabelCreator =\n\t\t\tthis.accessibilityLabelCreator.bind( this );\n\t\tthis.setMappedAttributes = this.setMappedAttributes.bind( this );\n\t\tthis.onSizeChangeValue = this.onSizeChangeValue.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload.\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open.\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// This action will only exist if the user pressed the trash button on the block holder.\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.uploadStatus === UPLOAD_STATE_UPLOADING\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tconst { image, attributes, setAttributes, featuredImageId } =\n\t\t\tthis.props;\n\t\tconst { url } = attributes;\n\t\tif ( ! previousProps.image && image ) {\n\t\t\tif ( ! hasQueryArg( url, 'w' ) && attributes?.sizeSlug ) {\n\t\t\t\tconst updatedUrl =\n\t\t\t\t\tgetUrlForSlug( image, attributes.sizeSlug ) ||\n\t\t\t\t\timage.source_url;\n\n\t\t\t\tsetAttributes( { url: updatedUrl } );\n\t\t\t}\n\t\t}\n\n\t\tconst { id } = attributes;\n\t\tconst { id: previousId } = previousProps.attributes;\n\n\t\t// The media changed and the previous media was set as the Featured Image,\n\t\t// we must keep track of the previous media's featured status to act on it\n\t\t// once the new media has a finalized ID.\n\t\tif (\n\t\t\t!! id &&\n\t\t\tid !== previousId &&\n\t\t\t!! featuredImageId &&\n\t\t\tfeaturedImageId === previousId\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = true;\n\t\t}\n\n\t\t// The media changed and now has a finalized ID (e.g. upload completed), we\n\t\t// should attempt to replace the featured image if applicable.\n\t\tif (\n\t\t\tthis.replacedFeaturedImage &&\n\t\t\t!! image &&\n\t\t\tthis.canImageBeFeatured()\n\t\t) {\n\t\t\tthis.replacedFeaturedImage = false;\n\t\t\tsetFeaturedImage( id );\n\t\t}\n\n\t\tconst { align } = attributes;\n\t\tconst { __unstableMarkNextChangeAsNotPersistent } = this.props;\n\n\t\t// Update the attributes if the align is wide or full\n\t\tif ( [ 'wide', 'full' ].includes( align ) ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\taspectRatio: undefined,\n\t\t\t\tscale: undefined,\n\t\t\t} );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false.\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\t// Checks if caption is empty.\n\t\treturn RichText.isEmpty( caption )\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.uploadStatus === UPLOAD_STATE_UPLOADING ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( this.state.uploadStatus !== UPLOAD_STATE_UPLOADING ) {\n\t\t\tthis.setState( { uploadStatus: UPLOAD_STATE_UPLOADING } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_SUCCEEDED } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_FAILED } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { uploadStatus: UPLOAD_STATE_IDLE } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image, setAttributes } = this.props;\n\n\t\tconst url = getUrlForSlug( image, sizeSlug );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\t\tsetAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { imageDefaultSize } = this.props;\n\t\tconst { id, url, destination } = this.props.attributes;\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t\talt: media.alt,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tlet href;\n\t\tswitch ( destination ) {\n\t\t\tcase LINK_DESTINATION_MEDIA:\n\t\t\t\thref = media.url;\n\t\t\t\tbreak;\n\t\t\tcase LINK_DESTINATION_ATTACHMENT:\n\t\t\t\thref = media.link;\n\t\t\t\tbreak;\n\t\t}\n\t\tmediaAttributes.href = href;\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonSelectURL( newURL ) {\n\t\tconst { createErrorNotice, imageDefaultSize, setAttributes } =\n\t\t\tthis.props;\n\n\t\tif ( isURL( newURL ) ) {\n\t\t\tthis.setState( {\n\t\t\t\tisFetchingImage: true,\n\t\t\t} );\n\n\t\t\t// Use RN's Image.getSize to determine if URL is a valid image\n\t\t\tRNImage.getSize(\n\t\t\t\tnewURL,\n\t\t\t\t() => {\n\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\turl: newURL,\n\t\t\t\t\t\tid: undefined,\n\t\t\t\t\t\twidth: undefined,\n\t\t\t\t\t\theight: undefined,\n\t\t\t\t\t\tsizeSlug: imageDefaultSize,\n\t\t\t\t\t} );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t},\n\t\t\t\t() => {\n\t\t\t\t\tcreateErrorNotice( __( 'Image file not found.' ) );\n\t\t\t\t\tthis.setState( {\n\t\t\t\t\t\tisFetchingImage: false,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t);\n\t\t} else {\n\t\t\tcreateErrorNotice( __( 'Invalid URL.' ) );\n\t\t}\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tshowLoadingIndicator() {\n\t\treturn (\n\t\t\t<View style={ styles.image__loading }>\n\t\t\t\t<ActivityIndicator animating />\n\t\t\t</View>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tsetMappedAttributes( { url: href, linkDestination, ...restAttributes } ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( ! href && ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_NONE;\n\t\t} else if ( ! linkDestination ) {\n\t\t\tlinkDestination = LINK_DESTINATION_CUSTOM;\n\t\t}\n\n\t\treturn href === undefined || href === this.props.attributes.href\n\t\t\t? setAttributes( restAttributes )\n\t\t\t: setAttributes( {\n\t\t\t\t\t...restAttributes,\n\t\t\t\t\tlinkDestination,\n\t\t\t\t\thref,\n\t\t\t  } );\n\t}\n\n\tgetAltTextSettings() {\n\t\tconst {\n\t\t\tattributes: { alt },\n\t\t} = this.props;\n\n\t\tconst updateAlt = ( newAlt ) => {\n\t\t\tthis.props.setAttributes( { alt: newAlt } );\n\t\t};\n\n\t\treturn (\n\t\t\t<BottomSheetTextControl\n\t\t\t\tinitialValue={ alt }\n\t\t\t\tonChange={ updateAlt }\n\t\t\t\tplaceholder={ __( 'Add alt text' ) }\n\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\ticon={ textColor }\n\t\t\t\tfooterNote={\n\t\t\t\t\t<>\n\t\t\t\t\t\t{ __(\n\t\t\t\t\t\t\t'Describe the purpose of the image. Leave empty if decorative.'\n\t\t\t\t\t\t) }{ ' ' }\n\t\t\t\t\t\t<FooterMessageLink\n\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t'https://www.w3.org/WAI/tutorials/images/decision-tree/'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvalue={ __( 'What is alt text?' ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\t}\n\n\tonSizeChangeValue( newValue ) {\n\t\tthis.onSetSizeSlug( newValue );\n\t}\n\n\tonSetFeatured( mediaId ) {\n\t\tconst { closeSettingsBottomSheet } = this.props;\n\t\tsetFeaturedImage( mediaId );\n\t\tcloseSettingsBottomSheet();\n\t}\n\n\tgetFeaturedButtonPanel( isFeaturedImage ) {\n\t\tconst { attributes, getStylesFromColorScheme } = this.props;\n\n\t\tconst setFeaturedButtonStyle = getStylesFromColorScheme(\n\t\t\tstyles.setFeaturedButton,\n\t\t\tstyles.setFeaturedButtonDark\n\t\t);\n\n\t\tconst removeFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Remove as Featured Image' ) }\n\t\t\t\tlabelStyle={ [\n\t\t\t\t\tsetFeaturedButtonStyle,\n\t\t\t\t\tstyles.removeFeaturedButton,\n\t\t\t\t] }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () =>\n\t\t\t\t\tthis.onSetFeatured( MEDIA_ID_NO_FEATURED_IMAGE_SET )\n\t\t\t\t}\n\t\t\t/>\n\t\t);\n\n\t\tconst setFeaturedButton = () => (\n\t\t\t<BottomSheet.Cell\n\t\t\t\tlabel={ __( 'Set as Featured Image' ) }\n\t\t\t\tlabelStyle={ setFeaturedButtonStyle }\n\t\t\t\tcellContainerStyle={ styles.setFeaturedButtonCellContainer }\n\t\t\t\tseparatorType={ 'none' }\n\t\t\t\tonPress={ () => this.onSetFeatured( attributes.id ) }\n\t\t\t/>\n\t\t);\n\n\t\treturn isFeaturedImage ? removeFeaturedButton() : setFeaturedButton();\n\t}\n\n\t/**\n\t * Featured images must be set to a successfully uploaded self-hosted image,\n\t * which has an ID.\n\t *\n\t * @return {boolean} Boolean indicating whether or not the current may be set as featured.\n\t */\n\tcanImageBeFeatured() {\n\t\tconst {\n\t\t\tattributes: { id },\n\t\t} = this.props;\n\t\treturn (\n\t\t\ttypeof id !== 'undefined' &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_UPLOADING &&\n\t\t\tthis.state.uploadStatus !== UPLOAD_STATE_FAILED\n\t\t);\n\t}\n\n\tisGif( url ) {\n\t\treturn url.toLowerCase().includes( '.gif' );\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected, isFetchingImage } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\tclientId,\n\t\t\timageDefaultSize,\n\t\t\tcontext,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted,\n\t\t\tshouldUseFastImage,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\t\tconst hasImageContext = context\n\t\t\t? Object.keys( context ).length > 0\n\t\t\t: false;\n\n\t\tconst imageSizes = Array.isArray( this.props.imageSizes )\n\t\t\t? this.props.imageSizes\n\t\t\t: [];\n\t\t// Only map available image sizes for the user to choose.\n\t\tconst sizeOptions = imageSizes\n\t\t\t.filter( ( { slug } ) => getUrlForSlug( image, slug ) )\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\n\t\tlet selectedSizeOption = sizeSlug || imageDefaultSize;\n\t\tlet sizeOptionsValid = sizeOptions.find(\n\t\t\t( option ) => option.value === selectedSizeOption\n\t\t);\n\n\t\tif ( ! sizeOptionsValid ) {\n\t\t\t// Default to 'full' size if the default large size is not available.\n\t\t\tsizeOptionsValid = sizeOptions.find(\n\t\t\t\t( option ) => option.value === 'full'\n\t\t\t);\n\t\t\tselectedSizeOption = 'full';\n\t\t}\n\n\t\tconst canImageBeFeatured = this.canImageBeFeatured();\n\t\tconst isFeaturedImage =\n\t\t\tcanImageBeFeatured && featuredImageId === attributes.id;\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<BottomSheetSelectControl\n\t\t\t\t\t\t\ticon={ fullscreen }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t\tonChange={ this.onSizeChangeValue }\n\t\t\t\t\t\t\tvalue={ selectedSizeOption }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ this.getAltTextSettings() }\n\t\t\t\t</PanelBody>\n\t\t\t\t<LinkSettings\n\t\t\t\t\tattributes={ this.props.attributes }\n\t\t\t\t\timage={ this.props.image }\n\t\t\t\t\tisLinkSheetVisible={ this.state.isLinkSheetVisible }\n\t\t\t\t\tsetMappedAttributes={ this.setMappedAttributes }\n\t\t\t\t/>\n\t\t\t\t<PanelBody\n\t\t\t\t\ttitle={ __( 'Featured Image' ) }\n\t\t\t\t\ttitleStyle={ styles.featuredImagePanelTitle }\n\t\t\t\t>\n\t\t\t\t\t{ canImageBeFeatured &&\n\t\t\t\t\t\tthis.getFeaturedButtonPanel( isFeaturedImage ) }\n\t\t\t\t\t<FooterMessageControl\n\t\t\t\t\t\tlabel={ __(\n\t\t\t\t\t\t\t'Changes to featured image will not be affected by the undo/redo buttons.'\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tcellContainerStyle={\n\t\t\t\t\t\t\tstyles.setFeaturedButtonCellContainer\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t{ isFetchingImage && this.showLoadingIndicator() }\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t\tautoOpenMediaUpload={\n\t\t\t\t\t\t\tisSelected && wasBlockJustInserted\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst additionalImageProps = {\n\t\t\theight: '100%',\n\t\t\tresizeMode: context?.imageCrop ? 'cover' : 'contain',\n\t\t};\n\n\t\tconst imageContainerStyles = [\n\t\t\tcontext?.fixedHeight && styles.fixedHeight,\n\t\t];\n\n\t\tconst isGif = this.isGif( url );\n\t\tconst badgeLabelShown = isFeaturedImage || isGif;\n\t\tlet badgeLabelText = '';\n\t\tif ( isFeaturedImage ) {\n\t\t\tbadgeLabelText = __( 'Featured' );\n\t\t} else if ( isGif ) {\n\t\t\tbadgeLabelText = __( 'GIF' );\n\t\t}\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<Badge label={ badgeLabelText } show={ badgeLabelShown }>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ isSelected && getInspectorControls() }\n\t\t\t\t\t\t{ isSelected && getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tenablePausedUploads\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadPaused,\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<View style={ imageContainerStyles }>\n\t\t\t\t\t\t\t\t\t\t{ isFetchingImage &&\n\t\t\t\t\t\t\t\t\t\t\tthis.showLoadingIndicator() }\n\t\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\t\talign={\n\t\t\t\t\t\t\t\t\t\t\t\talign && alignToFlex[ align ]\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected &&\n\t\t\t\t\t\t\t\t\t\t\t\t! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\t\tisUploadPaused={ isUploadPaused }\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage={\n\t\t\t\t\t\t\t\t\t\t\t\tshouldUseFastImage\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\topenMediaOptions={\n\t\t\t\t\t\t\t\t\t\t\t\topenMediaOptions\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\t\tshapeStyle={\n\t\t\t\t\t\t\t\t\t\t\t\tstyles[ className ] || className\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t\t\t{ ...( hasImageContext\n\t\t\t\t\t\t\t\t\t\t\t\t? additionalImageProps\n\t\t\t\t\t\t\t\t\t\t\t\t: {} ) }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible={ ! this.state.isCaptionSelected }\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // Always assign onBlur as props.\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</Badge>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia={ true }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( coreStore );\n\t\tconst { getSettings, wasBlockJustInserted } =\n\t\t\tselect( blockEditorStore );\n\t\tconst { getEditedPostAttribute } = select( 'core/editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t\tclientId,\n\t\t} = props;\n\t\tconst { imageSizes, imageDefaultSize, capabilities } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\t\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams.\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\t\tconst image = shouldGetMedia ? getMedia( id ) : null;\n\n\t\treturn {\n\t\t\timage,\n\t\t\timageSizes,\n\t\t\timageDefaultSize,\n\t\t\tshouldUseFastImage: capabilities?.shouldUseFastImage === true,\n\t\t\tfeaturedImageId,\n\t\t\twasBlockJustInserted: wasBlockJustInserted(\n\t\t\t\tclientId,\n\t\t\t\t'inserter_menu'\n\t\t\t),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createErrorNotice } = dispatch( noticesStore );\n\t\tconst { __unstableMarkNextChangeAsNotPersistent } =\n\t\t\tdispatch( blockEditorStore );\n\n\t\treturn {\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t\tcreateErrorNotice,\n\t\t\tcloseSettingsBottomSheet() {\n\t\t\t\tdispatch( editPostStore ).closeGeneralSidebar();\n\t\t\t},\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"],"mappings":"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"}