{"version":3,"names":["colord","extend","namesPlugin","FastAverageColor","memoize","applyFilters","DEFAULT_BACKGROUND_COLOR","DEFAULT_OVERLAY_COLOR","compositeSourceOver","source","dest","r","a","g","b","retrieveFastAverageColor","fastAverageColor","getMediaColor","url","toRgb","imgCrossOrigin","undefined","color","getColorAsync","defaultColor","silent","process","env","NODE_ENV","crossOrigin","hex","error","compositeIsDark","dimRatio","overlayColor","backgroundColor","isDark","overlay","alpha","background","composite"],"sources":["@wordpress/block-library/src/cover/edit/color-utils.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport { colord, extend } from 'colord';\nimport namesPlugin from 'colord/plugins/names';\nimport { FastAverageColor } from 'fast-average-color';\nimport memoize from 'memize';\n\n/**\n * WordPress dependencies\n */\nimport { applyFilters } from '@wordpress/hooks';\n\n/**\n * @typedef {import('colord').RgbaColor} RgbaColor\n */\n\nextend( [ namesPlugin ] );\n\n/**\n * Fallback color when the average color can't be computed. The image may be\n * rendering as transparent, and most sites have a light color background.\n */\nexport const DEFAULT_BACKGROUND_COLOR = '#FFF';\n\n/**\n * Default dim color specified in style.css.\n */\nexport const DEFAULT_OVERLAY_COLOR = '#000';\n\n/**\n * Performs a Porter Duff composite source over operation on two rgba colors.\n *\n * @see {@link https://www.w3.org/TR/compositing-1/#porterduffcompositingoperators_srcover}\n *\n * @param {RgbaColor} source Source color.\n * @param {RgbaColor} dest   Destination color.\n *\n * @return {RgbaColor} Composite color.\n */\nexport function compositeSourceOver( source, dest ) {\n\treturn {\n\t\tr: source.r * source.a + dest.r * dest.a * ( 1 - source.a ),\n\t\tg: source.g * source.a + dest.g * dest.a * ( 1 - source.a ),\n\t\tb: source.b * source.a + dest.b * dest.a * ( 1 - source.a ),\n\t\ta: source.a + dest.a * ( 1 - source.a ),\n\t};\n}\n\n/**\n * Retrieves the FastAverageColor singleton.\n *\n * @return {FastAverageColor} The FastAverageColor singleton.\n */\nexport function retrieveFastAverageColor() {\n\tif ( ! retrieveFastAverageColor.fastAverageColor ) {\n\t\tretrieveFastAverageColor.fastAverageColor = new FastAverageColor();\n\t}\n\treturn retrieveFastAverageColor.fastAverageColor;\n}\n\n/**\n * Computes the average color of an image.\n *\n * @param {string} url The url of the image.\n *\n * @return {Promise<string>} Promise of an average color as a hex string.\n */\nexport const getMediaColor = memoize( async ( url ) => {\n\tif ( ! url ) {\n\t\treturn DEFAULT_BACKGROUND_COLOR;\n\t}\n\n\t// making the default color rgb for compat with FAC\n\tconst { r, g, b, a } = colord( DEFAULT_BACKGROUND_COLOR ).toRgb();\n\n\ttry {\n\t\tconst imgCrossOrigin = applyFilters(\n\t\t\t'media.crossOrigin',\n\t\t\tundefined,\n\t\t\turl\n\t\t);\n\t\tconst color = await retrieveFastAverageColor().getColorAsync( url, {\n\t\t\t// The default color is white, which is the color\n\t\t\t// that is returned if there's an error.\n\t\t\t// colord returns alpga 0-1, FAC needs 0-255\n\t\t\tdefaultColor: [ r, g, b, a * 255 ],\n\t\t\t// Errors that come up don't reject the promise,\n\t\t\t// so error logging has to be silenced\n\t\t\t// with this option.\n\t\t\tsilent: process.env.NODE_ENV === 'production',\n\t\t\tcrossOrigin: imgCrossOrigin,\n\t\t} );\n\t\treturn color.hex;\n\t} catch ( error ) {\n\t\t// If there's an error return the fallback color.\n\t\treturn DEFAULT_BACKGROUND_COLOR;\n\t}\n} );\n\n/**\n * Computes if the color combination of the overlay and background color is dark.\n *\n * @param {number} dimRatio        Opacity of the overlay between 0 and 100.\n * @param {string} overlayColor    CSS color string for the overlay.\n * @param {string} backgroundColor CSS color string for the background.\n *\n * @return {boolean} true if the color combination composite result is dark.\n */\nexport function compositeIsDark( dimRatio, overlayColor, backgroundColor ) {\n\t// Opacity doesn't matter if you're overlaying the same color on top of itself.\n\t// And background doesn't matter when overlay is fully opaque.\n\tif ( overlayColor === backgroundColor || dimRatio === 100 ) {\n\t\treturn colord( overlayColor ).isDark();\n\t}\n\tconst overlay = colord( overlayColor )\n\t\t.alpha( dimRatio / 100 )\n\t\t.toRgb();\n\tconst background = colord( backgroundColor ).toRgb();\n\tconst composite = compositeSourceOver( overlay, background );\n\treturn colord( composite ).isDark();\n}\n"],"mappings":"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"}