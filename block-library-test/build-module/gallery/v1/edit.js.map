{"version":3,"names":["compose","PanelBody","SelectControl","ToggleControl","withNotices","RangeControl","MediaPlaceholder","InspectorControls","useBlockProps","store","blockEditorStore","Platform","useEffect","useState","useMemo","__","getBlobByURL","isBlobURL","revokeBlobURL","useDispatch","useSelect","withViewportMatch","View","coreStore","sharedIcon","pickRelevantMediaFiles","defaultColumnsNumberV1","Gallery","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_MEDIA","LINK_DESTINATION_NONE","MAX_COLUMNS","linkOptions","value","label","ALLOWED_MEDIA_TYPES","PLACEHOLDER_TEXT","select","web","native","MOBILE_CONTROL_PROPS_RANGE_CONTROL","type","GalleryEdit","props","attributes","clientId","isSelected","noticeUI","noticeOperations","onFocus","columns","imageCrop","images","linkTo","sizeSlug","selectedImage","setSelectedImage","attachmentCaptions","setAttachmentCaptions","__unstableMarkNextChangeAsNotPersistent","imageSizes","mediaUpload","getMedia","wasBlockJustInserted","settings","getSettings","resizedImages","_attributes$ids","ids","reduce","currentResizedImages","id","image","sizes","currentSizes","size","defaultUrl","slug","url","mediaDetailsUrl","media_details","source_url","parseInt","onFocusGalleryCaption","setAttributes","newAttrs","Error","map","onSelectImage","index","onDeselectImage","onMove","oldIndex","newIndex","newImages","splice","onMoveForward","length","onMoveBackward","onRemoveImage","filter","img","i","Math","min","selectCaption","newImage","newImageId","toString","currentImage","find","currentImageCaption","caption","attachment","onSelectImages","onUploadError","message","removeAllNotices","createErrorNotice","setLinkTo","setColumnsNumber","toggleImageCrop","getImageCropHelp","checked","setImageAttributes","newAttributes","slice","getImagesSizeOptions","resizedImageSizes","Object","values","some","name","updateImagesSize","newSizeSlug","updatedImages","OS","every","filesList","forEach","onFileChange","allowedTypes","window","wp","media","view","defaultProps","link","hasImages","hasImageIds","mediaPlaceholder","createElement","addToGallery","isAppender","disableMediaButtons","icon","labels","title","instructions","onSelect","accept","multiple","onError","notices","undefined","autoOpenMediaUpload","blockProps","imageSizeOptions","shouldShowSizeOptions","Fragment","__nextHasNoMarginBottom","onChange","max","required","help","options","hideCancelButton","onSetImageAttributes","isNarrow"],"sources":["@wordpress/block-library/src/gallery/v1/edit.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { compose } from '@wordpress/compose';\nimport {\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n\tRangeControl,\n} from '@wordpress/components';\nimport {\n\tMediaPlaceholder,\n\tInspectorControls,\n\tuseBlockProps,\n\tstore as blockEditorStore,\n} from '@wordpress/block-editor';\nimport { Platform, useEffect, useState, useMemo } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { View } from '@wordpress/primitives';\nimport { store as coreStore } from '@wordpress/core-data';\n\n/**\n * Internal dependencies\n */\nimport { sharedIcon } from '../shared-icon';\nimport { pickRelevantMediaFiles } from './shared';\nimport { defaultColumnsNumberV1 } from '../deprecated';\nimport Gallery from './gallery';\nimport {\n\tLINK_DESTINATION_ATTACHMENT,\n\tLINK_DESTINATION_MEDIA,\n\tLINK_DESTINATION_NONE,\n} from './constants';\n\nconst MAX_COLUMNS = 8;\nconst linkOptions = [\n\t{ value: LINK_DESTINATION_ATTACHMENT, label: __( 'Attachment Page' ) },\n\t{ value: LINK_DESTINATION_MEDIA, label: __( 'Media File' ) },\n\t{ value: LINK_DESTINATION_NONE, label: __( 'None' ) },\n];\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst PLACEHOLDER_TEXT = Platform.select( {\n\tweb: __(\n\t\t'Drag images, upload new ones or select files from your library.'\n\t),\n\tnative: __( 'ADD MEDIA' ),\n} );\n\nconst MOBILE_CONTROL_PROPS_RANGE_CONTROL = Platform.select( {\n\tweb: {},\n\tnative: { type: 'stepper' },\n} );\n\nfunction GalleryEdit( props ) {\n\tconst {\n\t\tattributes,\n\t\tclientId,\n\t\tisSelected,\n\t\tnoticeUI,\n\t\tnoticeOperations,\n\t\tonFocus,\n\t} = props;\n\tconst {\n\t\tcolumns = defaultColumnsNumberV1( attributes ),\n\t\timageCrop,\n\t\timages,\n\t\tlinkTo,\n\t\tsizeSlug,\n\t} = attributes;\n\tconst [ selectedImage, setSelectedImage ] = useState();\n\tconst [ attachmentCaptions, setAttachmentCaptions ] = useState();\n\tconst { __unstableMarkNextChangeAsNotPersistent } =\n\t\tuseDispatch( blockEditorStore );\n\n\tconst { imageSizes, mediaUpload, getMedia, wasBlockJustInserted } =\n\t\tuseSelect( ( select ) => {\n\t\t\tconst settings = select( blockEditorStore ).getSettings();\n\n\t\t\treturn {\n\t\t\t\timageSizes: settings.imageSizes,\n\t\t\t\tmediaUpload: settings.mediaUpload,\n\t\t\t\tgetMedia: select( coreStore ).getMedia,\n\t\t\t\twasBlockJustInserted: select(\n\t\t\t\t\tblockEditorStore\n\t\t\t\t).wasBlockJustInserted( clientId, 'inserter_menu' ),\n\t\t\t};\n\t\t} );\n\n\tconst resizedImages = useMemo( () => {\n\t\tif ( isSelected ) {\n\t\t\treturn ( attributes.ids ?? [] ).reduce(\n\t\t\t\t( currentResizedImages, id ) => {\n\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\treturn currentResizedImages;\n\t\t\t\t\t}\n\t\t\t\t\tconst image = getMedia( id );\n\t\t\t\t\tconst sizes = imageSizes.reduce( ( currentSizes, size ) => {\n\t\t\t\t\t\tconst defaultUrl = image?.sizes?.[ size.slug ]?.url;\n\t\t\t\t\t\tconst mediaDetailsUrl =\n\t\t\t\t\t\t\timage?.media_details?.sizes?.[ size.slug ]\n\t\t\t\t\t\t\t\t?.source_url;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...currentSizes,\n\t\t\t\t\t\t\t[ size.slug ]: defaultUrl || mediaDetailsUrl,\n\t\t\t\t\t\t};\n\t\t\t\t\t}, {} );\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...currentResizedImages,\n\t\t\t\t\t\t[ parseInt( id, 10 ) ]: sizes,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\t{}\n\t\t\t);\n\t\t}\n\t\treturn {};\n\t}, [ isSelected, attributes.ids, imageSizes ] );\n\n\tfunction onFocusGalleryCaption() {\n\t\tsetSelectedImage();\n\t}\n\n\tfunction setAttributes( newAttrs ) {\n\t\tif ( newAttrs.ids ) {\n\t\t\tthrow new Error(\n\t\t\t\t'The \"ids\" attribute should not be changed directly. It is managed automatically when \"images\" attribute changes'\n\t\t\t);\n\t\t}\n\n\t\tif ( newAttrs.images ) {\n\t\t\tnewAttrs = {\n\t\t\t\t...newAttrs,\n\t\t\t\t// Unlike images[ n ].id which is a string, always ensure the\n\t\t\t\t// ids array contains numbers as per its attribute type.\n\t\t\t\tids: newAttrs.images.map( ( { id } ) => parseInt( id, 10 ) ),\n\t\t\t};\n\t\t}\n\n\t\tprops.setAttributes( newAttrs );\n\t}\n\n\tfunction onSelectImage( index ) {\n\t\treturn () => {\n\t\t\tsetSelectedImage( index );\n\t\t};\n\t}\n\n\tfunction onDeselectImage() {\n\t\treturn () => {\n\t\t\tsetSelectedImage();\n\t\t};\n\t}\n\n\tfunction onMove( oldIndex, newIndex ) {\n\t\tconst newImages = [ ...images ];\n\t\tnewImages.splice( newIndex, 1, images[ oldIndex ] );\n\t\tnewImages.splice( oldIndex, 1, images[ newIndex ] );\n\t\tsetSelectedImage( newIndex );\n\t\tsetAttributes( { images: newImages } );\n\t}\n\n\tfunction onMoveForward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === images.length - 1 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex + 1 );\n\t\t};\n\t}\n\n\tfunction onMoveBackward( oldIndex ) {\n\t\treturn () => {\n\t\t\tif ( oldIndex === 0 ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tonMove( oldIndex, oldIndex - 1 );\n\t\t};\n\t}\n\n\tfunction onRemoveImage( index ) {\n\t\treturn () => {\n\t\t\tconst newImages = images.filter( ( img, i ) => index !== i );\n\t\t\tsetSelectedImage();\n\t\t\tsetAttributes( {\n\t\t\t\timages: newImages,\n\t\t\t\tcolumns: attributes.columns\n\t\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t\t: attributes.columns,\n\t\t\t} );\n\t\t};\n\t}\n\n\tfunction selectCaption( newImage ) {\n\t\t// The image id in both the images and attachmentCaptions arrays is a\n\t\t// string, so ensure comparison works correctly by converting the\n\t\t// newImage.id to a string.\n\t\tconst newImageId = newImage.id.toString();\n\t\tconst currentImage = images.find( ( { id } ) => id === newImageId );\n\t\tconst currentImageCaption = currentImage\n\t\t\t? currentImage.caption\n\t\t\t: newImage.caption;\n\n\t\tif ( ! attachmentCaptions ) {\n\t\t\treturn currentImageCaption;\n\t\t}\n\n\t\tconst attachment = attachmentCaptions.find(\n\t\t\t( { id } ) => id === newImageId\n\t\t);\n\n\t\t// If the attachment caption is updated.\n\t\tif ( attachment && attachment.caption !== newImage.caption ) {\n\t\t\treturn newImage.caption;\n\t\t}\n\n\t\treturn currentImageCaption;\n\t}\n\n\tfunction onSelectImages( newImages ) {\n\t\tsetAttachmentCaptions(\n\t\t\tnewImages.map( ( newImage ) => ( {\n\t\t\t\t// Store the attachmentCaption id as a string for consistency\n\t\t\t\t// with the type of the id in the images attribute.\n\t\t\t\tid: newImage.id.toString(),\n\t\t\t\tcaption: newImage.caption,\n\t\t\t} ) )\n\t\t);\n\t\tsetAttributes( {\n\t\t\timages: newImages.map( ( newImage ) => ( {\n\t\t\t\t...pickRelevantMediaFiles( newImage, sizeSlug ),\n\t\t\t\tcaption: selectCaption( newImage, images, attachmentCaptions ),\n\t\t\t\t// The id value is stored in a data attribute, so when the\n\t\t\t\t// block is parsed it's converted to a string. Converting\n\t\t\t\t// to a string here ensures it's type is consistent.\n\t\t\t\tid: newImage.id.toString(),\n\t\t\t} ) ),\n\t\t\tcolumns: attributes.columns\n\t\t\t\t? Math.min( newImages.length, attributes.columns )\n\t\t\t\t: attributes.columns,\n\t\t} );\n\t}\n\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\tfunction setLinkTo( value ) {\n\t\tsetAttributes( { linkTo: value } );\n\t}\n\n\tfunction setColumnsNumber( value ) {\n\t\tsetAttributes( { columns: value } );\n\t}\n\n\tfunction toggleImageCrop() {\n\t\tsetAttributes( { imageCrop: ! imageCrop } );\n\t}\n\n\tfunction getImageCropHelp( checked ) {\n\t\treturn checked\n\t\t\t? __( 'Thumbnails are cropped to align.' )\n\t\t\t: __( 'Thumbnails are not cropped.' );\n\t}\n\n\tfunction setImageAttributes( index, newAttributes ) {\n\t\tif ( ! images[ index ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetAttributes( {\n\t\t\timages: [\n\t\t\t\t...images.slice( 0, index ),\n\t\t\t\t{\n\t\t\t\t\t...images[ index ],\n\t\t\t\t\t...newAttributes,\n\t\t\t\t},\n\t\t\t\t...images.slice( index + 1 ),\n\t\t\t],\n\t\t} );\n\t}\n\n\tfunction getImagesSizeOptions() {\n\t\tconst resizedImageSizes = Object.values( resizedImages );\n\t\treturn imageSizes\n\t\t\t.filter( ( { slug } ) =>\n\t\t\t\tresizedImageSizes.some( ( sizes ) => sizes[ slug ] )\n\t\t\t)\n\t\t\t.map( ( { name, slug } ) => ( { value: slug, label: name } ) );\n\t}\n\n\tfunction updateImagesSize( newSizeSlug ) {\n\t\tconst updatedImages = ( images ?? [] ).map( ( image ) => {\n\t\t\tif ( ! image.id ) {\n\t\t\t\treturn image;\n\t\t\t}\n\t\t\tconst url =\n\t\t\t\tresizedImages[ parseInt( image.id, 10 ) ]?.[ newSizeSlug ];\n\t\t\treturn {\n\t\t\t\t...image,\n\t\t\t\t...( url && { url } ),\n\t\t\t};\n\t\t} );\n\n\t\tsetAttributes( { images: updatedImages, sizeSlug: newSizeSlug } );\n\t}\n\n\tuseEffect( () => {\n\t\tif (\n\t\t\tPlatform.OS === 'web' &&\n\t\t\timages &&\n\t\t\timages.length > 0 &&\n\t\t\timages.every( ( { url } ) => isBlobURL( url ) )\n\t\t) {\n\t\t\tconst filesList = images.map( ( { url } ) => getBlobByURL( url ) );\n\t\t\timages.forEach( ( { url } ) => revokeBlobURL( url ) );\n\t\t\tmediaUpload( {\n\t\t\t\tfilesList,\n\t\t\t\tonFileChange: onSelectImages,\n\t\t\t\tallowedTypes: [ 'image' ],\n\t\t\t} );\n\t\t}\n\t}, [] );\n\n\tuseEffect( () => {\n\t\t// Deselect images when deselecting the block.\n\t\tif ( ! isSelected ) {\n\t\t\tsetSelectedImage();\n\t\t}\n\t}, [ isSelected ] );\n\n\tuseEffect( () => {\n\t\t// linkTo attribute must be saved so blocks don't break when changing\n\t\t// image_default_link_type in options.php.\n\t\tif ( ! linkTo ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tsetAttributes( {\n\t\t\t\tlinkTo:\n\t\t\t\t\twindow?.wp?.media?.view?.settings?.defaultProps?.link ||\n\t\t\t\t\tLINK_DESTINATION_NONE,\n\t\t\t} );\n\t\t}\n\t}, [ linkTo ] );\n\n\tconst hasImages = !! images.length;\n\tconst hasImageIds = hasImages && images.some( ( image ) => !! image.id );\n\n\tconst mediaPlaceholder = (\n\t\t<MediaPlaceholder\n\t\t\taddToGallery={ hasImageIds }\n\t\t\tisAppender={ hasImages }\n\t\t\tdisableMediaButtons={ hasImages && ! isSelected }\n\t\t\ticon={ ! hasImages && sharedIcon }\n\t\t\tlabels={ {\n\t\t\t\ttitle: ! hasImages && __( 'Gallery' ),\n\t\t\t\tinstructions: ! hasImages && PLACEHOLDER_TEXT,\n\t\t\t} }\n\t\t\tonSelect={ onSelectImages }\n\t\t\taccept=\"image/*\"\n\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\tmultiple\n\t\t\tvalue={ hasImageIds ? images : {} }\n\t\t\tonError={ onUploadError }\n\t\t\tnotices={ hasImages ? undefined : noticeUI }\n\t\t\tonFocus={ onFocus }\n\t\t\tautoOpenMediaUpload={\n\t\t\t\t! hasImages && isSelected && wasBlockJustInserted\n\t\t\t}\n\t\t/>\n\t);\n\n\tconst blockProps = useBlockProps();\n\n\tif ( ! hasImages ) {\n\t\treturn <View { ...blockProps }>{ mediaPlaceholder }</View>;\n\t}\n\n\tconst imageSizeOptions = getImagesSizeOptions();\n\tconst shouldShowSizeOptions = hasImages && imageSizeOptions.length > 0;\n\n\treturn (\n\t\t<>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Settings' ) }>\n\t\t\t\t\t{ images.length > 1 && (\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t\tlabel={ __( 'Columns' ) }\n\t\t\t\t\t\t\tvalue={ columns }\n\t\t\t\t\t\t\tonChange={ setColumnsNumber }\n\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\tmax={ Math.min( MAX_COLUMNS, images.length ) }\n\t\t\t\t\t\t\t{ ...MOBILE_CONTROL_PROPS_RANGE_CONTROL }\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\tlabel={ __( 'Crop images' ) }\n\t\t\t\t\t\tchecked={ !! imageCrop }\n\t\t\t\t\t\tonChange={ toggleImageCrop }\n\t\t\t\t\t\thelp={ getImageCropHelp }\n\t\t\t\t\t/>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\tlabel={ __( 'Link to' ) }\n\t\t\t\t\t\tvalue={ linkTo }\n\t\t\t\t\t\tonChange={ setLinkTo }\n\t\t\t\t\t\toptions={ linkOptions }\n\t\t\t\t\t\thideCancelButton={ true }\n\t\t\t\t\t/>\n\t\t\t\t\t{ shouldShowSizeOptions && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\t__nextHasNoMarginBottom\n\t\t\t\t\t\t\tlabel={ __( 'Image size' ) }\n\t\t\t\t\t\t\tvalue={ sizeSlug }\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\n\t\t\t\t\t\t\tonChange={ updateImagesSize }\n\t\t\t\t\t\t\thideCancelButton={ true }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t{ noticeUI }\n\t\t\t<Gallery\n\t\t\t\t{ ...props }\n\t\t\t\tselectedImage={ selectedImage }\n\t\t\t\tmediaPlaceholder={ mediaPlaceholder }\n\t\t\t\tonMoveBackward={ onMoveBackward }\n\t\t\t\tonMoveForward={ onMoveForward }\n\t\t\t\tonRemoveImage={ onRemoveImage }\n\t\t\t\tonSelectImage={ onSelectImage }\n\t\t\t\tonDeselectImage={ onDeselectImage }\n\t\t\t\tonSetImageAttributes={ setImageAttributes }\n\t\t\t\tblockProps={ blockProps }\n\t\t\t\t// This prop is used by gallery.native.js.\n\t\t\t\tonFocusGalleryCaption={ onFocusGalleryCaption }\n\t\t\t/>\n\t\t</>\n\t);\n}\n\nexport default compose( [\n\twithNotices,\n\twithViewportMatch( { isNarrow: '< small' } ),\n] )( GalleryEdit );\n"],"mappings":"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"}