{"version":3,"names":["useRef","useRefEffect","ENTER","useSelect","useDispatch","useRegistry","store","blockEditorStore","hasBlockSupport","createBlock","getDefaultBlockName","useOnEnter","props","batch","moveBlocksToPosition","replaceInnerBlocks","duplicateBlocks","insertBlock","getBlockRootClientId","getBlockIndex","getBlockOrder","getBlockName","getBlock","getNextBlockClientId","canInsertBlockType","propsRef","current","element","onKeyDown","event","defaultPrevented","keyCode","content","clientId","length","wrapperClientId","order","position","indexOf","newWrapperClientId","preventDefault","defaultBlockName","wrapperBlock","blockIndex","innerBlocks","slice","addEventListener","removeEventListener"],"sources":["@wordpress/block-library/src/paragraph/use-enter.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { ENTER } from '@wordpress/keycodes';\nimport { useSelect, useDispatch, useRegistry } from '@wordpress/data';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\nimport {\n\thasBlockSupport,\n\tcreateBlock,\n\tgetDefaultBlockName,\n} from '@wordpress/blocks';\n\nexport function useOnEnter( props ) {\n\tconst { batch } = useRegistry();\n\tconst {\n\t\tmoveBlocksToPosition,\n\t\treplaceInnerBlocks,\n\t\tduplicateBlocks,\n\t\tinsertBlock,\n\t} = useDispatch( blockEditorStore );\n\tconst {\n\t\tgetBlockRootClientId,\n\t\tgetBlockIndex,\n\t\tgetBlockOrder,\n\t\tgetBlockName,\n\t\tgetBlock,\n\t\tgetNextBlockClientId,\n\t\tcanInsertBlockType,\n\t} = useSelect( blockEditorStore );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( event.keyCode !== ENTER ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { content, clientId } = propsRef.current;\n\n\t\t\t// The paragraph should be empty.\n\t\t\tif ( content.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst wrapperClientId = getBlockRootClientId( clientId );\n\n\t\t\tif (\n\t\t\t\t! hasBlockSupport(\n\t\t\t\t\tgetBlockName( wrapperClientId ),\n\t\t\t\t\t'__experimentalOnEnter',\n\t\t\t\t\tfalse\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst order = getBlockOrder( wrapperClientId );\n\t\t\tconst position = order.indexOf( clientId );\n\n\t\t\t// If it is the last block, exit.\n\t\t\tif ( position === order.length - 1 ) {\n\t\t\t\tlet newWrapperClientId = wrapperClientId;\n\n\t\t\t\twhile (\n\t\t\t\t\t! canInsertBlockType(\n\t\t\t\t\t\tgetBlockName( clientId ),\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId )\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tnewWrapperClientId =\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId );\n\t\t\t\t}\n\n\t\t\t\tif ( typeof newWrapperClientId === 'string' ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tmoveBlocksToPosition(\n\t\t\t\t\t\t[ clientId ],\n\t\t\t\t\t\twrapperClientId,\n\t\t\t\t\t\tgetBlockRootClientId( newWrapperClientId ),\n\t\t\t\t\t\tgetBlockIndex( newWrapperClientId ) + 1\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst defaultBlockName = getDefaultBlockName();\n\n\t\t\tif (\n\t\t\t\t! canInsertBlockType(\n\t\t\t\t\tdefaultBlockName,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId )\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\n\t\t\t// If it is in the middle, split the block in two.\n\t\t\tconst wrapperBlock = getBlock( wrapperClientId );\n\t\t\tbatch( () => {\n\t\t\t\tduplicateBlocks( [ wrapperClientId ] );\n\t\t\t\tconst blockIndex = getBlockIndex( wrapperClientId );\n\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\twrapperClientId,\n\t\t\t\t\twrapperBlock.innerBlocks.slice( 0, position )\n\t\t\t\t);\n\t\t\t\treplaceInnerBlocks(\n\t\t\t\t\tgetNextBlockClientId( wrapperClientId ),\n\t\t\t\t\twrapperBlock.innerBlocks.slice( position + 1 )\n\t\t\t\t);\n\t\t\t\tinsertBlock(\n\t\t\t\t\tcreateBlock( defaultBlockName ),\n\t\t\t\t\tblockIndex + 1,\n\t\t\t\t\tgetBlockRootClientId( wrapperClientId ),\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t} );\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAM,QAAQ,oBAAoB;AAC3C,SAASC,YAAY,QAAQ,oBAAoB;AACjD,SAASC,KAAK,QAAQ,qBAAqB;AAC3C,SAASC,SAAS,EAAEC,WAAW,EAAEC,WAAW,QAAQ,iBAAiB;AACrE,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,yBAAyB;AACnE,SACCC,eAAe,EACfC,WAAW,EACXC,mBAAmB,QACb,mBAAmB;AAE1B,OAAO,SAASC,UAAUA,CAAEC,KAAK,EAAG;EACnC,MAAM;IAAEC;EAAM,CAAC,GAAGR,WAAW,CAAC,CAAC;EAC/B,MAAM;IACLS,oBAAoB;IACpBC,kBAAkB;IAClBC,eAAe;IACfC;EACD,CAAC,GAAGb,WAAW,CAAEG,gBAAiB,CAAC;EACnC,MAAM;IACLW,oBAAoB;IACpBC,aAAa;IACbC,aAAa;IACbC,YAAY;IACZC,QAAQ;IACRC,oBAAoB;IACpBC;EACD,CAAC,GAAGrB,SAAS,CAAEI,gBAAiB,CAAC;EACjC,MAAMkB,QAAQ,GAAGzB,MAAM,CAAEY,KAAM,CAAC;EAChCa,QAAQ,CAACC,OAAO,GAAGd,KAAK;EACxB,OAAOX,YAAY,CAAI0B,OAAO,IAAM;IACnC,SAASC,SAASA,CAAEC,KAAK,EAAG;MAC3B,IAAKA,KAAK,CAACC,gBAAgB,EAAG;QAC7B;MACD;MAEA,IAAKD,KAAK,CAACE,OAAO,KAAK7B,KAAK,EAAG;QAC9B;MACD;MAEA,MAAM;QAAE8B,OAAO;QAAEC;MAAS,CAAC,GAAGR,QAAQ,CAACC,OAAO;;MAE9C;MACA,IAAKM,OAAO,CAACE,MAAM,EAAG;QACrB;MACD;MAEA,MAAMC,eAAe,GAAGjB,oBAAoB,CAAEe,QAAS,CAAC;MAExD,IACC,CAAEzB,eAAe,CAChBa,YAAY,CAAEc,eAAgB,CAAC,EAC/B,uBAAuB,EACvB,KACD,CAAC,EACA;QACD;MACD;MAEA,MAAMC,KAAK,GAAGhB,aAAa,CAAEe,eAAgB,CAAC;MAC9C,MAAME,QAAQ,GAAGD,KAAK,CAACE,OAAO,CAAEL,QAAS,CAAC;;MAE1C;MACA,IAAKI,QAAQ,KAAKD,KAAK,CAACF,MAAM,GAAG,CAAC,EAAG;QACpC,IAAIK,kBAAkB,GAAGJ,eAAe;QAExC,OACC,CAAEX,kBAAkB,CACnBH,YAAY,CAAEY,QAAS,CAAC,EACxBf,oBAAoB,CAAEqB,kBAAmB,CAC1C,CAAC,EACA;UACDA,kBAAkB,GACjBrB,oBAAoB,CAAEqB,kBAAmB,CAAC;QAC5C;QAEA,IAAK,OAAOA,kBAAkB,KAAK,QAAQ,EAAG;UAC7CV,KAAK,CAACW,cAAc,CAAC,CAAC;UACtB1B,oBAAoB,CACnB,CAAEmB,QAAQ,CAAE,EACZE,eAAe,EACfjB,oBAAoB,CAAEqB,kBAAmB,CAAC,EAC1CpB,aAAa,CAAEoB,kBAAmB,CAAC,GAAG,CACvC,CAAC;QACF;QACA;MACD;MAEA,MAAME,gBAAgB,GAAG/B,mBAAmB,CAAC,CAAC;MAE9C,IACC,CAAEc,kBAAkB,CACnBiB,gBAAgB,EAChBvB,oBAAoB,CAAEiB,eAAgB,CACvC,CAAC,EACA;QACD;MACD;MAEAN,KAAK,CAACW,cAAc,CAAC,CAAC;;MAEtB;MACA,MAAME,YAAY,GAAGpB,QAAQ,CAAEa,eAAgB,CAAC;MAChDtB,KAAK,CAAE,MAAM;QACZG,eAAe,CAAE,CAAEmB,eAAe,CAAG,CAAC;QACtC,MAAMQ,UAAU,GAAGxB,aAAa,CAAEgB,eAAgB,CAAC;QAEnDpB,kBAAkB,CACjBoB,eAAe,EACfO,YAAY,CAACE,WAAW,CAACC,KAAK,CAAE,CAAC,EAAER,QAAS,CAC7C,CAAC;QACDtB,kBAAkB,CACjBQ,oBAAoB,CAAEY,eAAgB,CAAC,EACvCO,YAAY,CAACE,WAAW,CAACC,KAAK,CAAER,QAAQ,GAAG,CAAE,CAC9C,CAAC;QACDpB,WAAW,CACVR,WAAW,CAAEgC,gBAAiB,CAAC,EAC/BE,UAAU,GAAG,CAAC,EACdzB,oBAAoB,CAAEiB,eAAgB,CAAC,EACvC,IACD,CAAC;MACF,CAAE,CAAC;IACJ;IAEAR,OAAO,CAACmB,gBAAgB,CAAE,SAAS,EAAElB,SAAU,CAAC;IAChD,OAAO,MAAM;MACZD,OAAO,CAACoB,mBAAmB,CAAE,SAAS,EAAEnB,SAAU,CAAC;IACpD,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;AACR"}